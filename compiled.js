/*! For license information please see compiled.js.LICENSE.txt */
(()=>{var e,t,n={766:(e,t,n)=>{var o;!function(){"use strict";var i=function(){this.init()};i.prototype={init:function(){var e=this||r;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||r;if(e=parseFloat(e),t.ctx||p(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,r.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var o=t._howls[n]._getSoundIds(),i=0;i<o.length;i++){var s=t._howls[n]._soundById(o[i]);s&&s._node&&(s._node.volume=s._volume*e)}return t}return t._volume},mute:function(e){var t=this||r;t.ctx||p(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,r.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var o=t._howls[n]._getSoundIds(),i=0;i<o.length;i++){var s=t._howls[n]._soundById(o[i]);s&&s._node&&(s._node.muted=!!e||s._muted)}return t},stop:function(){for(var e=this||r,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||r,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,p()),e},codecs:function(e){return(this||r)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||r;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||r,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var n=t.canPlayType("audio/mpeg;").replace(/^no$/,""),o=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),i=o&&parseInt(o[0].split("/")[1],10)<33;return e._codecs={mp3:!(i||!n&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||r;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(n){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var o=new Audio;o._unlocked=!0,e._releaseHtml5Audio(o)}catch(n){e.noAudio=!0;break}for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var r=e._howls[i]._getSoundIds(),s=0;s<r.length;s++){var a=e._howls[i]._soundById(r[s]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0);for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),e}},_obtainHtml5Audio:function(){var e=this||r;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||r;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&r.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var n=0;n<e._howls[t]._sounds.length;n++)if(!e._howls[t]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&r.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var r=new i,s=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};s.prototype={init:function(e){var t=this;return r.ctx||p(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=r.usingWebAudio&&!t._html5,void 0!==r.ctx&&r.ctx&&r.autoUnlock&&r._unlockAudio(),r._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(r.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var o,i;if(e._format&&e._format[n])o=e._format[n];else{if("string"!=typeof(i=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(o=/^data:audio\/([^;,]+);/i.exec(i))||(o=/\.([^.]+)$/.exec(i.split("?",1)[0])),o&&(o=o[1].toLowerCase())}if(o||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),o&&r.codecs(o)){t=e._src[n];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new a(e),e._webAudio&&u(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var n=this,o=null;if("number"==typeof e)o=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(void 0===e&&(e="__default",!n._playLock)){for(var i=0,s=0;s<n._sounds.length;s++)n._sounds[s]._paused&&!n._sounds[s]._ended&&(i++,o=n._sounds[s]._id);1===i?e=null:o=null}}var a=o?n._soundById(o):n._inactiveSound();if(!a)return null;if(o&&!e&&(e=a._sprite||"__default"),"loaded"!==n._state){a._sprite=e,a._ended=!1;var l=a._id;return n._queue.push({event:"play",action:function(){n.play(l)}}),l}if(o&&!a._paused)return t||n._loadQueue("play"),a._id;n._webAudio&&r._autoResume();var u=Math.max(0,a._seek>0?a._seek:n._sprite[e][0]/1e3),c=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-u),d=1e3*c/Math.abs(a._rate),h=n._sprite[e][0]/1e3,p=(n._sprite[e][0]+n._sprite[e][1])/1e3;a._sprite=e,a._ended=!1;var f=function(){a._paused=!1,a._seek=u,a._start=h,a._stop=p,a._loop=!(!a._loop&&!n._sprite[e][2])};if(!(u>=p)){var y=a._node;if(n._webAudio){var g=function(){n._playLock=!1,f(),n._refreshBuffer(a);var e=a._muted||n._muted?0:a._volume;y.gain.setValueAtTime(e,r.ctx.currentTime),a._playStart=r.ctx.currentTime,void 0===y.bufferSource.start?a._loop?y.bufferSource.noteGrainOn(0,u,86400):y.bufferSource.noteGrainOn(0,u,c):a._loop?y.bufferSource.start(0,u,86400):y.bufferSource.start(0,u,c),d!==1/0&&(n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),d)),t||setTimeout((function(){n._emit("play",a._id),n._loadQueue()}),0)};"running"===r.state&&"interrupted"!==r.ctx.state?g():(n._playLock=!0,n.once("resume",g),n._clearTimer(a._id))}else{var m=function(){y.currentTime=u,y.muted=a._muted||n._muted||r._muted||y.muted,y.volume=a._volume*r.volume(),y.playbackRate=a._rate;try{var o=y.play();if(o&&"undefined"!=typeof Promise&&(o instanceof Promise||"function"==typeof o.then)?(n._playLock=!0,f(),o.then((function(){n._playLock=!1,y._unlocked=!0,t||(n._emit("play",a._id),n._loadQueue())})).catch((function(){n._playLock=!1,n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):t||(n._playLock=!1,f(),n._emit("play",a._id),n._loadQueue()),y.playbackRate=a._rate,y.paused)return void n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||a._loop?n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),d):(n._endTimers[a._id]=function(){n._ended(a),y.removeEventListener("ended",n._endTimers[a._id],!1)},y.addEventListener("ended",n._endTimers[a._id],!1))}catch(e){n._emit("playerror",a._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===y.src&&(y.src=n._src,y.load());var _=window&&window.ejecta||!y.readyState&&r._navigator.isCocoonJS;if(y.readyState>=3||_)m();else{n._playLock=!0;var v=function(){m(),y.removeEventListener(r._canPlayEvent,v,!1)};y.addEventListener(r._canPlayEvent,v,!1),n._clearTimer(a._id)}}return a._id}n._ended(a)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),o=0;o<n.length;o++){t._clearTimer(n[o]);var i=t._soundById(n[o]);if(i&&!i._paused&&(i._seek=t.seek(n[o]),i._rateSeek=0,i._paused=!0,t._stopFade(n[o]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var o=n._getSoundIds(e),i=0;i<o.length;i++){n._clearTimer(o[i]);var r=n._soundById(o[i]);r&&(r._seek=r._start||0,r._rateSeek=0,r._paused=!0,r._ended=!0,n._stopFade(o[i]),r._node&&(n._webAudio?r._node.bufferSource&&(void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),n._cleanBuffer(r._node)):isNaN(r._node.duration)&&r._node.duration!==1/0||(r._node.currentTime=r._start||0,r._node.pause(),r._node.duration===1/0&&n._clearSound(r._node))),t||n._emit("stop",r._id))}return n},mute:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,t)}}),n;if(void 0===t){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var o=n._getSoundIds(t),i=0;i<o.length;i++){var s=n._soundById(o[i]);s&&(s._muted=e,s._interval&&n._stopFade(s._id),n._webAudio&&s._node?s._node.gain.setValueAtTime(e?0:s._volume,r.ctx.currentTime):s._node&&(s._node.muted=!!r._muted||e),n._emit("mute",s._id))}return n},volume:function(){var e,t,n,o=this,i=arguments;if(0===i.length)return o._volume;if(1===i.length||2===i.length&&void 0===i[1]){var s=o._getSoundIds(),a=s.indexOf(i[0]);a>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(n=t?o._soundById(t):o._sounds[0])?n._volume:0;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"volume",action:function(){o.volume.apply(o,i)}}),o;void 0===t&&(o._volume=e),t=o._getSoundIds(t);for(var l=0;l<t.length;l++)(n=o._soundById(t[l]))&&(n._volume=e,i[2]||o._stopFade(t[l]),o._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,r.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*r.volume()),o._emit("volume",n._id));return o},fade:function(e,t,n,o){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(e,t,n,o)}}),i;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),n=parseFloat(n),i.volume(e,o);for(var s=i._getSoundIds(o),a=0;a<s.length;a++){var l=i._soundById(s[a]);if(l){if(o||i._stopFade(s[a]),i._webAudio&&!l._muted){var u=r.ctx.currentTime,c=u+n/1e3;l._volume=e,l._node.gain.setValueAtTime(e,u),l._node.gain.linearRampToValueAtTime(t,c)}i._startFadeInterval(l,e,t,n,s[a],void 0===o)}}return i},_startFadeInterval:function(e,t,n,o,i,r){var s=this,a=t,l=n-t,u=Math.abs(l/.01),c=Math.max(4,u>0?o/u:o),d=Date.now();e._fadeTo=n,e._interval=setInterval((function(){var i=(Date.now()-d)/o;d=Date.now(),a+=l*i,a=Math.round(100*a)/100,a=l<0?Math.max(n,a):Math.min(n,a),s._webAudio?e._volume=a:s.volume(a,e._id,!0),r&&(s._volume=a),(n<t&&a<=n||n>t&&a>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,s.volume(n,e._id),s._emit("fade",e._id))}),c)},_stopFade:function(e){var t=this,n=t._soundById(e);return n&&n._interval&&(t._webAudio&&n._node.gain.cancelScheduledValues(r.ctx.currentTime),clearInterval(n._interval),n._interval=null,t.volume(n._fadeTo,e),n._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,n,o=this,i=arguments;if(0===i.length)return o._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(n=o._soundById(parseInt(i[0],10)))&&n._loop;e=i[0],o._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var r=o._getSoundIds(t),s=0;s<r.length;s++)(n=o._soundById(r[s]))&&(n._loop=e,o._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop)));return o},rate:function(){var e,t,n,o=this,i=arguments;if(0===i.length)t=o._sounds[0]._id;else if(1===i.length){var s=o._getSoundIds(),a=s.indexOf(i[0]);a>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(n=o._soundById(t))?n._rate:o._rate;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"rate",action:function(){o.rate.apply(o,i)}}),o;void 0===t&&(o._rate=e),t=o._getSoundIds(t);for(var l=0;l<t.length;l++)if(n=o._soundById(t[l])){o.playing(t[l])&&(n._rateSeek=o.seek(t[l]),n._playStart=o._webAudio?r.ctx.currentTime:n._playStart),n._rate=e,o._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,r.ctx.currentTime):n._node&&(n._node.playbackRate=e);var u=o.seek(t[l]),c=(o._sprite[n._sprite][0]+o._sprite[n._sprite][1])/1e3-u,d=1e3*c/Math.abs(n._rate);!o._endTimers[t[l]]&&n._paused||(o._clearTimer(t[l]),o._endTimers[t[l]]=setTimeout(o._ended.bind(o,n),d)),o._emit("rate",n._id)}return o},seek:function(){var e,t,n=this,o=arguments;if(0===o.length)t=n._sounds[0]._id;else if(1===o.length){var i=n._getSoundIds(),s=i.indexOf(o[0]);s>=0?t=parseInt(o[0],10):n._sounds.length&&(t=n._sounds[0]._id,e=parseFloat(o[0]))}else 2===o.length&&(e=parseFloat(o[0]),t=parseInt(o[1],10));if(void 0===t)return n;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,o)}}),n;var a=n._soundById(t);if(a){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var l=n.playing(t)?r.ctx.currentTime-a._playStart:0,u=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(u+l*Math.abs(a._rate))}return a._node.currentTime}var c=n.playing(t);c&&n.pause(t,!0),a._seek=e,a._ended=!1,n._clearTimer(t),n._webAudio||!a._node||isNaN(a._node.duration)||(a._node.currentTime=e);var d=function(){n._emit("seek",t),c&&n.play(t,!0)};if(c&&!n._webAudio){var h=function(){n._playLock?setTimeout(h,0):d()};setTimeout(h,0)}else d()}return n},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var o=0;o<t._sounds.length;o++)if(!t._sounds[o]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,o=t._soundById(e);return o&&(n=t._sprite[o._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++)t[n]._paused||e.stop(t[n]._id),e._webAudio||(e._clearSound(t[n]._node),t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener(r._canPlayEvent,t[n]._loadFn,!1),t[n]._node.removeEventListener("ended",t[n]._endFn,!1),r._releaseHtml5Audio(t[n]._node)),delete t[n]._node,e._clearTimer(t[n]._id);var o=r._howls.indexOf(e);o>=0&&r._howls.splice(o,1);var i=!0;for(n=0;n<r._howls.length;n++)if(r._howls[n]._src===e._src||e._src.indexOf(r._howls[n]._src)>=0){i=!1;break}return l&&i&&delete l[e._src],r.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,o){var i=this["_on"+e];return"function"==typeof t&&i.push(o?{id:n,fn:t,once:o}:{id:n,fn:t}),this},off:function(e,t,n){var o=this,i=o["_on"+e],r=0;if("number"==typeof t&&(n=t,t=null),t||n)for(r=0;r<i.length;r++){var s=n===i[r].id;if(t===i[r].fn&&s||!t&&s){i.splice(r,1);break}}else if(e)o["_on"+e]=[];else{var a=Object.keys(o);for(r=0;r<a.length;r++)0===a[r].indexOf("_on")&&Array.isArray(o[a[r]])&&(o[a[r]]=[])}return o},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var o=this,i=o["_on"+e],r=i.length-1;r>=0;r--)i[r].id&&i[r].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(o,i[r].fn),0),i[r].once&&o.off(e,i[r].fn,i[r].id));return o._loadQueue(e),o},_loadQueue:function(e){var t=this;if(t._queue.length>0){var n=t._queue[0];n.event===e&&(t._queue.shift(),t._loadQueue()),e||n.action()}return t},_ended:function(e){var t=this,n=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var o=!(!e._loop&&!t._sprite[n][2]);if(t._emit("end",e._id),!t._webAudio&&o&&t.stop(e._id,!0).play(e._id),t._webAudio&&o){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=r.ctx.currentTime;var i=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),i)}return t._webAudio&&!o&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),r._autoSuspend()),t._webAudio||o||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var n=t._soundById(e);n&&n._node&&n._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new a(e)},_drain:function(){var e=this,t=e._pool,n=0,o=0;if(!(e._sounds.length<t)){for(o=0;o<e._sounds.length;o++)e._sounds[o]._ended&&n++;for(o=e._sounds.length-1;o>=0;o--){if(n<=t)return;e._sounds[o]._ended&&(e._webAudio&&e._sounds[o]._node&&e._sounds[o]._node.disconnect(0),e._sounds.splice(o,1),n--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=r.ctx.createBufferSource(),e._node.bufferSource.buffer=l[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,r.ctx.currentTime),this},_cleanBuffer:function(e){var t=r._navigator&&r._navigator.vendor.indexOf("Apple")>=0;if(r._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=r._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(r._navigator&&r._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(e){this._parent=e,this.init()};a.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++r._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,n=r._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===r.ctx.createGain?r.ctx.createGainNode():r.ctx.createGain(),e._node.gain.setValueAtTime(n,r.ctx.currentTime),e._node.paused=!0,e._node.connect(r.masterGain)):r.noAudio||(e._node=r._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(r._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=n*r.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++r._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(r._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var l={},u=function(e){var t=e._src;if(l[t])return e._duration=l[t].duration,void h(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),o=new Uint8Array(n.length),i=0;i<n.length;++i)o[i]=n.charCodeAt(i);d(o.buffer,e)}else{var r=new XMLHttpRequest;r.open(e._xhr.method,t,!0),r.withCredentials=e._xhr.withCredentials,r.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){r.setRequestHeader(t,e._xhr.headers[t])})),r.onload=function(){var t=(r.status+"")[0];"0"===t||"2"===t||"3"===t?d(r.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+r.status+".")},r.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete l[t],e.load())},c(r)}},c=function(e){try{e.send()}catch(t){e.onerror()}},d=function(e,t){var n=function(){t._emit("loaderror",null,"Decoding audio data failed.")},o=function(e){e&&t._sounds.length>0?(l[t._src]=e,h(t,e)):n()};"undefined"!=typeof Promise&&1===r.ctx.decodeAudioData.length?r.ctx.decodeAudioData(e).then(o).catch(n):r.ctx.decodeAudioData(e,o,n)},h=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},p=function(){if(r.usingWebAudio){try{"undefined"!=typeof AudioContext?r.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?r.ctx=new webkitAudioContext:r.usingWebAudio=!1}catch(e){r.usingWebAudio=!1}r.ctx||(r.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(r._navigator&&r._navigator.platform),t=r._navigator&&r._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=t?parseInt(t[1],10):null;if(e&&n&&n<9){var o=/safari/.test(r._navigator&&r._navigator.userAgent.toLowerCase());r._navigator&&!o&&(r.usingWebAudio=!1)}r.usingWebAudio&&(r.masterGain=void 0===r.ctx.createGain?r.ctx.createGainNode():r.ctx.createGain(),r.masterGain.gain.setValueAtTime(r._muted?0:r._volume,r.ctx.currentTime),r.masterGain.connect(r.ctx.destination)),r._setup()}};void 0===(o=function(){return{Howler:r,Howl:s}}.apply(t,[]))||(e.exports=o),t.Howler=r,t.Howl=s,void 0!==n.g?(n.g.HowlerGlobal=i,n.g.Howler=r,n.g.Howl=s,n.g.Sound=a):"undefined"!=typeof window&&(window.HowlerGlobal=i,window.Howler=r,window.Howl=s,window.Sound=a)}(),function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;n>=0;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var o=this;return o.ctx&&o.ctx.listener?(t="number"!=typeof t?o._pos[1]:t,n="number"!=typeof n?o._pos[2]:n,"number"!=typeof e?o._pos:(o._pos=[e,t,n],void 0!==o.ctx.listener.positionX?(o.ctx.listener.positionX.setTargetAtTime(o._pos[0],Howler.ctx.currentTime,.1),o.ctx.listener.positionY.setTargetAtTime(o._pos[1],Howler.ctx.currentTime,.1),o.ctx.listener.positionZ.setTargetAtTime(o._pos[2],Howler.ctx.currentTime,.1)):o.ctx.listener.setPosition(o._pos[0],o._pos[1],o._pos[2]),o)):o},HowlerGlobal.prototype.orientation=function(e,t,n,o,i,r){var s=this;if(!s.ctx||!s.ctx.listener)return s;var a=s._orientation;return t="number"!=typeof t?a[1]:t,n="number"!=typeof n?a[2]:n,o="number"!=typeof o?a[3]:o,i="number"!=typeof i?a[4]:i,r="number"!=typeof r?a[5]:r,"number"!=typeof e?a:(s._orientation=[e,t,n,o,i,r],void 0!==s.ctx.listener.forwardX?(s.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),s.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),s.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),s.ctx.listener.upX.setTargetAtTime(o,Howler.ctx.currentTime,.1),s.ctx.listener.upY.setTargetAtTime(i,Howler.ctx.currentTime,.1),s.ctx.listener.upZ.setTargetAtTime(r,Howler.ctx.currentTime,.1)):s.ctx.listener.setOrientation(e,t,n,o,i,r),s)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._stereo=t.stereo||null,n._pos=t.pos||null,n._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},n._onstereo=t.onstereo?[{fn:t.onstereo}]:[],n._onpos=t.onpos?[{fn:t.onpos}]:[],n._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,n){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"stereo",action:function(){o.stereo(e,n)}}),o;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof e)return o._stereo;o._stereo=e,o._pos=[e,0,0]}for(var r=o._getSoundIds(n),s=0;s<r.length;s++){var a=o._soundById(r[s]);if(a){if("number"!=typeof e)return a._stereo;a._stereo=e,a._pos=[e,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||t(a,i),"spatial"===i?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(e,0,0):a._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),o._emit("stereo",a._id)}}return o},Howl.prototype.pos=function(e,n,o,i){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"pos",action:function(){r.pos(e,n,o,i)}}),r;if(n="number"!=typeof n?0:n,o="number"!=typeof o?-.5:o,void 0===i){if("number"!=typeof e)return r._pos;r._pos=[e,n,o]}for(var s=r._getSoundIds(i),a=0;a<s.length;a++){var l=r._soundById(s[a]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,n,o],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(o,Howler.ctx.currentTime)):l._panner.setPosition(e,n,o)),r._emit("pos",l._id)}}return r},Howl.prototype.orientation=function(e,n,o,i){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"orientation",action:function(){r.orientation(e,n,o,i)}}),r;if(n="number"!=typeof n?r._orientation[1]:n,o="number"!=typeof o?r._orientation[2]:o,void 0===i){if("number"!=typeof e)return r._orientation;r._orientation=[e,n,o]}for(var s=r._getSoundIds(i),a=0;a<s.length;a++){var l=r._soundById(s[a]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,n,o],l._node&&(l._panner||(l._pos||(l._pos=r._pos||[0,0,-.5]),t(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(o,Howler.ctx.currentTime)):l._panner.setOrientation(e,n,o)),r._emit("orientation",l._id)}}return r},Howl.prototype.pannerAttr=function(){var e,n,o,i=this,r=arguments;if(!i._webAudio)return i;if(0===r.length)return i._pannerAttr;if(1===r.length){if("object"!=typeof r[0])return(o=i._soundById(parseInt(r[0],10)))?o._pannerAttr:i._pannerAttr;e=r[0],void 0===n&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===r.length&&(e=r[0],n=parseInt(r[1],10));for(var s=i._getSoundIds(n),a=0;a<s.length;a++)if(o=i._soundById(s[a])){var l=o._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var u=o._panner;u?(u.coneInnerAngle=l.coneInnerAngle,u.coneOuterAngle=l.coneOuterAngle,u.coneOuterGain=l.coneOuterGain,u.distanceModel=l.distanceModel,u.maxDistance=l.maxDistance,u.refDistance=l.refDistance,u.rolloffFactor=l.rolloffFactor,u.panningModel=l.panningModel):(o._pos||(o._pos=i._pos||[0,0,-.5]),t(o,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent;t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this),t._stereo?n.stereo(t._stereo):t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,t._stereo?n.stereo(t._stereo):t._pos?n.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,n._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()},416:(e,t,n)=>{"use strict";const o={i8:"0.2.0"};function i(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function r(e){return e.getContext("2d")}function s(e){e.clearRect(0,0,e.canvas.clientWidth,e.canvas.clientHeight)}function a(){return o.i8.includes("dev")}class l{constructor({rule:e}){this.rule=e,this.width=this.rule.matrixWidth,this.height=this.rule.matrixHeight,this.hiddenHeight=this.rule.matrixHiddenHeight,this.resetGrid()}resetGrid(){const e=new Array(this.getHeight()).fill([]);for(let t=0;t<e.length;t++)e[t]=new Array(this.width).fill(null);this.grid=e}getGridWithPolyomino(e,t,n){const o=(i=this.grid,JSON.parse(JSON.stringify(i)));var i;if(null==n)return o;for(let i=0;i<n.getTotalMonominos();i++){const r=n.getMonominos()[i],s=e+n.getCurrentCoordinates()[i].x;o[t+n.getCurrentCoordinates()[i].y][s]=r}return o}getWidth(){return this.width}getHeight(){return this.height+this.hiddenHeight}getVisibleHeight(){return this.height}getHiddenHeight(){return this.hiddenHeight}getCoordinateType(e,t){return t<0&&this.rule.matrixHasCeiling||e<0||e>=this.width||t>=this.getHeight()?"wall":t>=this.hiddenHeight?"normal":"hidden"}hasObstructionAt(e,t){return"wall"===this.getCoordinateType(e,t)||this.hasMonominoAt(e,t)}hasMonominoAt(e,t){return null!=this.grid[t][e]}addMonominoTo(e,t,n){null!=this.grid&&(this.grid[t][e]=n)}getFilledRows(e=this.grid){const t=[];for(let n=0;n<e.length;n++)for(let o=0;o<=e.length;o++){if(o===e[n].length){t.push(n);break}if(null==e[n][o])break}return t}getRowsMarkedForDeath(){return this.markedForDeath}markFilledRowsForDeath(){this.markedForDeath=[],this.markedForDeath=[...this.getFilledRows()]}killRowsMarkedForDeath(){for(const e of this.markedForDeath)for(let t=0;t<this.grid[e].length;t++)this.grid[e][t]=null}collapseRowsMarkedForDeath(){let e=!1;for(const t of this.markedForDeath)for(let n=t;n>=0;n--)if(0!==n){this.grid[n]=this.grid[n-1];for(const t of this.grid[n])null!=t&&(e=!0);this.markedForDeath.splice(t,1)}else this.grid[n]=new Array(this.width).fill(null);return this.markedForDeath=[],e}isEmpty(){if(null==this.grid)return!0;for(const e of this.grid)for(const t of e)if(null!=t)return!1;return!0}getDrawData(){const e=[];for(let t=0;t<this.grid.length;t++)for(let n=0;n<this.grid[t].length;n++){const o=this.grid[t][n];null!=o&&e.push({x:n,y:t-this.getHiddenHeight(),color:o.getColor()})}return e}}class u{constructor({color:e="invalid",connectionsByte:t=0}={}){this.color=e,this.connectionsByte=t}getColor(){return this.color}setColor(e){this.color=e}getConnectionState(e){return 0!=(this.connectionsByte&e)}setConnectionState(e,t){t?this.connectionsByte|=e:this.connectionsByte&=~e}setConnectionsByte(e){if(e<0||e>255)throw new Error("The connection byte specified is not within 0-255");this.connectionsByte=e}}class c{constructor({shape:e}){this.shape="none",this.orientation=0,this.data=null,this.monominos=[],this.setShape(e);for(let e=0;e<this.getTotalMonominos();e++)this.monominos.push(new u)}getMonominos(){return this.monominos}setShape(e){this.shape=e,this.data=c.DATA[this.shape]}setOrientation(e){this.orientation=e}getOrientation(){return this.orientation}getCurrentCoordinates(){return this.data[this.orientation]}getCoordinates(e){return this.data[e]}getShape(){return this.shape}getVisualData(){return c.VISUAL_LENGTHS[this.shape][this.orientation]}setColor(e){for(const t of this.monominos)t.setColor(e)}getTotalMonominos(){return c.DATA[this.shape][this.orientation].length}placeToMatrix({x:e,y:t,matrix:n}){for(let o=0;o<this.getTotalMonominos();o++){const i=this.monominos[o],r=e+this.getCurrentCoordinates()[o].x,s=t+this.getCurrentCoordinates()[o].y;n.addMonominoTo(r,s,i)}}}c.DATA={i:[[{x:0,y:1,connections:8},{x:1,y:1,connections:12},{x:2,y:1,connections:12},{x:3,y:1,connections:4}],[{x:2,y:0,connections:2},{x:2,y:1,connections:3},{x:2,y:2,connections:3},{x:2,y:3,connections:1}],[{x:3,y:2,connections:4},{x:2,y:2,connections:12},{x:1,y:2,connections:12},{x:0,y:2,connections:8}],[{x:1,y:3,connections:1},{x:1,y:2,connections:3},{x:1,y:1,connections:3},{x:1,y:0,connections:2}]],j:[[{x:0,y:0,connections:2},{x:0,y:1,connections:9},{x:1,y:1,connections:12},{x:2,y:1,connections:4}],[{x:2,y:0,connections:4},{x:1,y:0,connections:10},{x:1,y:1,connections:3},{x:1,y:2,connections:1}],[{x:2,y:2,connections:1},{x:2,y:1,connections:6},{x:1,y:1,connections:12},{x:0,y:1,connections:8}],[{x:0,y:2,connections:8},{x:1,y:2,connections:5},{x:1,y:1,connections:3},{x:1,y:0,connections:2}]],l:[[{x:2,y:0,connections:2},{x:2,y:1,connections:5},{x:1,y:1,connections:12},{x:0,y:1,connections:8}],[{x:2,y:2,connections:4},{x:1,y:2,connections:9},{x:1,y:1,connections:3},{x:1,y:0,connections:2}],[{x:0,y:2,connections:1},{x:0,y:1,connections:10},{x:1,y:1,connections:12},{x:2,y:1,connections:4}],[{x:0,y:0,connections:8},{x:1,y:0,connections:6},{x:1,y:1,connections:3},{x:1,y:2,connections:1}]],o:[[{x:0,y:0,connections:138},{x:1,y:0,connections:70},{x:1,y:1,connections:21},{x:0,y:1,connections:41}],[{x:1,y:0,connections:70},{x:1,y:1,connections:21},{x:0,y:1,connections:41},{x:0,y:0,connections:138}],[{x:1,y:1,connections:21},{x:0,y:1,connections:41},{x:0,y:0,connections:138},{x:1,y:0,connections:70}],[{x:0,y:1,connections:41},{x:0,y:0,connections:138},{x:1,y:0,connections:70},{x:1,y:1,connections:21}]],s:[[{x:2,y:0,connections:4},{x:1,y:0,connections:10},{x:1,y:1,connections:5},{x:0,y:1,connections:8}],[{x:2,y:2,connections:1},{x:2,y:1,connections:6},{x:1,y:1,connections:9},{x:1,y:0,connections:2}],[{x:0,y:2,connections:8},{x:1,y:2,connections:5},{x:1,y:1,connections:10},{x:2,y:1,connections:4}],[{x:0,y:0,connections:2},{x:0,y:1,connections:9},{x:1,y:1,connections:6},{x:1,y:2,connections:1}]],t:[[{x:1,y:0,connections:2},{x:0,y:1,connections:8},{x:1,y:1,connections:13},{x:2,y:1,connections:4}],[{x:2,y:1,connections:4},{x:1,y:0,connections:2},{x:1,y:1,connections:11},{x:1,y:2,connections:1}],[{x:1,y:2,connections:1},{x:2,y:1,connections:4},{x:1,y:1,connections:14},{x:0,y:1,connections:8}],[{x:0,y:1,connections:8},{x:1,y:2,connections:1},{x:1,y:1,connections:7},{x:1,y:0,connections:2}]],z:[[{x:0,y:0,connections:8},{x:1,y:0,connections:6},{x:1,y:1,connections:9},{x:2,y:1,connections:4}],[{x:2,y:0,connections:2},{x:2,y:1,connections:5},{x:1,y:1,connections:10},{x:1,y:2,connections:1}],[{x:2,y:2,connections:4},{x:1,y:2,connections:9},{x:1,y:1,connections:6},{x:0,y:1,connections:8}],[{x:0,y:2,connections:1},{x:0,y:1,connections:10},{x:1,y:1,connections:5},{x:1,y:0,connections:2}]]},c.VISUAL_LENGTHS={i:[{startX:0,endX:3,startY:1,endY:1},{startX:2,endX:2,startY:0,endY:3},{startX:0,endX:3,startY:2,endY:2},{startX:1,endX:1,startY:0,endY:3}],j:[{startX:0,endX:2,startY:0,endY:1},{startX:1,endX:2,startY:0,endY:2},{startX:0,endX:2,startY:1,endY:2},{startX:0,endX:1,startY:0,endY:2}],l:[{startX:0,endX:2,startY:0,endY:1},{startX:1,endX:2,startY:0,endY:2},{startX:0,endX:2,startY:1,endY:2},{startX:0,endX:1,startY:0,endY:2}],o:[{startX:0,endX:1,startY:0,endY:1},{startX:0,endX:1,startY:0,endY:1},{startX:0,endX:1,startY:0,endY:1},{startX:0,endX:1,startY:0,endY:1}],s:[{startX:0,endX:2,startY:0,endY:1},{startX:1,endX:2,startY:0,endY:2},{startX:0,endX:2,startY:1,endY:2},{startX:0,endX:1,startY:0,endY:2}],t:[{startX:0,endX:2,startY:0,endY:1},{startX:1,endX:2,startY:0,endY:2},{startX:0,endX:2,startY:1,endY:2},{startX:0,endX:1,startY:0,endY:2}],z:[{startX:0,endX:2,startY:0,endY:1},{startX:1,endX:2,startY:0,endY:2},{startX:0,endX:2,startY:1,endY:2},{startX:0,endX:1,startY:0,endY:2}]},c.SPIN_POINTS={i:[{major1:[{x:1,y:0},{x:2,y:0}],major2:[{x:2,y:2},{x:1,y:2}],minor1:[{x:-1,y:1}],minor2:[{x:4,y:1}]},{major1:[{x:1,y:1},{x:1,y:2}],major2:[{x:3,y:2},{x:3,y:1}],minor1:[{x:2,y:-1}],minor2:[{x:2,y:4}]},{major1:[{x:1,y:1},{x:2,y:1}],major2:[{x:2,y:3},{x:1,y:3}],minor1:[{x:-1,y:2}],minor2:[{x:4,y:2}]},{major1:[{x:0,y:1},{x:0,y:2}],major2:[{x:2,y:2},{x:2,y:1}],minor1:[{x:1,y:-1}],minor2:[{x:1,y:4}]}],j:[{major1:[{x:1,y:0}],major2:[{x:2,y:0}],minor1:[{x:0,y:2}],minor2:[{x:2,y:2}]},{major1:[{x:2,y:1}],major2:[{x:2,y:2}],minor1:[{x:0,y:0}],minor2:[{x:0,y:2}]},{major1:[{x:1,y:2}],major2:[{x:0,y:2}],minor1:[{x:2,y:0}],minor2:[{x:0,y:0}]},{major1:[{x:0,y:1}],major2:[{x:0,y:0}],minor1:[{x:2,y:2}],minor2:[{x:2,y:0}]}],l:[{major1:[{x:1,y:0}],major2:[{x:0,y:0}],minor1:[{x:2,y:2}],minor2:[{x:0,y:2}]},{major1:[{x:2,y:1}],major2:[{x:2,y:0}],minor1:[{x:0,y:2}],minor2:[{x:0,y:0}]},{major1:[{x:1,y:2}],major2:[{x:2,y:2}],minor1:[{x:0,y:0}],minor2:[{x:2,y:0}]},{major1:[{x:0,y:1}],major2:[{x:0,y:2}],minor1:[{x:2,y:0}],minor2:[{x:2,y:2}]}],o:[{major1:[],major2:[],minor1:[],minor2:[]},{major1:[],major2:[],minor1:[],minor2:[]},{major1:[],major2:[],minor1:[],minor2:[]},{major1:[],major2:[],minor1:[],minor2:[]}],s:[{major1:[{x:0,y:0}],major2:[{x:2,y:1}],minor1:[{x:3,y:0}],minor2:[{x:-1,y:1}]},{major1:[{x:1,y:2}],major2:[{x:2,y:0}],minor1:[{x:1,y:-1}],minor2:[{x:2,y:3}]},{major1:[{x:2,y:2}],major2:[{x:0,y:1}],minor1:[{x:-1,y:2}],minor2:[{x:3,y:1}]},{major1:[{x:1,y:0}],major2:[{x:0,y:2}],minor1:[{x:1,y:3}],minor2:[{x:0,y:-1}]}],t:[{major1:[{x:0,y:0}],major2:[{x:2,y:0}],minor1:[{x:0,y:2}],minor2:[{x:2,y:2}]},{major1:[{x:2,y:0}],major2:[{x:2,y:2}],minor1:[{x:0,y:0}],minor2:[{x:0,y:2}]},{major1:[{x:0,y:2}],major2:[{x:2,y:2}],minor1:[{x:0,y:0}],minor2:[{x:2,y:0}]},{major1:[{x:0,y:0}],major2:[{x:0,y:2}],minor1:[{x:2,y:0}],minor2:[{x:2,y:2}]}],z:[{major1:[{x:2,y:0}],major2:[{x:0,y:1}],minor1:[{x:-1,y:0}],minor2:[{x:3,y:1}]},{major1:[{x:2,y:2}],major2:[{x:1,y:0}],minor1:[{x:2,y:-1}],minor2:[{x:1,y:3}]},{major1:[{x:0,y:2}],major2:[{x:2,y:1}],minor1:[{x:3,y:2}],minor2:[{x:-1,y:1}]},{major1:[{x:0,y:0}],major2:[{x:1,y:2}],minor1:[{x:0,y:3}],minor2:[{x:1,y:-1}]}]},c.TETROMINOES=["i","j","l","o","s","t","z"];var d=n(766);const h={src:["res/se/tetrax/tetrax.ogg","res/se/tetrax/tetrax.m4a","res/se/tetrax/tetrax.mp3","res/se/tetrax/tetrax.ac3"],sprite:{alarm:[0,1017.8684807256235],b2bContinue:[3e3,2218.7528344671196],bufferedHold:[7e3,1453.2653061224482],bufferedRotate:[1e4,890.8390022675743],bufferedSkip:[12e3,1918.9795918367345],collapse:[15e3,1698.2312925170077],combo01:[18e3,2477.68707482993],combo02:[22e3,2477.68707482993],combo03:[26e3,2477.68707482993],combo04:[3e4,2477.68707482993],combo05:[34e3,2477.68707482993],combo06:[38e3,2477.68707482993],combo07:[42e3,2477.68707482993],combo08:[46e3,2473.2199546485276],combo09:[5e4,2473.2199546485276],combo10:[54e3,1928.5714285714307],combo11:[57e3,1901.7913832199583],combo12:[6e4,1879.455782312924],combo13:[63e3,1861.6099773242638],combo14:[66e3,3315.8730158730095],combo15:[71e3,3417.1428571428632],combo16:[76e3,3564.557823129249],combo17:[81e3,3495.1020408163204],combo18:[86e3,3490.8163265306057],combo19:[91e3,3489.841269841264],deathWarning:[96e3,810.8163265306132],erase1:[98e3,1454.6258503401361],erase2:[101e3,1586.1904761904811],erase3:[104e3,1688.0498866213145],erase4:[107e3,1718.752834467125],gameDeath:[11e4,3156.780045351468],gameGo:[115e3,3210.408163265299],gameOver:[12e4,1973.2199546485276],gameReady:[123e3,3092.4716553287935],gameStart:[128e3,3101.882086167791],gameVictory:[133e3,3251.7460317460236],garbageFlyHit:[138e3,1946.4399092970552],garbageFlyReceive:[141e3,1939.31972789116],garbageFlySend:[144e3,3301.315192743772],garbageSpawn:[149e3,2287.188208616783],levelUp:[153e3,2070.3628117913695],lockWithoutHardDrop:[157e3,847.8684807256229],outOfResets:[159e3,3247.98185941043],pause:[164e3,3253.9455782312816],perfectClear:[169e3,3338.730158730158],pieceHardDrop:[174e3,970.226757369602],pieceHold:[176e3,853.6961451247294],pieceLand:[178e3,1092.5623582766377],pieceMove:[181e3,992.3356009070403],pieceRotate:[183e3,1124.8526077097551],pieceRotateT:[186e3,1667.1882086167784],pieceRotateTMini:[189e3,2221.904761904767],pieceSkip:[193e3,1108.5260770975083],pieceSlide:[196e3,370.29478458049425],pieceWallkick:[198e3,1340.5668934240396],tSpin0:[201e3,2197.9138321995606],tSpin1:[205e3,2197.9138321995606],tSpin2:[209e3,2322.9251700680325],tSpin3:[213e3,2505.215419501127],tSpinMini0:[217e3,2197.9138321995606],tSpinMini1:[221e3,2197.9138321995606],tSpinMini2:[225e3,2322.9251700680325]}};class p{static loadSounds(e){null==e.instance&&(e.instance=new d.Howl(e.data.howlOptions),p.updateVolume())}static add(e,t=p.currentSoundbank){p.soundQueue[e]=t}static playQueue(){for(const e of Object.keys(p.soundQueue)){const t=p.soundQueue[e];null!=(null==t?void 0:t.data.eventAssignments[e])?(t.instance.play(t.data.eventAssignments[e]),delete p.soundQueue[e]):delete p.soundQueue[e]}}static updateVolume(){for(const e of Object.keys(p.soundbanks)){const t=p.soundbanks[e];null!=t.instance&&t.instance.volume(.25)}}static setSoundbank(e){p.loadSounds(e),p.currentSoundbank=e}}p.soundQueue={},p.soundbanks={tetrax:{data:new class{constructor(){this.howlOptions=h,this.eventAssignments={pieceMove:"pieceMove",pieceRotate:"pieceRotate",pieceRotateT:"pieceRotateT",pieceRotateTMini:"pieceRotateTMini",pieceWallkick:"pieceWallkick",pieceHold:"pieceHold",pieceSlide:"pieceSlide",pieceLand:"pieceLand",outOfResets:"outOfResets",bufferedHold:"bufferedHold",bufferedRotate:"bufferedRotate",bufferedSkip:"bufferedSkip",pieceHardDrop:"pieceHardDrop",lockWithoutHardDrop:"lockWithoutHardDrop",collapse:"collapse",erase1:"erase1",erase2:"erase2",erase3:"erase3",erase4:"erase4",tSpin0:"tSpin0",tSpin1:"tSpin1",tSpin2:"tSpin2",tSpin3:"tSpin3",tSpinMini0:"tSpinMini0",tSpinMini1:"tSpinMini1",tSpinMini2:"tSpinMini2",perfectClear:"perfectClear",levelUp:"levelUp"}}},instance:null}};class f{constructor({matrix:e,rule:t,mode:n}){this.lastY=0,this.lowestY=0,this.inSoftDrop=!1,this.fallSpeed=1e3,this.mustUpgradeSpin=!1,this.matrix=e,this.rule=t,this.mode=n}lockdown(){this.polyomino.placeToMatrix({x:this.x,y:this.getIntY(),matrix:this.matrix}),this.polyomino=null}isDead(){return null==this.polyomino}isDirty(){return this._isDirty}wasDrawn(){this._isDirty=!1}needsRedrawing(){this._isDirty=!0}init(e){this.polyomino=e;const t=this.rule.spawnOffsets[this.polyomino.getShape()];this.x=t.x,this.y=t.y+this.matrix.getHiddenHeight(),this.shift(0,this.rule.immediateDropOnSpawn),this.is20G()&&!this.rule.suspendPieceUntilAction&&this.slamToFloor(),this.lowestY=0,this.updateLowestAndLastY(),this.resetLockDelay(),this.needsRedrawing(),this.needsToDie=!1,this.lastAction="spawn"}collidesWith(e,t,n){var o;if(void 0===n&&(n=null===(o=this.polyomino)||void 0===o?void 0:o.getOrientation()),this.isDead())return;const[i,r]=[this.x+e,this.getIntY()+t];for(let e=0;e<this.polyomino.getTotalMonominos();e++){const t=i+this.polyomino.getCoordinates(n)[e].x,o=r+this.polyomino.getCoordinates(n)[e].y;if("wall"===this.matrix.getCoordinateType(t,o))return!0;if(this.matrix.hasMonominoAt(t,o))return!0}return!1}updateLowestAndLastY(){var e;this.lowestY=Math.max(this.getIntY()+(null===(e=this.polyomino)||void 0===e?void 0:e.getVisualData().endY),this.lowestY),this.lastY=this.y}isOnGround(){return this.collidesWith(0,1)}isStuck(){return this.collidesWith(0,0)}canShiftLeft(){return!this.collidesWith(-1,0)}canShiftRight(){return!this.collidesWith(1,0)}shift(e,t){this.collidesWith(e,t)||(this.x+=e,this.y+=t,0===e&&0===t||this.needsRedrawing())}shiftLeft(){this.canShiftLeft()&&(null!=this.polyomino&&p.add("pieceMove"),this.lastAction="move",this.movementsAccum++,(this.collidesWith(-1,1)||this.isOnGround())&&p.add("pieceSlide")),this.shift(-1,0)}shiftRight(){this.canShiftRight()&&(null!=this.polyomino&&p.add("pieceMove"),this.lastAction="move",this.movementsAccum++,(this.collidesWith(1,1)||this.isOnGround())&&p.add("pieceSlide")),this.shift(1,0)}rotate(e){if(this.isDead())return;const t=(this.polyomino.getOrientation()+e)%4,n=this.rule.rotationSystem.wallkick.executeWallkick({x:this.x,y:this.getIntY(),rotateDirection:e,oldOrientation:this.polyomino.getOrientation(),newOrientation:t,allowFloorKicks:!0,polyominoController:this,matrix:this.matrix});if(null!=n){if(n.usedKick&&"disable-wallkick"===this.rule.resetExpirationPenalty&&this.hasExhaustedResets())return;this.polyomino.setOrientation(n.orientation),this.x+=n.xOffset,this.y+=n.yOffset,n.usedKick&&this.rule.resetLockDelayByKicking&&(this.lockDelayAccum=0),this.lastAction="rotate",this.mustUpgradeSpin=n.mustUpgradeSpin;const e=this.checkIfSpin();e.isSpin?e.isMini?p.add("pieceRotateTMini"):p.add("pieceRotateT"):p.add("pieceRotate"),n.usedKick&&p.add("pieceWallkick"),this.rotationsAccum++}}checkIfSpin(){if("rotate"!==this.lastAction)return{isSpin:!1,isMini:!1};const e=this.polyomino.getShape();if(-1===this.mode.scoring.spinPolyominoList.indexOf(e))return{isSpin:!1,isMini:!1};const t=this.polyomino.getOrientation();if("threeCorner"===this.mode.scoring.spinBonusType){const n=e=>{for(const t of e)if(this.matrix.hasObstructionAt(this.x+t.x,this.getIntY()+t.y))return!0},o=n(c.SPIN_POINTS[e][t].major1),i=n(c.SPIN_POINTS[e][t].major2),r=n(c.SPIN_POINTS[e][t].minor1),s=n(c.SPIN_POINTS[e][t].minor2);if(o&&i&&(r||s))return{isSpin:!0,isMini:!1};if((o||i)&&r&&s)return{isSpin:!0,isMini:!this.mustUpgradeSpin}}else if("immobile"===this.mode.scoring.spinBonusType&&this.collidesWith(-1,0)&&this.collidesWith(1,0)&&this.collidesWith(0,-1)&&this.collidesWith(0,1))return{isSpin:!0,isMini:!1};return{isSpin:!1,isMini:!1}}doGravity(e){if(this.rule.suspendPieceUntilAction&&"spawn"===this.lastAction)return;const t=e/this.getFallSpeed();if("retro"===this.rule.lockDelayType)if(this.hasEnoughSpaceBelow(t)){const e=this.y;this.y+=t,this.isStuck()&&(this.y=e,this.slamToFloor(),this.needsToDie=!0)}else this.slamToFloor(),this.needsToDie=!0;else this.isOnGround()?this.y=this.getIntY():this.hasEnoughSpaceBelow(t)?this.y+=Math.min(t,this.getDropDistance(t+1)):this.slamToFloor();this.getIntY()>Math.floor(this.lastY)&&(this.isOnGround()&&p.add("pieceLand"),this.needsRedrawing(),this.lastAction="fall")}resetLockDelay(){this.resetLockDelayResets(),this.lockDelayAccum=0}resetLockDelayResets(){this.movementsAccum=0,this.rotationsAccum=0,this.movementsAccommodated=0,this.rotationsAccommodated=0}doLockDelay(e){var t;this.getIntY()+(null===(t=this.polyomino)||void 0===t?void 0:t.getVisualData().endY)>Math.floor(this.lowestY)&&(this.rule.resetLockDelayByFalling&&(this.lockDelayAccum=0),this.rule.resetResetsByFalling&&this.resetLockDelayResets()),this.isOnGround()&&(this.lockDelayAccum+=e,this.needsRedrawing()),this.hasExhaustedResets()&&"disable-resets"===this.rule.resetExpirationPenalty||(this.rule.resetLockDelayByMoving&&this.movementsAccum>this.movementsAccommodated&&(this.movementsAccommodated=this.movementsAccum,this.lockDelayAccum=0,this.needsRedrawing()),this.rule.resetLockDelayByRotating&&this.rotationsAccum>this.rotationsAccommodated&&(this.rotationsAccommodated=this.rotationsAccum,this.lockDelayAccum=0,this.needsRedrawing()))}hasExhaustedResets(){return!!(this.rule.moveAndRotateResetsAreShared&&this.movementsAccum+this.rotationsAccum>=Math.min(this.rule.moveResets,this.rule.rotationResets)&&this.rule.resetLockDelayByMoving&&this.rule.resetLockDelayByRotating)||!(!(()=>this.movementsAccum>=this.rule.moveResets&&this.rule.resetLockDelayByMoving)()&&!(()=>this.rotationsAccum>=this.rule.rotationResets&&this.rule.resetLockDelayByRotating)())}lockDelayHasExpired(){return"retro"===this.rule.lockDelayType?this.needsToDie:!("limited"!==this.rule.lockDelayType||!this.isOnGround()||!this.hasExhaustedResets()||"instant-lock"!==this.rule.resetExpirationPenalty)||this.lockDelayAccum>=this.rule.lockDelay&&this.isOnGround()}getLockDelayAccumulated(){return this.lockDelayAccum}isAboveSkyline(){return this.y+this.polyomino.getVisualData().endY<this.matrix.getHiddenHeight()}isPartiallyAboveSkyline(){return this.y<this.matrix.getHiddenHeight()}getIntY(){return Math.floor(this.y)}getVisibleY(){return this.getIntY()-this.matrix.getHiddenHeight()}hasEnoughSpaceBelow(e){return e<1||this.getDropDistance(e)===Math.floor(e)}getDropDistance(e){if(this.isStuck())return 0;let t=0;for(t=1;t<=e;t++)if(this.collidesWith(0,t))return t-1;return t-1}getDistanceToFloor(){return this.getDropDistance(this.matrix.getHeight()+Math.abs(this.getIntY()))}slamToFloor(){const e=this.getDistanceToFloor();this.y+=e,e>0&&(this.lastAction="fall")}getFallSpeed(){if(this.inSoftDrop)switch(this.rule.softDropType){case"multiplicative":return this.fallSpeed/this.rule.softDropSpeed;default:throw new Error("Unhandled soft drop type")}return this.fallSpeed}setFallSpeedAsMsPerLine(e){this.fallSpeed=e}setFallSpeedAsG(e){this.fallSpeed=1/e/60*1e3}setFallSpeedTo20G(){this.fallSpeed=.09}is20G(){return this.fallSpeed<.1}sendToHoldQueue(e){this.rule.holdResetsPieceOrientation&&this.polyomino.setOrientation(this.rule.rotationSystem.initialOrientation[this.polyomino.getShape()]),e.setPolyomino(this.polyomino),this.polyomino=null}swapWithHoldQueue(e){const t=e.getPolyomino();this.sendToHoldQueue(e),this.init(t)}getPolyominoShape(){return this.polyomino.getShape()}getHardDropLineClearRows(){const e=this.matrix.getGridWithPolyomino(this.x,this.getIntY()+this.getDistanceToFloor(),this.polyomino);return this.matrix.getFilledRows(e)}getDrawData(){if(null==this.polyomino)return[];const e=[],t=this.polyomino.getMonominos();for(let n=0;n<this.polyomino.getTotalMonominos();n++)this.rule.allowsGhost&&e.push({x:this.x+this.polyomino.getCurrentCoordinates()[n].x,y:this.getVisibleY()+this.polyomino.getCurrentCoordinates()[n].y+this.getDistanceToFloor(),color:t[n].getColor(),isGhost:!0}),e.push({x:this.x+this.polyomino.getCurrentCoordinates()[n].x,y:this.getVisibleY()+this.polyomino.getCurrentCoordinates()[n].y,color:t[n].getColor()});return e}}class y{constructor({rule:e}){this.queue=[],this.setRandomizer(e.randomizer),this.rule=e;for(let e=0;e<y.INIT_SIZE;e++)this.addPolyominoFromRandomizer()}setRandomizer(e){this.randomizer=e}addPolyominoFromRandomizer(){const e=new c({shape:this.randomizer.getNextPolyomino()});e.setOrientation(this.rule.rotationSystem.initialOrientation[e.getShape()]),e.setColor(this.rule.colors[e.getShape()]),this.queue.push(e)}shiftNextPolyomino(){return this.addPolyominoFromRandomizer(),this.queue.shift()}getNextPolyomino(){return this.queue[0]}swapFirstPolyominoWithHold(e){const t=e.getPolyomino();e.setPolyomino(this.queue[0]),this.queue[0]=t}getDrawInfo(){const e=this.rule.maxPiecePreviews,t=[];for(let n=0;n<=e;n++){const e=this.queue[n],o=e.getMonominos(),i=[];for(let t=0;t<e.getTotalMonominos();t++){const n=o[t];i.push({x:e.getCoordinates(this.rule.rotationSystem.initialOrientation[e.getShape()])[t].x,y:e.getCoordinates(this.rule.rotationSystem.initialOrientation[e.getShape()])[t].y,color:n.getColor()})}t.push(i)}return t}}y.INIT_SIZE=9;class g{}g.config=new class{constructor(){this.autoshiftDelay=170,this.autoshiftRate=30,this.autoshiftBuffering="charge"}},g.controls=new class{constructor(){this.shiftLeft=["ArrowLeft"],this.shiftRight=["ArrowRight"],this.hardDrop=["Space"],this.softDrop=["ArrowDown"],this.rotateLeft=["KeyZ","ControlLeft"],this.rotateRight=["KeyX","ArrowUp"],this.rotate180=["KeyD"],this.hold=["KeyC","ShiftLeft"],this.retry=["KeyR"],this.pause=["Escape","KeyP"]}};class m{constructor({rule:e}){this.rule=e,this.polyomino=null}setPolyomino(e){this.polyomino=e}getPolyomino(){return this.polyomino}getDrawInfo(){if(null==this.polyomino)return[];const e=this.polyomino.getMonominos(),t=[];for(let n=0;n<this.polyomino.getTotalMonominos();n++){const o=e[n];t.push({x:this.polyomino.getCurrentCoordinates()[n].x,y:this.polyomino.getCurrentCoordinates()[n].y,color:o.getColor()})}return t}}class _{constructor(e){this.lineClearAmount=0,this.hasYetToCollapseRows=!1,this.hasBufferedHold=!1,this.bufferedRotateDirection=null,this.bufferedMoveDirection="none",this.hasExhaustedResetsThisTick=!1,this.holdIsLocked=!1,this.stats={linesCleared:0,polyominoesPlaced:0,scoreAccumulated:0},this.mode=new e,this.rule=new this.mode.Rule,this.rule.randomizer.setPolyominoSet(this.mode.polyominoSet),this.nextQueue=new y({rule:this.rule}),this.holdQueue=new m({rule:this.rule}),this.matrix=new l({rule:this.rule}),this.polyominoController=new f({matrix:this.matrix,rule:this.rule,mode:this.mode}),this.resetStandardAutoshiftVars(),this.shiftDirection="none"}getAutoshiftDelay(){return Math.max(this.rule.minAutoshiftDelay,Math.min(this.rule.maxAutoshiftDelay,g.config.autoshiftDelay))}getAutoshiftRate(){return Math.max(this.rule.minAutoshiftRate,Math.min(this.rule.maxAutoshiftRate,g.config.autoshiftRate))}resetStandardAutoshiftVars(){this.autoshiftDelayAccum=0,this.autoshiftRateAccum=this.getAutoshiftRate(),this.hasReleasedShift=!0}doStartOfTick(e){if(this.mode.onStartOfTickBegin(this),"gameOver"!==this.state){if("entryDelay"===this.state){if(this.entryDelayAccum+=e,this.lineClearAmount&&this.entryDelayAccum>this.rule.lineClearDelay&&this.hasYetToCollapseRows&&(this.matrix.collapseRowsMarkedForDeath()&&p.add("collapse"),this.hasYetToCollapseRows=!1),!(this.entryDelayAccum>=this.getEntryDelay()))return;if(this.hasBufferedHold&&(null==this.holdQueue.getPolyomino()?this.holdQueue.setPolyomino(this.nextQueue.shiftNextPolyomino()):this.nextQueue.swapFirstPolyominoWithHold(this.holdQueue),p.add("bufferedHold"),this.hasBufferedHold=!1),null!=this.bufferedRotateDirection){const e=this.nextQueue.getNextPolyomino(),t=(e.getOrientation()+this.bufferedRotateDirection)%4;e.setOrientation(t),p.add("bufferedRotate"),this.bufferedRotateDirection=null}if(this.polyominoController.init(this.nextQueue.shiftNextPolyomino()),this.holdIsLocked=!1,"left"===this.bufferedMoveDirection?(this.polyominoController.shiftLeft(),this.bufferedMoveDirection="none"):"right"===this.bufferedMoveDirection&&(this.polyominoController.shiftRight(),this.bufferedMoveDirection="none"),this.rule.softDropCarriesBetweenPieces||(this.polyominoController.inSoftDrop=!1),this.polyominoController.isStuck())return void(this.state="gameOver");this.state="playing",this.mode.onNewPolyomino(this)}this.polyominoController.doGravity(e),this.hasExhaustedResetsThisTick=this.polyominoController.hasExhaustedResets(),this.polyominoController.lockDelayHasExpired()&&(p.add("lockWithoutHardDrop"),this.lockdown()),this.mode.onStartOfTickEnd(this)}}doEndOfTick(e){this.mode.onEndOfTickBegin(this),"gameOver"!==this.state&&"entryDelay"!==this.state&&(this.polyominoController.doLockDelay(e),this.polyominoController.is20G()&&!this.rule.suspendPieceUntilAction&&this.polyominoController.slamToFloor(),this.polyominoController.hasExhaustedResets()&&!this.hasExhaustedResetsThisTick&&p.add("outOfResets"),this.polyominoController.lockDelayHasExpired()&&(p.add("lockWithoutHardDrop"),this.lockdown()),this.polyominoController.updateLowestAndLastY(),this.mode.onEndOfTickEnd(this))}lockdown(){p.add("lock"),this.entryDelayAccum=0,this.stats.polyominoesPlaced++;let e=!1;(this.rule.hasLockOut||this.rule.hasPartialLockOut)&&(this.rule.hasPartialLockOut&&this.polyominoController.isPartiallyAboveSkyline()&&(e=!0),this.polyominoController.isAboveSkyline()&&(e=!0));const t=this.polyominoController.checkIfSpin();if(this.polyominoController.lockdown(),e)return void(this.state="gameOver");this.state="entryDelay",this.matrix.markFilledRowsForDeath(),this.matrix.killRowsMarkedForDeath(),this.matrix.isEmpty()&&p.add("perfectClear"),this.lineClearAmount=this.matrix.getRowsMarkedForDeath().length,this.stats.linesCleared+=this.lineClearAmount;let n=[];n=t.isSpin?t.isMini?["tSpinMini0","tSpinMini1","tSpinMini2",null,null]:["tSpin0","tSpin1","tSpin2","tSpin3",null]:[null,"erase1","erase2","erase3","erase4"],null!=n[this.lineClearAmount]&&p.add(n[this.lineClearAmount]),this.rule.lineClearDelay<=0&&this.matrix.collapseRowsMarkedForDeath(),this.hasYetToCollapseRows=!0,this.mode.onLockdown(this)}getEntryDelay(){return 0===this.lineClearAmount?this.rule.entryDelay:this.rule.lineClearDelay+this.rule.entryDelayOnLineClear}doHardDrop(){"gameOver"!==this.state&&(this.polyominoController.isDead()||this.rule.allowsHardDrop&&(p.add("pieceHardDrop"),this.polyominoController.slamToFloor(),this.rule.hardDropLocksPieceInstantly&&this.lockdown()))}onHardDropPress(){this.doHardDrop()}onHardDropRelease(){"gameOver"!==this.state&&this.polyominoController.isDead()}onHardDropDown(){this.rule.hardDropExecutesOnlyOncePerPress||this.doHardDrop()}onSoftDropPress(){"gameOver"!==this.state&&(this.rule.allowsSoftDrop?this.polyominoController.inSoftDrop=!0:this.polyominoController.inSoftDrop=!1)}onSoftDropRelease(){"gameOver"!==this.state&&(this.polyominoController.inSoftDrop=!1)}onSoftDropDown(){this.rule.softDropLocksPieceInstantly&&this.polyominoController.isOnGround()&&(p.add("lockWithoutHardDrop"),this.lockdown())}onHoldPress(){if("gameOver"!==this.state&&this.rule.allowsHold)return"entryDelay"===this.state?(this.rule.allowsHoldBuffering&&(this.hasBufferedHold=!0),void(this.rule.skipEntryDelayOnHold&&(this.entryDelayAccum=this.getEntryDelay(),this.hasBufferedHold=!0))):void(this.holdIsLocked||(null==this.holdQueue.getPolyomino()?(this.polyominoController.sendToHoldQueue(this.holdQueue),this.polyominoController.init(this.nextQueue.shiftNextPolyomino())):this.polyominoController.swapWithHoldQueue(this.holdQueue),p.add("pieceHold"),this.holdIsLocked=!0))}applyRotationBuffer(e){this.rule.skipEntryDelayOnRotate&&(this.entryDelayAccum=this.getEntryDelay()),(this.rule.allowsRotateBuffering||this.rule.skipEntryDelayOnRotate)&&(this.bufferedRotateDirection=e)}onRotateLeft(){"gameOver"!==this.state&&this.rule.allowsRotateLeft&&("entryDelay"!==this.state?this.polyominoController.rotate(3):this.applyRotationBuffer(3))}onRotateRight(){"gameOver"!==this.state&&this.rule.allowsRotateRight&&("entryDelay"!==this.state?this.polyominoController.rotate(1):this.applyRotationBuffer(1))}onRotate180(){"gameOver"!==this.state&&this.rule.allowsRotate180&&("entryDelay"!==this.state?this.polyominoController.rotate(2):this.applyRotationBuffer(2))}updateShift({leftPressedAmount:e=0,rightPressedAmount:t=0,hasLeftReleased:n=!1,hasRightReleased:o=!1,isLeftDown:i=!1,isRightDown:r=!1,msPassed:s}){if("gameOver"!==this.state)switch(this.rule.autoshiftType){case"standard":if(this.polyominoController.isStuck())return;if(e>t?(this.resetStandardAutoshiftVars(),this.shiftDirection="left"):t&&(this.resetStandardAutoshiftVars(),this.shiftDirection="right"),"right"===this.shiftDirection&&o&&i?(this.resetStandardAutoshiftVars(),this.shiftDirection="left",e=1):"left"===this.shiftDirection&&n&&r?(this.resetStandardAutoshiftVars(),this.shiftDirection="right",t=1):o&&i?this.shiftDirection="left":n&&r?this.shiftDirection="right":(n||o)&&(this.resetStandardAutoshiftVars(),this.shiftDirection="none"),"off"===g.config.autoshiftBuffering&&"entryDelay"===this.state)return;if("none"!==this.shiftDirection){"instant"!==g.config.autoshiftBuffering||"entryDelay"!==this.state||this.rule.skipEntryDelayOnMove||(this.autoshiftDelayAccum=this.getAutoshiftDelay());const n="left"===this.shiftDirection?this.polyominoController.shiftLeft.bind(this.polyominoController):this.polyominoController.shiftRight.bind(this.polyominoController);if(this.hasReleasedShift){const o="left"===this.shiftDirection?e:t;for(let e=0;e<o;e++)n();this.rule.skipEntryDelayOnMove&&"entryDelay"===this.state&&(this.entryDelayAccum=this.getEntryDelay(),this.bufferedMoveDirection=this.shiftDirection),this.hasReleasedShift=!1}else if(this.autoshiftDelayAccum<this.getAutoshiftDelay())this.autoshiftDelayAccum+=s;else if(this.autoshiftDelayAccum>=this.getAutoshiftDelay()){if(this.getAutoshiftRate()<=0){let e=0;for(;"left"===this.shiftDirection?this.polyominoController.canShiftLeft():this.polyominoController.canShiftRight();){if(e>this.matrix.getWidth())throw new Error("There is a problem with polyomino collision checks.");n(),this.polyominoController.is20G()&&this.polyominoController.slamToFloor(),e++}}else for(;this.autoshiftRateAccum>=this.getAutoshiftRate();)n(),this.polyominoController.is20G()&&this.polyominoController.slamToFloor(),this.autoshiftRateAccum-=this.getAutoshiftRate();this.autoshiftRateAccum+=s}}break;default:throw new Error(`Unhandled autoshift type: ${this.rule.autoshiftType}`)}}start(){this.polyominoController.init(this.nextQueue.shiftNextPolyomino()),this.state="playing",this.mode.onGameStart(this)}getStats(){return this.stats}getState(){return this.state}getPolyominoController(){return this.polyominoController}getMatrix(){return this.matrix}getNextQueue(){return this.nextQueue}getHoldQueue(){return this.holdQueue}getControllerDrawInfo(){return this.polyominoController.getDrawData()}getControllerDirtyState(){return this.polyominoController.isDirty()}hadControllerDrawn(){this.polyominoController.wasDrawn()}getControllerLockDelay(){return this.polyominoController.getLockDelayAccumulated()}getHardDropLineClearRows(){return this.polyominoController.getHardDropLineClearRows()}getMatrixDrawInfo(){return this.matrix.getDrawData()}getMatrixHiddenHeight(){return this.matrix.getHiddenHeight()}getNextDrawInfo(){return this.nextQueue.getDrawInfo()}getHoldDrawInfo(){return this.holdQueue.getDrawInfo()}}class v{static init(){if(v.hasInitiated)throw new Error("Do not initiate Input more than once.");for(const e of Object.keys(g.controls))v.currentGameKeys[e]=new Set,v.lastGameKeys[e]=new Set;document.addEventListener("keydown",v.keyDownListener),document.addEventListener("keyup",v.keyUpListener),v.hasInitiated=!0}static keyDownListener(e){for(const t of Object.keys(g.controls))-1!==g.controls[t].indexOf(e.code)&&v.currentGameKeys[t].add(e.code)}static keyUpListener(e){for(const t of Object.keys(g.controls))-1!==g.controls[t].indexOf(e.code)&&v.currentGameKeys[t].delete(e.code)}static updateGameInput(){for(const e of Object.keys(v.currentGameKeys))v.lastGameKeys[e]=new Set(v.currentGameKeys[e])}static getGameDown(e){return v.currentGameKeys[e].size>0}static getGamePress(e){return v.currentGameKeys[e].size>v.lastGameKeys[e].size}static getGameRelease(e){return v.currentGameKeys[e].size<v.lastGameKeys[e].size}static getGamePressAsNum(e){return Math.max(0,v.currentGameKeys[e].size-v.lastGameKeys[e].size)}}v.currentGameKeys={},v.lastGameKeys={},v.hasInitiated=!1,v.init();class x{constructor(){this.isPaused=!1}init(e){this.Mode=e,this.engine=new _(this.Mode)}doTick(e){if(v.getGamePress("retry"))return this.isPaused&&(this.isPaused=!1),this.engine=new _(this.Mode),void this.engine.start();if("gameOver"!==this.engine.getState())if(this.isPaused)v.getGamePress("pause")&&(this.engine.updateShift({msPassed:1,hasLeftReleased:!0,hasRightReleased:!0}),this.isPaused=!1);else if(v.getGamePress("pause"))this.isPaused=!0;else{this.engine.doStartOfTick(e);for(let e=0;e<v.getGamePressAsNum("rotateLeft");e++)this.engine.onRotateLeft();for(let e=0;e<v.getGamePressAsNum("rotateRight");e++)this.engine.onRotateRight();for(let e=0;e<v.getGamePressAsNum("rotate180");e++)this.engine.onRotate180();this.engine.updateShift({msPassed:e,leftPressedAmount:v.getGamePressAsNum("shiftLeft"),rightPressedAmount:v.getGamePressAsNum("shiftRight"),isLeftDown:v.getGameDown("shiftLeft"),isRightDown:v.getGameDown("shiftRight"),hasLeftReleased:v.getGameRelease("shiftLeft"),hasRightReleased:v.getGameRelease("shiftRight")}),v.getGamePress("softDrop")&&this.engine.onSoftDropPress(),v.getGameRelease("softDrop")&&this.engine.onSoftDropRelease(),v.getGameDown("softDrop")&&this.engine.onSoftDropDown(),v.getGamePress("hardDrop")&&this.engine.onHardDropPress(),v.getGameRelease("hardDrop")&&this.engine.onHardDropRelease(),v.getGameDown("hardDrop")&&this.engine.onHardDropDown(),v.getGamePress("hold")&&this.engine.onHoldPress(),this.engine.doEndOfTick(e)}}}class w{constructor(){this.spinPolyominoList=["t"],this.spinBonusType="threeCorner",this.hardDropRowBonus=2,this.softDropRowBonus=1}getLockdownScore({lineClearAmount:e,isSpin:t,isMini:n,levelMultiplier:o=1}){let i=0;return i+=[0,100,300,500,800][e=Math.min(4,e)],t&&(i+=[400,700,900,1100,1200][e]),n&&(i+=100),i*o}}class b{constructor({xOffset:e,yOffset:t,orientation:n,usedKick:o,mustUpgradeSpin:i}){this.mustUpgradeSpin=null!=i&&i,this.xOffset=e,this.yOffset=t,this.orientation=n,this.usedKick=o}getIsUpward(){return this.yOffset<0}}class k{getKickTable({shape:e,rotateDirection:t,oldOrientation:n}){switch(e){case"i":switch(t){case 3:return k.LEFT_I_KICKS[n];case 1:return k.RIGHT_I_KICKS[n];case 2:return k.DOUBLE_I_KICKS[n];default:throw new Error("Rotation direction unhandled in kick table retrieval")}case"j":case"l":case"s":case"t":case"z":switch(t){case 3:return k.LEFT_X_KICKS[n];case 1:return k.RIGHT_X_KICKS[n];case 2:return k.DOUBLE_X_KICKS[n];default:throw new Error("Rotation direction unhandled in kick table retrieval")}default:return null}}executeWallkick({polyominoController:e,rotateDirection:t,oldOrientation:n,newOrientation:o,allowFloorKicks:i}){if(!e.collidesWith(0,0,o))return new b({xOffset:0,yOffset:0,orientation:o,usedKick:!1});const r=this.getKickTable({shape:e.getPolyominoShape(),rotateDirection:t,oldOrientation:n});if(null!=r)for(let t=0;t<r.length;t++){const n=r[t];if((n.y>=0||i)&&!e.collidesWith(n.x,n.y,o))return new b({xOffset:n.x,yOffset:n.y,orientation:o,usedKick:!0,mustUpgradeSpin:t>=3})}return null}}k.LEFT_X_KICKS=[[{x:1,y:0},{x:1,y:-1},{x:0,y:2},{x:1,y:2}],[{x:1,y:0},{x:1,y:1},{x:0,y:-2},{x:1,y:-2}],[{x:-1,y:0},{x:-1,y:-1},{x:0,y:2},{x:-1,y:2}],[{x:-1,y:0},{x:-1,y:1},{x:0,y:-2},{x:-1,y:-2}]],k.RIGHT_X_KICKS=[[{x:-1,y:0},{x:-1,y:-1},{x:0,y:2},{x:-1,y:2}],[{x:1,y:0},{x:1,y:1},{x:0,y:-2},{x:1,y:-2}],[{x:1,y:0},{x:1,y:-1},{x:0,y:2},{x:1,y:2}],[{x:-1,y:0},{x:-1,y:1},{x:0,y:-2},{x:-1,y:-2}]],k.DOUBLE_X_KICKS=[[{x:1,y:0},{x:-1,y:0},{x:0,y:-1},{x:0,y:1},{x:0,y:-2},{x:0,y:2}],[{x:0,y:1},{x:0,y:-1},{x:0,y:-2},{x:0,y:2},{x:-1,y:0},{x:1,y:0}],[{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1},{x:0,y:2},{x:0,y:-2}],[{x:0,y:1},{x:0,y:-1},{x:0,y:-2},{x:0,y:2},{x:1,y:0},{x:-1,y:0}]],k.LEFT_I_KICKS=[[{x:-1,y:0},{x:2,y:0},{x:-1,y:-2},{x:2,y:1}],[{x:2,y:0},{x:-1,y:0},{x:2,y:-1},{x:-1,y:2}],[{x:1,y:0},{x:-2,y:0},{x:1,y:2},{x:-2,y:-1}],[{x:-2,y:0},{x:1,y:0},{x:-2,y:1},{x:1,y:-2}]],k.RIGHT_I_KICKS=[[{x:-2,y:0},{x:1,y:0},{x:-2,y:1},{x:1,y:-2}],[{x:-1,y:0},{x:2,y:0},{x:-1,y:-2},{x:2,y:1}],[{x:2,y:0},{x:-1,y:0},{x:2,y:-1},{x:-1,y:2}],[{x:1,y:0},{x:-2,y:0},{x:1,y:2},{x:-2,y:-1}]],k.DOUBLE_I_KICKS=[[{x:-1,y:0},{x:-2,y:0},{x:1,y:0},{x:2,y:0}],[{x:0,y:1},{x:0,y:-1},{x:0,y:-2},{x:0,y:2}],[{x:1,y:0},{x:2,y:0},{x:-1,y:0},{x:-2,y:0}],[{x:0,y:1},{x:0,y:-1},{x:0,y:-2},{x:0,y:2}]];class S{constructor(){this.initialOrientation={i:0,j:0,l:0,o:0,s:0,t:0,z:0},this.offsets={i:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],j:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],l:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],o:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],s:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],t:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],z:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]},this.wallkick=new k}}class A{constructor(){this.bagMultiplier=1,this.generator=this.generatorFunc()}*generatorFunc(){const e=[];for(;;){if(0===e.length){for(let t=0;t<this.bagMultiplier;t++)e.push(...this.polyominoSet);i(e)}yield e.pop()}}setPolyominoSet(e){this.polyominoSet=e}getNextPolyomino(){return this.generator.next().value}}class D{constructor(){this.allowsGhost=!0,this.allowsHardDrop=!0,this.allowsHold=!0,this.allowsHoldBuffering=!0,this.allowsRotate180=!0,this.allowsRotateBuffering=!0,this.allowsRotateLeft=!0,this.allowsRotateRight=!0,this.allowsSoftDrop=!0,this.autoshiftType="standard",this.colors={i:"lightBlue",j:"blue",l:"orange",o:"yellow",s:"green",t:"purple",z:"red"},this.entryDelay=100,this.entryDelayOnLineClear=100,this.hardDropLocksPieceInstantly=!0,this.hardDropExecutesOnlyOncePerPress=!0,this.hasLockOut=!0,this.hasPartialLockOut=!1,this.holdResetsPieceOrientation=!0,this.immediateDropOnSpawn=1,this.lineClearDelay=150,this.lockDelay=500,this.resetExpirationPenalty="instant-lock",this.lockDelayType="limited",this.matrixWidth=10,this.matrixHeight=20,this.matrixHiddenHeight=20,this.matrixHasCeiling=!1,this.maxAutoshiftDelay=Number.MAX_SAFE_INTEGER,this.maxAutoshiftRate=Number.MAX_SAFE_INTEGER,this.maxPiecePreviews=6,this.minAutoshiftDelay=-1,this.minAutoshiftRate=-1,this.moveAndRotateResetsAreShared=!0,this.moveResets=15,this.randomizer=new A,this.resetLockDelayByFalling=!0,this.resetLockDelayByKicking=!1,this.resetLockDelayByMoving=!0,this.resetLockDelayByRotating=!0,this.resetResetsByFalling=!0,this.rotationResets=15,this.rotationSystem=new S,this.skipEntryDelayOnHold=!1,this.skipEntryDelayOnMove=!1,this.skipEntryDelayOnRotate=!1,this.softDropCarriesBetweenPieces=!0,this.softDropLocksPieceInstantly=!1,this.softDropSpeed=20,this.softDropType="multiplicative",this.spawnOffsets={i:{x:3,y:-2},j:{x:3,y:-2},l:{x:3,y:-2},o:{x:4,y:-2},s:{x:3,y:-2},t:{x:3,y:-2},z:{x:3,y:-2}},this.suspendPieceUntilAction=!1}}class T extends class{constructor(){this.polyominoSet=c.TETROMINOES}getStatsToDraw(){return[]}onGameStart(e){}onLockdown(e){}onNewPolyomino(e){}onStartOfTickBegin(e){}onStartOfTickEnd(e){}onEndOfTickBegin(e){}onEndOfTickEnd(e){}}{constructor(){super(...arguments),this.Rule=D,this.scoring=new w,this.level=1,this.standardLockDelay=0}onGameStart(e){this.standardLockDelay=e.rule.lockDelay}onNewPolyomino(e){const t=this.level;this.level=Math.floor(e.getStats().linesCleared/10+1);const n=Math.pow(.8-.007*(this.level-1),this.level-1);e.getPolyominoController().setFallSpeedAsMsPerLine(1e3*n),this.level>=20?(e.getPolyominoController().setFallSpeedTo20G(),e.rule.lockDelay=500*Math.pow(.93,Math.pow(this.level-20,.8))):e.rule.lockDelay=this.standardLockDelay,this.level>t&&(p.add("levelUp"),console.log(`Level up! Level: ${this.level} Lock delay: ${e.rule.lockDelay}`))}}class L{constructor(){this.manager=new x;const e=document.createElement("canvas");e.width=10*L.SCALE,e.height=20*L.SCALE+L.SCALE*L.BUFFER_PEEK,e.style.position="absolute",e.style.left="6rem",e.style.outline=".2rem solid white",this.ctx=r(e);const t=document.createElement("canvas");t.width=5*L.SCALE,t.height=30*L.SCALE,t.style.position="absolute",t.style.left="19rem",this.nextCtx=r(t);const n=document.createElement("canvas");n.width=5*L.SCALE,n.height=5*L.SCALE,n.style.position="absolute",n.style.left=".1rem",this.holdCtx=r(n),document.querySelector("body").appendChild(e),document.querySelector("body").appendChild(t),document.querySelector("body").appendChild(n),this.manager.init(T),this.manager.engine.start(),this.last=window.performance.now(),window.requestAnimationFrame(this.gameLoop.bind(this)),window.setInterval(this.tickLoop.bind(this),1)}tickLoop(){this.now=window.performance.now();const e=this.now-this.last;this.manager.doTick(e),v.updateGameInput(),this.last=this.now}gameLoop(){s(this.ctx);const e=this.manager.engine.getMatrixDrawInfo(),t={red:"#ed4747",orange:"#ed8947",yellow:"#edcc47",green:"#63ed47",lightBlue:"#47ede5",blue:"#474fed",purple:"#cf47ed"};for(const n of e)n.y<-1||(this.ctx.fillStyle=t[n.color],this.ctx.fillRect(n.x*L.SCALE,n.y*L.SCALE+L.SCALE*L.BUFFER_PEEK,L.SCALE,L.SCALE));const n=this.manager.engine.getControllerDrawInfo();this.manager.engine.getControllerLockDelay(),this.manager.engine.rule.lockDelay;for(let e of this.manager.engine.getHardDropLineClearRows())e-=this.manager.engine.getMatrixHiddenHeight(),this.ctx.fillStyle="#fff2",this.ctx.globalCompositeOperation="source-atop",this.ctx.fillRect(0,e*L.SCALE+L.SCALE*L.BUFFER_PEEK,this.ctx.canvas.clientWidth,L.SCALE);this.ctx.globalCompositeOperation="source-over";for(const e of n)if(e.isGhost){this.ctx.strokeStyle=t[e.color],this.ctx.lineWidth=2;const n=e.x*L.SCALE+L.SCALE/2,o=e.y*L.SCALE+L.SCALE*L.BUFFER_PEEK+L.SCALE/2,i=L.SCALE/2*2/3;this.ctx.beginPath(),this.ctx.arc(n,o,i,0,2*Math.PI),this.ctx.stroke()}else this.ctx.fillStyle=t[e.color],this.ctx.fillRect(e.x*L.SCALE,e.y*L.SCALE+L.SCALE*L.BUFFER_PEEK,L.SCALE,L.SCALE);const o=this.manager.engine.getNextDrawInfo();s(this.nextCtx);for(let e=0;e<5&&o[e];e++)for(const n of o[e])this.nextCtx.fillStyle=t[n.color],this.nextCtx.fillRect(n.x*L.SCALE+.5*L.SCALE,n.y*L.SCALE+.5*L.SCALE+4*e*L.SCALE,L.SCALE,L.SCALE);const i=this.manager.engine.getHoldDrawInfo();s(this.holdCtx);for(const e of i)this.holdCtx.fillStyle=t[e.color],this.holdCtx.fillRect(e.x*L.SCALE,e.y*L.SCALE+.5*L.SCALE,L.SCALE,L.SCALE);this.manager.engine.hadControllerDrawn(),p.playQueue(),window.requestAnimationFrame(this.gameLoop.bind(this))}}function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?Object(arguments[t]):{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){O(e,t,n[t])}))}return e}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function I(e,t,n){return t&&E(e.prototype,t),n&&E(e,n),e}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function H(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?M(e):t}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}L.SCALE=20,L.BUFFER_PEEK=.25;var B={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},G=new(function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};P(this,e),this.init(t,n)}return I(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||B,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,n,o){return o&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(n).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,R({},{prefix:"".concat(this.prefix,":").concat(t,":")},this.options))}}]),e}()),Y=function(){function e(){P(this,e),this.observers={}}return I(e,[{key:"on",value:function(e,t){var n=this;return e.split(" ").forEach((function(e){n.observers[e]=n.observers[e]||[],n.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(this.observers[e]){var i=[].concat(this.observers[e]);i.forEach((function(e){e.apply(void 0,n)}))}if(this.observers["*"]){var r=[].concat(this.observers["*"]);r.forEach((function(t){t.apply(t,[e].concat(n))}))}}}]),e}();function V(){var e,t,n=new Promise((function(n,o){e=n,t=o}));return n.resolve=e,n.reject=t,n}function K(e){return null==e?"":""+e}function X(e,t,n){e.forEach((function(e){t[e]&&(n[e]=t[e])}))}function U(e,t,n){function o(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function i(){return!e||"string"==typeof e}for(var r="string"!=typeof t?[].concat(t):t.split(".");r.length>1;){if(i())return{};var s=o(r.shift());!e[s]&&n&&(e[s]=new n),e=Object.prototype.hasOwnProperty.call(e,s)?e[s]:{}}return i()?{}:{obj:e,k:o(r.shift())}}function W(e,t,n){var o=U(e,t,Object);o.obj[o.k]=n}function z(e,t){var n=U(e,t),o=n.obj,i=n.k;if(o)return o[i]}function Q(e,t,n){var o=z(e,n);return void 0!==o?o:z(t,n)}function q(e,t,n){for(var o in t)"__proto__"!==o&&"constructor"!==o&&(o in e?"string"==typeof e[o]||e[o]instanceof String||"string"==typeof t[o]||t[o]instanceof String?n&&(e[o]=t[o]):q(e[o],t[o],n):e[o]=t[o]);return e}function $(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var Z={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function J(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return Z[e]})):e}var ee="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,te=function(e){function t(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return P(this,t),n=H(this,F(t).call(this)),ee&&Y.call(M(n)),n.data=e||{},n.options=o,void 0===n.options.keySeparator&&(n.options.keySeparator="."),n}return N(t,e),I(t,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=void 0!==o.keySeparator?o.keySeparator:this.options.keySeparator,r=[e,t];return n&&"string"!=typeof n&&(r=r.concat(n)),n&&"string"==typeof n&&(r=r.concat(i?n.split(i):n)),e.indexOf(".")>-1&&(r=e.split(".")),z(this.data,r)}},{key:"addResource",value:function(e,t,n,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},r=this.options.keySeparator;void 0===r&&(r=".");var s=[e,t];n&&(s=s.concat(r?n.split(r):n)),e.indexOf(".")>-1&&(o=t,t=(s=e.split("."))[1]),this.addNamespaces(t),W(this.data,s,o),i.silent||this.emit("added",e,t,n,o)}},{key:"addResources",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var i in n)"string"!=typeof n[i]&&"[object Array]"!==Object.prototype.toString.apply(n[i])||this.addResource(e,t,i,n[i],{silent:!0});o.silent||this.emit("added",e,t,n)}},{key:"addResourceBundle",value:function(e,t,n,o,i){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},s=[e,t];e.indexOf(".")>-1&&(o=n,n=t,t=(s=e.split("."))[1]),this.addNamespaces(t);var a=z(this.data,s)||{};o?q(a,n,i):a=R({},a,n),W(this.data,s,a),r.silent||this.emit("added",e,t,n)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?R({},{},this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"toJSON",value:function(){return this.data}}]),t}(Y),ne={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,n,o,i){var r=this;return e.forEach((function(e){r.processors[e]&&(t=r.processors[e].process(t,n,o,i))})),t}},oe={},ie=function(e){function t(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return P(this,t),n=H(this,F(t).call(this)),ee&&Y.call(M(n)),X(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,M(n)),n.options=o,void 0===n.options.keySeparator&&(n.options.keySeparator="."),n.logger=G.create("translator"),n}return N(t,e),I(t,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}},n=this.resolve(e,t);return n&&void 0!==n.res}},{key:"extractFromKey",value:function(e,t){var n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");var o=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,i=t.ns||this.options.defaultNS;if(n&&e.indexOf(n)>-1){var r=e.match(this.interpolator.nestingRegexp);if(r&&r.length>0)return{key:e,namespaces:i};var s=e.split(n);(n!==o||n===o&&this.options.ns.indexOf(s[0])>-1)&&(i=s.shift()),e=s.join(o)}return"string"==typeof i&&(i=[i]),{key:e,namespaces:i}}},{key:"translate",value:function(e,n,o){var i=this;if("object"!==C(n)&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),n||(n={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var r=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,s=this.extractFromKey(e[e.length-1],n),a=s.key,l=s.namespaces,u=l[l.length-1],c=n.lng||this.language,d=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c&&"cimode"===c.toLowerCase()){if(d){var h=n.nsSeparator||this.options.nsSeparator;return u+h+a}return a}var p=this.resolve(e,n),f=p&&p.res,y=p&&p.usedKey||a,g=p&&p.exactUsedKey||a,m=Object.prototype.toString.apply(f),_=["[object Number]","[object Function]","[object RegExp]"],v=void 0!==n.joinArrays?n.joinArrays:this.options.joinArrays,x=!this.i18nFormat||this.i18nFormat.handleAsObject,w="string"!=typeof f&&"boolean"!=typeof f&&"number"!=typeof f;if(x&&f&&w&&_.indexOf(m)<0&&("string"!=typeof v||"[object Array]"!==m)){if(!n.returnObjects&&!this.options.returnObjects)return this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(y,f,n):"key '".concat(a," (").concat(this.language,")' returned an object instead of string.");if(r){var b="[object Array]"===m,k=b?[]:{},S=b?g:y;for(var A in f)if(Object.prototype.hasOwnProperty.call(f,A)){var D="".concat(S).concat(r).concat(A);k[A]=this.translate(D,R({},n,{joinArrays:!1,ns:l})),k[A]===D&&(k[A]=f[A])}f=k}}else if(x&&"string"==typeof v&&"[object Array]"===m)(f=f.join(v))&&(f=this.extendTranslation(f,e,n,o));else{var T=!1,L=!1,O=void 0!==n.count&&"string"!=typeof n.count,P=t.hasDefaultValue(n),E=O?this.pluralResolver.getSuffix(c,n.count):"",I=n["defaultValue".concat(E)]||n.defaultValue;!this.isValidLookup(f)&&P&&(T=!0,f=I),this.isValidLookup(f)||(L=!0,f=a);var M=P&&I!==f&&this.options.updateMissing;if(L||T||M){if(this.logger.log(M?"updateKey":"missingKey",c,u,a,M?I:f),r){var H=this.resolve(a,R({},n,{keySeparator:!1}));H&&H.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var F=[],j=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if("fallback"===this.options.saveMissingTo&&j&&j[0])for(var N=0;N<j.length;N++)F.push(j[N]);else"all"===this.options.saveMissingTo?F=this.languageUtils.toResolveHierarchy(n.lng||this.language):F.push(n.lng||this.language);var B=function(e,t,o){i.options.missingKeyHandler?i.options.missingKeyHandler(e,u,t,M?o:f,M,n):i.backendConnector&&i.backendConnector.saveMissing&&i.backendConnector.saveMissing(e,u,t,M?o:f,M,n),i.emit("missingKey",e,u,t,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&O?F.forEach((function(e){i.pluralResolver.getSuffixes(e).forEach((function(t){B([e],a+t,n["defaultValue".concat(t)]||I)}))})):B(F,a,I))}f=this.extendTranslation(f,e,n,p,o),L&&f===a&&this.options.appendNamespaceToMissingKey&&(f="".concat(u,":").concat(a)),L&&this.options.parseMissingKeyHandler&&(f=this.options.parseMissingKeyHandler(f))}return f}},{key:"extendTranslation",value:function(e,t,n,o,i){var r=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,n,o.usedLng,o.usedNS,o.usedKey,{resolved:o});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init(R({},n,{interpolation:R({},this.options.interpolation,n.interpolation)}));var s,a=n.interpolation&&n.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;if(a){var l=e.match(this.interpolator.nestingRegexp);s=l&&l.length}var u=n.replace&&"string"!=typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(u=R({},this.options.interpolation.defaultVariables,u)),e=this.interpolator.interpolate(e,u,n.lng||this.language,n),a){var c=e.match(this.interpolator.nestingRegexp);s<(c&&c.length)&&(n.nest=!1)}!1!==n.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,o=new Array(e),s=0;s<e;s++)o[s]=arguments[s];return i&&i[0]===o[0]&&!n.context?(r.logger.warn("It seems you are nesting recursively key: ".concat(o[0]," in key: ").concat(t[0])),null):r.translate.apply(r,o.concat([t]))}),n)),n.interpolation&&this.interpolator.reset()}var d=n.postProcess||this.options.postProcess,h="string"==typeof d?[d]:d;return null!=e&&h&&h.length&&!1!==n.applyPostProcessor&&(e=ne.handle(h,e,t,this.options&&this.options.postProcessPassResolved?R({i18nResolved:o},n):n,this)),e}},{key:"resolve",value:function(e){var t,n,o,i,r,s=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!s.isValidLookup(t)){var l=s.extractFromKey(e,a),u=l.key;n=u;var c=l.namespaces;s.options.fallbackNS&&(c=c.concat(s.options.fallbackNS));var d=void 0!==a.count&&"string"!=typeof a.count,h=void 0!==a.context&&"string"==typeof a.context&&""!==a.context,p=a.lngs?a.lngs:s.languageUtils.toResolveHierarchy(a.lng||s.language,a.fallbackLng);c.forEach((function(e){s.isValidLookup(t)||(r=e,!oe["".concat(p[0],"-").concat(e)]&&s.utils&&s.utils.hasLoadedNamespace&&!s.utils.hasLoadedNamespace(r)&&(oe["".concat(p[0],"-").concat(e)]=!0,s.logger.warn('key "'.concat(n,'" for languages "').concat(p.join(", "),'" won\'t get resolved as namespace "').concat(r,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach((function(n){if(!s.isValidLookup(t)){i=n;var r,l,c=u,p=[c];for(s.i18nFormat&&s.i18nFormat.addLookupKeys?s.i18nFormat.addLookupKeys(p,u,n,e,a):(d&&(r=s.pluralResolver.getSuffix(n,a.count)),d&&h&&p.push(c+r),h&&p.push(c+="".concat(s.options.contextSeparator).concat(a.context)),d&&p.push(c+=r));l=p.pop();)s.isValidLookup(t)||(o=l,t=s.getResource(n,e,l,a))}})))}))}})),{res:t,usedKey:n,exactUsedKey:o,usedLng:i,usedNS:r}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,n,o):this.resourceStore.getResource(e,t,n,o)}}],[{key:"hasDefaultValue",value:function(e){var t="defaultValue";for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,t.length)&&void 0!==e[n])return!0;return!1}}]),t}(Y);function re(e){return e.charAt(0).toUpperCase()+e.slice(1)}var se=function(){function e(t){P(this,e),this.options=t,this.whitelist=this.options.supportedLngs||!1,this.supportedLngs=this.options.supportedLngs||!1,this.logger=G.create("languageUtils")}return I(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],n=e.split("-");return this.options.lowerCaseLng?n=n.map((function(e){return e.toLowerCase()})):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=re(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=re(n[1].toLowerCase())),t.indexOf(n[2].toLowerCase())>-1&&(n[2]=re(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isWhitelisted",value:function(e){return this.logger.deprecate("languageUtils.isWhitelisted",'function "isWhitelisted" will be renamed to "isSupportedCode" in the next major - please make sure to rename it\'s usage asap.'),this.isSupportedCode(e)}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,n=this;return e?(e.forEach((function(e){if(!t){var o=n.formatLanguageCode(e);n.options.supportedLngs&&!n.isSupportedCode(o)||(t=o)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var o=n.getLanguagePartFromCode(e);if(n.isSupportedCode(o))return t=o;t=n.options.supportedLngs.find((function(e){if(0===e.indexOf(o))return e}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}},{key:"toResolveHierarchy",value:function(e,t){var n=this,o=this.getFallbackCodes(t||this.options.fallbackLng||[],e),i=[],r=function(e){e&&(n.isSupportedCode(e)?i.push(e):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&r(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&r(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&r(this.getLanguagePartFromCode(e))):"string"==typeof e&&r(this.formatLanguageCode(e)),o.forEach((function(e){i.indexOf(e)<0&&r(n.formatLanguageCode(e))})),i}}]),e}(),ae=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","kk","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],le={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}};function ue(){var e={};return ae.forEach((function(t){t.lngs.forEach((function(n){e[n]={numbers:t.nr,plurals:le[t.fc]}}))})),e}var ce=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};P(this,e),this.languageUtils=t,this.options=n,this.logger=G.create("pluralResolver"),this.rules=ue()}return I(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=this.getRule(e);return t&&t.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){return this.getSuffixes(e).map((function(e){return t+e}))}},{key:"getSuffixes",value:function(e){var t=this,n=this.getRule(e);return n?n.numbers.map((function(n){return t.getSuffix(e,n)})):[]}},{key:"getSuffix",value:function(e,t){var n=this,o=this.getRule(e);if(o){var i=o.noAbs?o.plurals(t):o.plurals(Math.abs(t)),r=o.numbers[i];this.options.simplifyPluralSuffix&&2===o.numbers.length&&1===o.numbers[0]&&(2===r?r="plural":1===r&&(r=""));var s=function(){return n.options.prepend&&r.toString()?n.options.prepend+r.toString():r.toString()};return"v1"===this.options.compatibilityJSON?1===r?"":"number"==typeof r?"_plural_".concat(r.toString()):s():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===o.numbers.length&&1===o.numbers[0]?s():this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString()}return this.logger.warn("no plural rule found for: ".concat(e)),""}}]),e}(),de=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};P(this,e),this.logger=G.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return I(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:J,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?$(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?$(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?$(t.nestingPrefix):t.nestingPrefixEscaped||$("$t("),this.nestingSuffix=t.nestingSuffix?$(t.nestingSuffix):t.nestingSuffixEscaped||$(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function(e,t,n,o){var i,r,s,a=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function u(e){return e.replace(/\$/g,"$$$$")}var c=function(e){if(e.indexOf(a.formatSeparator)<0){var i=Q(t,l,e);return a.alwaysFormat?a.format(i,void 0,n):i}var r=e.split(a.formatSeparator),s=r.shift().trim(),u=r.join(a.formatSeparator).trim();return a.format(Q(t,l,s),u,n,o)};this.resetRegExp();var d=o&&o.missingInterpolationHandler||this.options.missingInterpolationHandler,h=o&&o.interpolation&&o.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return u(e)}},{regex:this.regexp,safeValue:function(e){return a.escapeValue?u(a.escape(e)):u(e)}}].forEach((function(t){for(s=0;i=t.regex.exec(e);){if(void 0===(r=c(i[1].trim())))if("function"==typeof d){var n=d(e,i,o);r="string"==typeof n?n:""}else{if(h){r=i[0];continue}a.logger.warn("missed to pass in variable ".concat(i[1]," for interpolating ").concat(e)),r=""}else"string"==typeof r||a.useRawValueToEscape||(r=K(r));if(e=e.replace(i[0],t.safeValue(r)),t.regex.lastIndex=0,++s>=a.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var n,o,i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=R({},r);function a(e,t){var n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;var o=e.split(new RegExp("".concat(n,"[ ]*{"))),i="{".concat(o[1]);e=o[0],i=(i=this.interpolate(i,s)).replace(/'/g,'"');try{s=JSON.parse(i),t&&(s=R({},t,s))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(n).concat(i)}return delete s.defaultValue,e}for(s.applyPostProcessor=!1,delete s.defaultValue;n=this.nestingRegexp.exec(e);){var l=[],u=!1;if(n[0].includes(this.formatSeparator)&&!/{.*}/.test(n[1])){var c=n[1].split(this.formatSeparator).map((function(e){return e.trim()}));n[1]=c.shift(),l=c,u=!0}if((o=t(a.call(this,n[1].trim(),s),s))&&n[0]===e&&"string"!=typeof o)return o;"string"!=typeof o&&(o=K(o)),o||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(e)),o=""),u&&(o=l.reduce((function(e,t){return i.format(e,t,r.lng,r)}),o.trim())),e=e.replace(n[0],o),this.regexp.lastIndex=0}return e}}]),e}(),he=function(e){function t(e,n,o){var i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return P(this,t),i=H(this,F(t).call(this)),ee&&Y.call(M(i)),i.backend=e,i.store=n,i.services=o,i.languageUtils=o.languageUtils,i.options=r,i.logger=G.create("backendConnector"),i.state={},i.queue=[],i.backend&&i.backend.init&&i.backend.init(o,r.backend,r),i}return N(t,e),I(t,[{key:"queueLoad",value:function(e,t,n,o){var i=this,r=[],s=[],a=[],l=[];return e.forEach((function(e){var o=!0;t.forEach((function(t){var a="".concat(e,"|").concat(t);!n.reload&&i.store.hasResourceBundle(e,t)?i.state[a]=2:i.state[a]<0||(1===i.state[a]?s.indexOf(a)<0&&s.push(a):(i.state[a]=1,o=!1,s.indexOf(a)<0&&s.push(a),r.indexOf(a)<0&&r.push(a),l.indexOf(t)<0&&l.push(t)))})),o||a.push(e)})),(r.length||s.length)&&this.queue.push({pending:s,loaded:{},errors:[],callback:o}),{toLoad:r,pending:s,toLoadLanguages:a,toLoadNamespaces:l}}},{key:"loaded",value:function(e,t,n){var o=e.split("|"),i=o[0],r=o[1];t&&this.emit("failedLoading",i,r,t),n&&this.store.addResourceBundle(i,r,n),this.state[e]=t?-1:2;var s={};this.queue.forEach((function(n){var o,a,l,u,c;o=n.loaded,a=r,(u=(l=U(o,[i],Object)).obj)[c=l.k]=u[c]||[],u[c].push(a),function(e,t){for(var n=e.indexOf(t);-1!==n;)e.splice(n,1),n=e.indexOf(t)}(n.pending,e),t&&n.errors.push(t),0!==n.pending.length||n.done||(Object.keys(n.loaded).forEach((function(e){s[e]||(s[e]=[]),n.loaded[e].length&&n.loaded[e].forEach((function(t){s[e].indexOf(t)<0&&s[e].push(t)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",s),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,n){var o=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:350,s=arguments.length>5?arguments[5]:void 0;return e.length?this.backend[n](e,t,(function(a,l){a&&l&&i<5?setTimeout((function(){o.read.call(o,e,t,n,i+1,2*r,s)}),r):s(a,l)})):s(null,{})}},{key:"prepareLoading",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var r=this.queueLoad(e,t,o,i);if(!r.toLoad.length)return r.pending.length||i(),null;r.toLoad.forEach((function(e){n.loadOne(e)}))}},{key:"load",value:function(e,t,n){this.prepareLoading(e,t,{},n)}},{key:"reload",value:function(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}},{key:"loadOne",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=e.split("|"),i=o[0],r=o[1];this.read(i,r,"read",void 0,void 0,(function(o,s){o&&t.logger.warn("".concat(n,"loading namespace ").concat(r," for language ").concat(i," failed"),o),!o&&s&&t.logger.log("".concat(n,"loaded namespace ").concat(r," for language ").concat(i),s),t.loaded(e,o,s)}))}},{key:"saveMissing",value:function(e,t,n,o,i){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)?this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):null!=n&&""!==n&&(this.backend&&this.backend.create&&this.backend.create(e,t,n,o,null,R({},r,{isUpdate:i})),e&&e[0]&&this.store.addResource(e[0],t,n,o))}}]),t}(Y);function pe(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===C(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===C(e[2])||"object"===C(e[3])){var n=e[3]||e[2];Object.keys(n).forEach((function(e){t[e]=n[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,n,o){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!1}}}function fe(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.whitelist&&(e.whitelist&&e.whitelist.indexOf("cimode")<0&&(e.whitelist=e.whitelist.concat(["cimode"])),e.supportedLngs=e.whitelist),e.nonExplicitWhitelist&&(e.nonExplicitSupportedLngs=e.nonExplicitWhitelist),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function ye(){}const ge=new(function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;if(P(this,t),e=H(this,F(t).call(this)),ee&&Y.call(M(e)),e.options=fe(n),e.services={},e.logger=G,e.modules={external:[]},o&&!e.isInitialized&&!n.isClone){if(!e.options.initImmediate)return e.init(n,o),H(e,M(e));setTimeout((function(){e.init(n,o)}),0)}return e}return N(t,e),I(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;function o(e){return e?"function"==typeof e?new e:e:null}if("function"==typeof t&&(n=t,t={}),t.whitelist&&!t.supportedLngs&&this.logger.deprecate("whitelist",'option "whitelist" will be renamed to "supportedLngs" in the next major - please make sure to rename this option asap.'),t.nonExplicitWhitelist&&!t.nonExplicitSupportedLngs&&this.logger.deprecate("whitelist",'options "nonExplicitWhitelist" will be renamed to "nonExplicitSupportedLngs" in the next major - please make sure to rename this option asap.'),this.options=R({},pe(),this.options,fe(t)),this.format=this.options.interpolation.format,n||(n=ye),!this.options.isClone){this.modules.logger?G.init(o(this.modules.logger),this.options):G.init(null,this.options);var i=new se(this.options);this.store=new te(this.options.resources,this.options);var r=this.services;r.logger=G,r.resourceStore=this.store,r.languageUtils=i,r.pluralResolver=new ce(i,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),r.interpolator=new de(this.options),r.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},r.backendConnector=new he(o(this.modules.backend),r.resourceStore,r,this.options),r.backendConnector.on("*",(function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];e.emit.apply(e,[t].concat(o))})),this.modules.languageDetector&&(r.languageDetector=o(this.modules.languageDetector),r.languageDetector.init(r,this.options.detection,this.options)),this.modules.i18nFormat&&(r.i18nFormat=o(this.modules.i18nFormat),r.i18nFormat.init&&r.i18nFormat.init(this)),this.translator=new ie(this.services,this.options),this.translator.on("*",(function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];e.emit.apply(e,[t].concat(o))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var s=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);s.length>0&&"dev"!==s[0]&&(this.options.lng=s[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");var a=["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"];a.forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments)}}));var l=["addResource","addResources","addResourceBundle","removeResourceBundle"];l.forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments),e}}));var u=V(),c=function(){var t=function(t,o){e.isInitialized&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),u.resolve(o),n(t,o)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?c():setTimeout(c,0),u}},{key:"loadResources",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ye,o=n,i="string"==typeof e?e:this.language;if("function"==typeof e&&(o=e),!this.options.resources||this.options.partialBundledLanguages){if(i&&"cimode"===i.toLowerCase())return o();var r=[],s=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){r.indexOf(e)<0&&r.push(e)}))};if(i)s(i);else{var a=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);a.forEach((function(e){return s(e)}))}this.options.preload&&this.options.preload.forEach((function(e){return s(e)})),this.services.backendConnector.load(r,this.options.ns,o)}else o(null)}},{key:"reloadResources",value:function(e,t,n){var o=V();return e||(e=this.languages),t||(t=this.options.ns),n||(n=ye),this.services.backendConnector.reload(e,t,(function(e){o.resolve(),n(e)})),o}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&ne.addPostProcessor(e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"changeLanguage",value:function(e,t){var n=this;this.isLanguageChangingTo=e;var o=V();this.emit("languageChanging",e);var i=function(e){var i="string"==typeof e?e:n.services.languageUtils.getBestMatchFromCodes(e);i&&(n.language||(n.language=i,n.languages=n.services.languageUtils.toResolveHierarchy(i)),n.translator.language||n.translator.changeLanguage(i),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage(i)),n.loadResources(i,(function(e){!function(e,i){i?(n.language=i,n.languages=n.services.languageUtils.toResolveHierarchy(i),n.translator.changeLanguage(i),n.isLanguageChangingTo=void 0,n.emit("languageChanged",i),n.logger.log("languageChanged",i)):n.isLanguageChangingTo=void 0,o.resolve((function(){return n.t.apply(n,arguments)})),t&&t(e,(function(){return n.t.apply(n,arguments)}))}(e,i)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(i):i(e):i(this.services.languageDetector.detect()),o}},{key:"getFixedT",value:function(e,t){var n=this,o=function e(t,o){var i;if("object"!==C(o)){for(var r=arguments.length,s=new Array(r>2?r-2:0),a=2;a<r;a++)s[a-2]=arguments[a];i=n.options.overloadTranslationOptionHandler([t,o].concat(s))}else i=R({},o);return i.lng=i.lng||e.lng,i.lngs=i.lngs||e.lngs,i.ns=i.ns||e.ns,n.t(t,i)};return"string"==typeof e?o.lng=e:o.lngs=e,o.ns=t,o}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var o=this.languages[0],i=!!this.options&&this.options.fallbackLng,r=this.languages[this.languages.length-1];if("cimode"===o.toLowerCase())return!0;var s=function(e,n){var o=t.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===o||2===o};if(n.precheck){var a=n.precheck(this,s);if(void 0!==a)return a}return!!this.hasResourceBundle(o,e)||!this.services.backendConnector.backend||!(!s(o,e)||i&&!s(r,e))}},{key:"loadNamespaces",value:function(e,t){var n=this,o=V();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){n.options.ns.indexOf(e)<0&&n.options.ns.push(e)})),this.loadResources((function(e){o.resolve(),t&&t(e)})),o):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var n=V();"string"==typeof e&&(e=[e]);var o=this.options.preload||[],i=e.filter((function(e){return o.indexOf(e)<0}));return i.length?(this.options.preload=o.concat(i),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){return e||(e=this.languages&&this.languages.length>0?this.languages[0]:this.language),e?["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>=0?"rtl":"ltr":"rtl"}},{key:"createInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return new t(e,n)}},{key:"cloneInstance",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ye,i=R({},this.options,n,{isClone:!0}),r=new t(i),s=["store","services","language"];return s.forEach((function(t){r[t]=e[t]})),r.services=R({},this.services),r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r.translator=new ie(r.services,r.options),r.translator.on("*",(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];r.emit.apply(r,[e].concat(n))})),r.init(i,o),r.translator.options=r.options,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}}]),t}(Y)),me=JSON.parse('{"shiftLeft":{"name":"Shift Left","description":"Press to move a polyomino to the left once, or hold to engage the Autoshift."},"shiftRight":{"name":"Shift Right","description":"Press to move a polyomino to the right once, or hold to engage the Autoshift."},"hardDrop":{"name":"Hard Drop","description":"Drop a polyomino instantly the floor and lock it in place."},"softDrop":{"name":"Soft Drop","description":"Speed up the descent of a polyomino."},"rotateLeft":{"name":"Rotate Left","description":"Rotate a polyomino 90° counter-clockwise."},"rotateRight":{"name":"Rotate Right","description":"Rotate a polyomino 90° clockwise."},"rotate180":{"name":"Rotate 180°","description":"Rotate a polyomino 180°."},"hold":{"name":"Hold","description":"Send a polyomino to the HOLD Queue."},"retry":{"name":"Retry","description":"Instantly have another attempt in the current mode."},"pause":{"name":"Pause","description":"Pause the game."},"sonicDrop":{"name":"Sonic Drop"},"softDropWithLock":{"name":"Soft Drop with Lock"}}');var _e=n.t(me,2);const ve=JSON.parse('{"style":{"categoryName":"Game Styles","guideline":{"name":"Guideline","description":"The standard variant found in most modern games."},"tetraX":{"name":"Tetra-X","description":"The custom variant designed by Dr Ocelot."},"retro":{"name":"Retro","description":"The classic variant loved by oldschool players."},"arcade":{"name":"Arcade","description":"The difficult variant loved by hardcore players."}},"settings":{"categoryName":"Settings","controls":{"name":"Controls","description":"Customize how the game controls."},"tuning":{"name":"Tuning","description":"Customize how the game handles."},"audio":{"name":"Audio","description":"Customize how the game sounds."},"video":{"name":"Video","description":"Customize how the game looks."}}}');var xe=n.t(ve,2);(function(){return e=this,t=void 0,o=function*(){return yield ge.init({lng:"en-US",fallbackLng:"en-US",debug:a(),resources:{"en-US":{controls:_e,rootMenu:xe}}})},new((n=void 0)||(n=Promise))((function(i,r){function s(e){try{l(o.next(e))}catch(e){r(e)}}function a(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}));var e,t,n,o})().then((()=>{a()&&function(){const e=document.createElement("div");e.classList.add("development-watermark"),e.textContent=`Development Build: ${o.i8}`,document.querySelector("#dev").appendChild(e)}()})),new L,p.setSoundbank(p.soundbanks.tetrax),p.soundbanks.tetrax.instance.play("pieceMove")}},o={};function i(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return n[e](r,r.exports,i),r.exports}t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(n,o){if(1&o&&(n=this(n)),8&o)return n;if("object"==typeof n&&n){if(4&o&&n.__esModule)return n;if(16&o&&"function"==typeof n.then)return n}var r=Object.create(null);i.r(r);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&o&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>n[e]));return s.default=()=>n,i.d(r,s),r},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(416)})();