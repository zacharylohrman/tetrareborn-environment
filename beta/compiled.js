/*! For license information please see compiled.js.LICENSE.txt */
(()=>{var e,t,o={766:(e,t,o)=>{var n;!function(){"use strict";var i=function(){this.init()};i.prototype={init:function(){var e=this||r;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||r;if(e=parseFloat(e),t.ctx||p(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,r.ctx.currentTime);for(var o=0;o<t._howls.length;o++)if(!t._howls[o]._webAudio)for(var n=t._howls[o]._getSoundIds(),i=0;i<n.length;i++){var s=t._howls[o]._soundById(n[i]);s&&s._node&&(s._node.volume=s._volume*e)}return t}return t._volume},mute:function(e){var t=this||r;t.ctx||p(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,r.ctx.currentTime);for(var o=0;o<t._howls.length;o++)if(!t._howls[o]._webAudio)for(var n=t._howls[o]._getSoundIds(),i=0;i<n.length;i++){var s=t._howls[o]._soundById(n[i]);s&&s._node&&(s._node.muted=!!e||s._muted)}return t},stop:function(){for(var e=this||r,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||r,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,p()),e},codecs:function(e){return(this||r)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||r;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||r,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var o=t.canPlayType("audio/mpeg;").replace(/^no$/,""),n=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),i=n&&parseInt(n[0].split("/")[1],10)<33;return e._codecs={mp3:!(i||!o&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!o,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||r;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(o){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,e._releaseHtml5Audio(n)}catch(o){e.noAudio=!0;break}for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var r=e._howls[i]._getSoundIds(),s=0;s<r.length;s++){var a=e._howls[i]._soundById(r[s]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var l=e.ctx.createBufferSource();l.buffer=e._scratchBuffer,l.connect(e.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),l.onended=function(){l.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0);for(var o=0;o<e._howls.length;o++)e._howls[o]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),e}},_obtainHtml5Audio:function(){var e=this||r;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||r;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&r.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var o=0;o<e._howls[t]._sounds.length;o++)if(!e._howls[t]._sounds[o]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&r.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var r=new i,s=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};s.prototype={init:function(e){var t=this;return r.ctx||p(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=r.usingWebAudio&&!t._html5,void 0!==r.ctx&&r.ctx&&r.autoUnlock&&r._unlockAudio(),r._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(r.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var o=0;o<e._src.length;o++){var n,i;if(e._format&&e._format[o])n=e._format[o];else{if("string"!=typeof(i=e._src[o])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(n=/^data:audio\/([^;,]+);/i.exec(i))||(n=/\.([^.]+)$/.exec(i.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&r.codecs(n)){t=e._src[o];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new a(e),e._webAudio&&u(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var o=this,n=null;if("number"==typeof e)n=e,e=null;else{if("string"==typeof e&&"loaded"===o._state&&!o._sprite[e])return null;if(void 0===e&&(e="__default",!o._playLock)){for(var i=0,s=0;s<o._sounds.length;s++)o._sounds[s]._paused&&!o._sounds[s]._ended&&(i++,n=o._sounds[s]._id);1===i?e=null:n=null}}var a=n?o._soundById(n):o._inactiveSound();if(!a)return null;if(n&&!e&&(e=a._sprite||"__default"),"loaded"!==o._state){a._sprite=e,a._ended=!1;var l=a._id;return o._queue.push({event:"play",action:function(){o.play(l)}}),l}if(n&&!a._paused)return t||o._loadQueue("play"),a._id;o._webAudio&&r._autoResume();var u=Math.max(0,a._seek>0?a._seek:o._sprite[e][0]/1e3),c=Math.max(0,(o._sprite[e][0]+o._sprite[e][1])/1e3-u),h=1e3*c/Math.abs(a._rate),d=o._sprite[e][0]/1e3,p=(o._sprite[e][0]+o._sprite[e][1])/1e3;a._sprite=e,a._ended=!1;var f=function(){a._paused=!1,a._seek=u,a._start=d,a._stop=p,a._loop=!(!a._loop&&!o._sprite[e][2])};if(!(u>=p)){var m=a._node;if(o._webAudio){var g=function(){o._playLock=!1,f(),o._refreshBuffer(a);var e=a._muted||o._muted?0:a._volume;m.gain.setValueAtTime(e,r.ctx.currentTime),a._playStart=r.ctx.currentTime,void 0===m.bufferSource.start?a._loop?m.bufferSource.noteGrainOn(0,u,86400):m.bufferSource.noteGrainOn(0,u,c):a._loop?m.bufferSource.start(0,u,86400):m.bufferSource.start(0,u,c),h!==1/0&&(o._endTimers[a._id]=setTimeout(o._ended.bind(o,a),h)),t||setTimeout((function(){o._emit("play",a._id),o._loadQueue()}),0)};"running"===r.state&&"interrupted"!==r.ctx.state?g():(o._playLock=!0,o.once("resume",g),o._clearTimer(a._id))}else{var y=function(){m.currentTime=u,m.muted=a._muted||o._muted||r._muted||m.muted,m.volume=a._volume*r.volume(),m.playbackRate=a._rate;try{var n=m.play();if(n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)?(o._playLock=!0,f(),n.then((function(){o._playLock=!1,m._unlocked=!0,t||(o._emit("play",a._id),o._loadQueue())})).catch((function(){o._playLock=!1,o._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):t||(o._playLock=!1,f(),o._emit("play",a._id),o._loadQueue()),m.playbackRate=a._rate,m.paused)return void o._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||a._loop?o._endTimers[a._id]=setTimeout(o._ended.bind(o,a),h):(o._endTimers[a._id]=function(){o._ended(a),m.removeEventListener("ended",o._endTimers[a._id],!1)},m.addEventListener("ended",o._endTimers[a._id],!1))}catch(e){o._emit("playerror",a._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===m.src&&(m.src=o._src,m.load());var x=window&&window.ejecta||!m.readyState&&r._navigator.isCocoonJS;if(m.readyState>=3||x)y();else{o._playLock=!0;var _=function(){y(),m.removeEventListener(r._canPlayEvent,_,!1)};m.addEventListener(r._canPlayEvent,_,!1),o._clearTimer(a._id)}}return a._id}o._ended(a)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var o=t._getSoundIds(e),n=0;n<o.length;n++){t._clearTimer(o[n]);var i=t._soundById(o[n]);if(i&&!i._paused&&(i._seek=t.seek(o[n]),i._rateSeek=0,i._paused=!0,t._stopFade(o[n]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"stop",action:function(){o.stop(e)}}),o;for(var n=o._getSoundIds(e),i=0;i<n.length;i++){o._clearTimer(n[i]);var r=o._soundById(n[i]);r&&(r._seek=r._start||0,r._rateSeek=0,r._paused=!0,r._ended=!0,o._stopFade(n[i]),r._node&&(o._webAudio?r._node.bufferSource&&(void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),o._cleanBuffer(r._node)):isNaN(r._node.duration)&&r._node.duration!==1/0||(r._node.currentTime=r._start||0,r._node.pause(),r._node.duration===1/0&&o._clearSound(r._node))),t||o._emit("stop",r._id))}return o},mute:function(e,t){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"mute",action:function(){o.mute(e,t)}}),o;if(void 0===t){if("boolean"!=typeof e)return o._muted;o._muted=e}for(var n=o._getSoundIds(t),i=0;i<n.length;i++){var s=o._soundById(n[i]);s&&(s._muted=e,s._interval&&o._stopFade(s._id),o._webAudio&&s._node?s._node.gain.setValueAtTime(e?0:s._volume,r.ctx.currentTime):s._node&&(s._node.muted=!!r._muted||e),o._emit("mute",s._id))}return o},volume:function(){var e,t,o,n=this,i=arguments;if(0===i.length)return n._volume;if(1===i.length||2===i.length&&void 0===i[1]){var s=n._getSoundIds(),a=s.indexOf(i[0]);a>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(o=t?n._soundById(t):n._sounds[0])?o._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,i)}}),n;void 0===t&&(n._volume=e),t=n._getSoundIds(t);for(var l=0;l<t.length;l++)(o=n._soundById(t[l]))&&(o._volume=e,i[2]||n._stopFade(t[l]),n._webAudio&&o._node&&!o._muted?o._node.gain.setValueAtTime(e,r.ctx.currentTime):o._node&&!o._muted&&(o._node.volume=e*r.volume()),n._emit("volume",o._id));return n},fade:function(e,t,o,n){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(e,t,o,n)}}),i;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),o=parseFloat(o),i.volume(e,n);for(var s=i._getSoundIds(n),a=0;a<s.length;a++){var l=i._soundById(s[a]);if(l){if(n||i._stopFade(s[a]),i._webAudio&&!l._muted){var u=r.ctx.currentTime,c=u+o/1e3;l._volume=e,l._node.gain.setValueAtTime(e,u),l._node.gain.linearRampToValueAtTime(t,c)}i._startFadeInterval(l,e,t,o,s[a],void 0===n)}}return i},_startFadeInterval:function(e,t,o,n,i,r){var s=this,a=t,l=o-t,u=Math.abs(l/.01),c=Math.max(4,u>0?n/u:n),h=Date.now();e._fadeTo=o,e._interval=setInterval((function(){var i=(Date.now()-h)/n;h=Date.now(),a+=l*i,a=Math.round(100*a)/100,a=l<0?Math.max(o,a):Math.min(o,a),s._webAudio?e._volume=a:s.volume(a,e._id,!0),r&&(s._volume=a),(o<t&&a<=o||o>t&&a>=o)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,s.volume(o,e._id),s._emit("fade",e._id))}),c)},_stopFade:function(e){var t=this,o=t._soundById(e);return o&&o._interval&&(t._webAudio&&o._node.gain.cancelScheduledValues(r.ctx.currentTime),clearInterval(o._interval),o._interval=null,t.volume(o._fadeTo,e),o._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,o,n=this,i=arguments;if(0===i.length)return n._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(o=n._soundById(parseInt(i[0],10)))&&o._loop;e=i[0],n._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var r=n._getSoundIds(t),s=0;s<r.length;s++)(o=n._soundById(r[s]))&&(o._loop=e,n._webAudio&&o._node&&o._node.bufferSource&&(o._node.bufferSource.loop=e,e&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop)));return n},rate:function(){var e,t,o,n=this,i=arguments;if(0===i.length)t=n._sounds[0]._id;else if(1===i.length){var s=n._getSoundIds(),a=s.indexOf(i[0]);a>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(o=n._soundById(t))?o._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,i)}}),n;void 0===t&&(n._rate=e),t=n._getSoundIds(t);for(var l=0;l<t.length;l++)if(o=n._soundById(t[l])){n.playing(t[l])&&(o._rateSeek=n.seek(t[l]),o._playStart=n._webAudio?r.ctx.currentTime:o._playStart),o._rate=e,n._webAudio&&o._node&&o._node.bufferSource?o._node.bufferSource.playbackRate.setValueAtTime(e,r.ctx.currentTime):o._node&&(o._node.playbackRate=e);var u=n.seek(t[l]),c=(n._sprite[o._sprite][0]+n._sprite[o._sprite][1])/1e3-u,h=1e3*c/Math.abs(o._rate);!n._endTimers[t[l]]&&o._paused||(n._clearTimer(t[l]),n._endTimers[t[l]]=setTimeout(n._ended.bind(n,o),h)),n._emit("rate",o._id)}return n},seek:function(){var e,t,o=this,n=arguments;if(0===n.length)t=o._sounds[0]._id;else if(1===n.length){var i=o._getSoundIds(),s=i.indexOf(n[0]);s>=0?t=parseInt(n[0],10):o._sounds.length&&(t=o._sounds[0]._id,e=parseFloat(n[0]))}else 2===n.length&&(e=parseFloat(n[0]),t=parseInt(n[1],10));if(void 0===t)return o;if("number"==typeof e&&("loaded"!==o._state||o._playLock))return o._queue.push({event:"seek",action:function(){o.seek.apply(o,n)}}),o;var a=o._soundById(t);if(a){if(!("number"==typeof e&&e>=0)){if(o._webAudio){var l=o.playing(t)?r.ctx.currentTime-a._playStart:0,u=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(u+l*Math.abs(a._rate))}return a._node.currentTime}var c=o.playing(t);c&&o.pause(t,!0),a._seek=e,a._ended=!1,o._clearTimer(t),o._webAudio||!a._node||isNaN(a._node.duration)||(a._node.currentTime=e);var h=function(){o._emit("seek",t),c&&o.play(t,!0)};if(c&&!o._webAudio){var d=function(){o._playLock?setTimeout(d,0):h()};setTimeout(d,0)}else h()}return o},playing:function(e){var t=this;if("number"==typeof e){var o=t._soundById(e);return!!o&&!o._paused}for(var n=0;n<t._sounds.length;n++)if(!t._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this,o=t._duration,n=t._soundById(e);return n&&(o=t._sprite[n._sprite][1]/1e3),o},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,o=0;o<t.length;o++)t[o]._paused||e.stop(t[o]._id),e._webAudio||(e._clearSound(t[o]._node),t[o]._node.removeEventListener("error",t[o]._errorFn,!1),t[o]._node.removeEventListener(r._canPlayEvent,t[o]._loadFn,!1),t[o]._node.removeEventListener("ended",t[o]._endFn,!1),r._releaseHtml5Audio(t[o]._node)),delete t[o]._node,e._clearTimer(t[o]._id);var n=r._howls.indexOf(e);n>=0&&r._howls.splice(n,1);var i=!0;for(o=0;o<r._howls.length;o++)if(r._howls[o]._src===e._src||e._src.indexOf(r._howls[o]._src)>=0){i=!1;break}return l&&i&&delete l[e._src],r.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,o,n){var i=this["_on"+e];return"function"==typeof t&&i.push(n?{id:o,fn:t,once:n}:{id:o,fn:t}),this},off:function(e,t,o){var n=this,i=n["_on"+e],r=0;if("number"==typeof t&&(o=t,t=null),t||o)for(r=0;r<i.length;r++){var s=o===i[r].id;if(t===i[r].fn&&s||!t&&s){i.splice(r,1);break}}else if(e)n["_on"+e]=[];else{var a=Object.keys(n);for(r=0;r<a.length;r++)0===a[r].indexOf("_on")&&Array.isArray(n[a[r]])&&(n[a[r]]=[])}return n},once:function(e,t,o){return this.on(e,t,o,1),this},_emit:function(e,t,o){for(var n=this,i=n["_on"+e],r=i.length-1;r>=0;r--)i[r].id&&i[r].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,o)}.bind(n,i[r].fn),0),i[r].once&&n.off(e,i[r].fn,i[r].id));return n._loadQueue(e),n},_loadQueue:function(e){var t=this;if(t._queue.length>0){var o=t._queue[0];o.event===e&&(t._queue.shift(),t._loadQueue()),e||o.action()}return t},_ended:function(e){var t=this,o=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var n=!(!e._loop&&!t._sprite[o][2]);if(t._emit("end",e._id),!t._webAudio&&n&&t.stop(e._id,!0).play(e._id),t._webAudio&&n){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=r.ctx.currentTime;var i=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),i)}return t._webAudio&&!n&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),r._autoSuspend()),t._webAudio||n||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var o=t._soundById(e);o&&o._node&&o._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,o=0;o<t._sounds.length;o++)if(e===t._sounds[o]._id)return t._sounds[o];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new a(e)},_drain:function(){var e=this,t=e._pool,o=0,n=0;if(!(e._sounds.length<t)){for(n=0;n<e._sounds.length;n++)e._sounds[n]._ended&&o++;for(n=e._sounds.length-1;n>=0;n--){if(o<=t)return;e._sounds[n]._ended&&(e._webAudio&&e._sounds[n]._node&&e._sounds[n]._node.disconnect(0),e._sounds.splice(n,1),o--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],o=0;o<this._sounds.length;o++)t.push(this._sounds[o]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=r.ctx.createBufferSource(),e._node.bufferSource.buffer=l[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,r.ctx.currentTime),this},_cleanBuffer:function(e){var t=r._navigator&&r._navigator.vendor.indexOf("Apple")>=0;if(r._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=r._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(r._navigator&&r._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(e){this._parent=e,this.init()};a.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++r._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,o=r._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===r.ctx.createGain?r.ctx.createGainNode():r.ctx.createGain(),e._node.gain.setValueAtTime(o,r.ctx.currentTime),e._node.paused=!0,e._node.connect(r.masterGain)):r.noAudio||(e._node=r._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(r._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=o*r.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++r._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(r._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var l={},u=function(e){var t=e._src;if(l[t])return e._duration=l[t].duration,void d(e);if(/^data:[^;]+;base64,/.test(t)){for(var o=atob(t.split(",")[1]),n=new Uint8Array(o.length),i=0;i<o.length;++i)n[i]=o.charCodeAt(i);h(n.buffer,e)}else{var r=new XMLHttpRequest;r.open(e._xhr.method,t,!0),r.withCredentials=e._xhr.withCredentials,r.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){r.setRequestHeader(t,e._xhr.headers[t])})),r.onload=function(){var t=(r.status+"")[0];"0"===t||"2"===t||"3"===t?h(r.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+r.status+".")},r.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete l[t],e.load())},c(r)}},c=function(e){try{e.send()}catch(t){e.onerror()}},h=function(e,t){var o=function(){t._emit("loaderror",null,"Decoding audio data failed.")},n=function(e){e&&t._sounds.length>0?(l[t._src]=e,d(t,e)):o()};"undefined"!=typeof Promise&&1===r.ctx.decodeAudioData.length?r.ctx.decodeAudioData(e).then(n).catch(o):r.ctx.decodeAudioData(e,n,o)},d=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},p=function(){if(r.usingWebAudio){try{"undefined"!=typeof AudioContext?r.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?r.ctx=new webkitAudioContext:r.usingWebAudio=!1}catch(e){r.usingWebAudio=!1}r.ctx||(r.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(r._navigator&&r._navigator.platform),t=r._navigator&&r._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),o=t?parseInt(t[1],10):null;if(e&&o&&o<9){var n=/safari/.test(r._navigator&&r._navigator.userAgent.toLowerCase());r._navigator&&!n&&(r.usingWebAudio=!1)}r.usingWebAudio&&(r.masterGain=void 0===r.ctx.createGain?r.ctx.createGainNode():r.ctx.createGain(),r.masterGain.gain.setValueAtTime(r._muted?0:r._volume,r.ctx.currentTime),r.masterGain.connect(r.ctx.destination)),r._setup()}};void 0===(n=function(){return{Howler:r,Howl:s}}.apply(t,[]))||(e.exports=n),t.Howler=r,t.Howl=s,void 0!==o.g?(o.g.HowlerGlobal=i,o.g.Howler=r,o.g.Howl=s,o.g.Sound=a):"undefined"!=typeof window&&(window.HowlerGlobal=i,window.Howler=r,window.Howl=s,window.Sound=a)}(),function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var o=t._howls.length-1;o>=0;o--)t._howls[o].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,o){var n=this;return n.ctx&&n.ctx.listener?(t="number"!=typeof t?n._pos[1]:t,o="number"!=typeof o?n._pos[2]:o,"number"!=typeof e?n._pos:(n._pos=[e,t,o],void 0!==n.ctx.listener.positionX?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]),n)):n},HowlerGlobal.prototype.orientation=function(e,t,o,n,i,r){var s=this;if(!s.ctx||!s.ctx.listener)return s;var a=s._orientation;return t="number"!=typeof t?a[1]:t,o="number"!=typeof o?a[2]:o,n="number"!=typeof n?a[3]:n,i="number"!=typeof i?a[4]:i,r="number"!=typeof r?a[5]:r,"number"!=typeof e?a:(s._orientation=[e,t,o,n,i,r],void 0!==s.ctx.listener.forwardX?(s.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),s.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),s.ctx.listener.forwardZ.setTargetAtTime(o,Howler.ctx.currentTime,.1),s.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),s.ctx.listener.upY.setTargetAtTime(i,Howler.ctx.currentTime,.1),s.ctx.listener.upZ.setTargetAtTime(r,Howler.ctx.currentTime,.1)):s.ctx.listener.setOrientation(e,t,o,n,i,r),s)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var o=this;return o._orientation=t.orientation||[1,0,0],o._stereo=t.stereo||null,o._pos=t.pos||null,o._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},o._onstereo=t.onstereo?[{fn:t.onstereo}]:[],o._onpos=t.onpos?[{fn:t.onpos}]:[],o._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,o){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,o)}}),n;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===o){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var r=n._getSoundIds(o),s=0;s<r.length;s++){var a=n._soundById(r[s]);if(a){if("number"!=typeof e)return a._stereo;a._stereo=e,a._pos=[e,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||t(a,i),"spatial"===i?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(e,0,0):a._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),n._emit("stereo",a._id)}}return n},Howl.prototype.pos=function(e,o,n,i){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"pos",action:function(){r.pos(e,o,n,i)}}),r;if(o="number"!=typeof o?0:o,n="number"!=typeof n?-.5:n,void 0===i){if("number"!=typeof e)return r._pos;r._pos=[e,o,n]}for(var s=r._getSoundIds(i),a=0;a<s.length;a++){var l=r._soundById(s[a]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,o,n],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(o,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setPosition(e,o,n)),r._emit("pos",l._id)}}return r},Howl.prototype.orientation=function(e,o,n,i){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"orientation",action:function(){r.orientation(e,o,n,i)}}),r;if(o="number"!=typeof o?r._orientation[1]:o,n="number"!=typeof n?r._orientation[2]:n,void 0===i){if("number"!=typeof e)return r._orientation;r._orientation=[e,o,n]}for(var s=r._getSoundIds(i),a=0;a<s.length;a++){var l=r._soundById(s[a]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,o,n],l._node&&(l._panner||(l._pos||(l._pos=r._pos||[0,0,-.5]),t(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(o,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setOrientation(e,o,n)),r._emit("orientation",l._id)}}return r},Howl.prototype.pannerAttr=function(){var e,o,n,i=this,r=arguments;if(!i._webAudio)return i;if(0===r.length)return i._pannerAttr;if(1===r.length){if("object"!=typeof r[0])return(n=i._soundById(parseInt(r[0],10)))?n._pannerAttr:i._pannerAttr;e=r[0],void 0===o&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===r.length&&(e=r[0],o=parseInt(r[1],10));for(var s=i._getSoundIds(o),a=0;a<s.length;a++)if(n=i._soundById(s[a])){var l=n._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var u=n._panner;u?(u.coneInnerAngle=l.coneInnerAngle,u.coneOuterAngle=l.coneOuterAngle,u.coneOuterGain=l.coneOuterGain,u.distanceModel=l.distanceModel,u.maxDistance=l.maxDistance,u.refDistance=l.refDistance,u.rolloffFactor=l.rolloffFactor,u.panningModel=l.panningModel):(n._pos||(n._pos=i._pos||[0,0,-.5]),t(n,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this,o=t._parent;t._orientation=o._orientation,t._stereo=o._stereo,t._pos=o._pos,t._pannerAttr=o._pannerAttr,e.call(this),t._stereo?o.stereo(t._stereo):t._pos&&o.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,o=t._parent;return t._orientation=o._orientation,t._stereo=o._stereo,t._pos=o._pos,t._pannerAttr=o._pannerAttr,t._stereo?o.stereo(t._stereo):t._pos?o.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,o._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()},342:(e,t,o)=>{"use strict";var n=o(766);const i={src:["res/se/tetrax/tetrax.ogg","res/se/tetrax/tetrax.m4a","res/se/tetrax/tetrax.mp3","res/se/tetrax/tetrax.ac3"],sprite:{alarm:[0,1017.8684807256235],b2bContinue:[3e3,2218.7528344671196],bufferedHold:[7e3,1453.2653061224482],bufferedRotate:[1e4,890.8390022675743],bufferedSkip:[12e3,1918.9795918367345],collapse:[15e3,1698.2312925170077],combo01:[18e3,2477.68707482993],combo02:[22e3,2477.68707482993],combo03:[26e3,2477.68707482993],combo04:[3e4,2477.68707482993],combo05:[34e3,2477.68707482993],combo06:[38e3,2477.68707482993],combo07:[42e3,2477.68707482993],combo08:[46e3,2473.2199546485276],combo09:[5e4,2473.2199546485276],combo10:[54e3,1928.5714285714307],combo11:[57e3,1901.7913832199583],combo12:[6e4,1879.455782312924],combo13:[63e3,1861.6099773242638],combo14:[66e3,3315.8730158730095],combo15:[71e3,3417.1428571428632],combo16:[76e3,3564.557823129249],combo17:[81e3,3495.1020408163204],combo18:[86e3,3490.8163265306057],combo19:[91e3,3489.841269841264],deathWarning:[96e3,810.8163265306132],erase1:[98e3,1454.6258503401361],erase2:[101e3,1586.1904761904811],erase3:[104e3,1688.0498866213145],erase4:[107e3,1718.752834467125],gameDeath:[11e4,3156.780045351468],gameGo:[115e3,3210.408163265299],gameOver:[12e4,1973.2199546485276],gameReady:[123e3,3092.4716553287935],gameStart:[128e3,3101.882086167791],gameVictory:[133e3,3251.7460317460236],garbageFlyHit:[138e3,1946.4399092970552],garbageFlyReceive:[141e3,1939.31972789116],garbageFlySend:[144e3,3301.315192743772],garbageSpawn:[149e3,2287.188208616783],levelUp:[153e3,2070.3628117913695],lockWithoutHardDrop:[157e3,847.8684807256229],outOfResets:[159e3,3247.98185941043],pause:[164e3,3253.9455782312816],perfectClear:[169e3,3338.730158730158],pieceHardDrop:[174e3,970.226757369602],pieceHold:[176e3,853.6961451247294],pieceLand:[178e3,1092.5623582766377],pieceMove:[181e3,992.3356009070403],pieceRotate:[183e3,1124.8526077097551],pieceRotateT:[186e3,1667.1882086167784],pieceRotateTMini:[189e3,2221.904761904767],pieceSkip:[193e3,1108.5260770975083],pieceSlide:[196e3,370.29478458049425],pieceWallkick:[198e3,1340.5668934240396],tSpin0:[201e3,2197.9138321995606],tSpin1:[205e3,2197.9138321995606],tSpin2:[209e3,2322.9251700680325],tSpin3:[213e3,2505.215419501127],tSpinMini0:[217e3,2197.9138321995606],tSpinMini1:[221e3,2197.9138321995606],tSpinMini2:[225e3,2322.9251700680325]}};class r{static loadSounds(e){null==e.instance&&(e.instance=new n.Howl(e.data.howlOptions),r.updateVolume())}static add(e,t=r.currentSoundbank){r.soundQueue[e]=t}static playQueue(){for(const e of Object.keys(r.soundQueue)){const t=r.soundQueue[e];null!=(null==t?void 0:t.data.eventAssignments[e])?(t.instance.play(t.data.eventAssignments[e]),delete r.soundQueue[e]):delete r.soundQueue[e]}}static updateVolume(){for(const e of Object.keys(r.soundbanks)){const t=r.soundbanks[e];null!=t.instance&&t.instance.volume(.25)}}static setSoundbank(e){r.loadSounds(e),r.currentSoundbank=e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter((function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})))),n.forEach((function(t){a(e,t,o[t])}))}return e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,o){return t&&c(e.prototype,t),o&&c(e,o),e}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?d(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}r.soundQueue={},r.soundbanks={tetrax:{data:new class{constructor(){this.howlOptions=i,this.eventAssignments={pieceMove:"pieceMove",pieceRotate:"pieceRotate",pieceRotateT:"pieceRotateT",pieceRotateTMini:"pieceRotateTMini",pieceWallkick:"pieceWallkick",pieceHold:"pieceHold",pieceSlide:"pieceSlide",pieceLand:"pieceLand",outOfResets:"outOfResets",bufferedHold:"bufferedHold",bufferedRotate:"bufferedRotate",bufferedSkip:"bufferedSkip",pieceHardDrop:"pieceHardDrop",lockWithoutHardDrop:"lockWithoutHardDrop",collapse:"collapse",erase1:"erase1",erase2:"erase2",erase3:"erase3",erase4:"erase4",tSpin0:"tSpin0",tSpin1:"tSpin1",tSpin2:"tSpin2",tSpin3:"tSpin3",tSpinMini0:"tSpinMini0",tSpinMini1:"tSpinMini1",tSpinMini2:"tSpinMini2",perfectClear:"perfectClear",levelUp:"levelUp"}}},instance:null}};var y={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},x=new(function(){function e(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u(this,e),this.init(t,o)}return h(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||y,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,o,n){return n&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(o).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,l({},{prefix:"".concat(this.prefix,":").concat(t,":")},this.options))}}]),e}()),_=function(){function e(){u(this,e),this.observers={}}return h(e,[{key:"on",value:function(e,t){var o=this;return e.split(" ").forEach((function(e){o.observers[e]=o.observers[e]||[],o.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];if(this.observers[e]){var i=[].concat(this.observers[e]);i.forEach((function(e){e.apply(void 0,o)}))}if(this.observers["*"]){var r=[].concat(this.observers["*"]);r.forEach((function(t){t.apply(t,[e].concat(o))}))}}}]),e}();function v(){var e,t,o=new Promise((function(o,n){e=o,t=n}));return o.resolve=e,o.reject=t,o}function k(e){return null==e?"":""+e}function w(e,t,o){e.forEach((function(e){t[e]&&(o[e]=t[e])}))}function b(e,t,o){function n(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function i(){return!e||"string"==typeof e}for(var r="string"!=typeof t?[].concat(t):t.split(".");r.length>1;){if(i())return{};var s=n(r.shift());!e[s]&&o&&(e[s]=new o),e=Object.prototype.hasOwnProperty.call(e,s)?e[s]:{}}return i()?{}:{obj:e,k:n(r.shift())}}function S(e,t,o){var n=b(e,t,Object);n.obj[n.k]=o}function A(e,t){var o=b(e,t),n=o.obj,i=o.k;if(n)return n[i]}function D(e,t,o){var n=A(e,o);return void 0!==n?n:A(t,o)}function C(e,t,o){for(var n in t)"__proto__"!==n&&"constructor"!==n&&(n in e?"string"==typeof e[n]||e[n]instanceof String||"string"==typeof t[n]||t[n]instanceof String?o&&(e[n]=t[n]):C(e[n],t[n],o):e[n]=t[n]);return e}function T(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var L={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function R(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return L[e]})):e}var O="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,P=function(e){function t(e){var o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return u(this,t),o=p(this,f(t).call(this)),O&&_.call(d(o)),o.data=e||{},o.options=n,void 0===o.options.keySeparator&&(o.options.keySeparator="."),o}return g(t,e),h(t,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,o){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,r=[e,t];return o&&"string"!=typeof o&&(r=r.concat(o)),o&&"string"==typeof o&&(r=r.concat(i?o.split(i):o)),e.indexOf(".")>-1&&(r=e.split(".")),A(this.data,r)}},{key:"addResource",value:function(e,t,o,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},r=this.options.keySeparator;void 0===r&&(r=".");var s=[e,t];o&&(s=s.concat(r?o.split(r):o)),e.indexOf(".")>-1&&(n=t,t=(s=e.split("."))[1]),this.addNamespaces(t),S(this.data,s,n),i.silent||this.emit("added",e,t,o,n)}},{key:"addResources",value:function(e,t,o){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var i in o)"string"!=typeof o[i]&&"[object Array]"!==Object.prototype.toString.apply(o[i])||this.addResource(e,t,i,o[i],{silent:!0});n.silent||this.emit("added",e,t,o)}},{key:"addResourceBundle",value:function(e,t,o,n,i){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},s=[e,t];e.indexOf(".")>-1&&(n=o,o=t,t=(s=e.split("."))[1]),this.addNamespaces(t);var a=A(this.data,s)||{};n?C(a,o,i):a=l({},a,o),S(this.data,s,a),r.silent||this.emit("added",e,t,o)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?l({},{},this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"toJSON",value:function(){return this.data}}]),t}(_),E={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,o,n,i){var r=this;return e.forEach((function(e){r.processors[e]&&(t=r.processors[e].process(t,o,n,i))})),t}},M={},F=function(e){function t(e){var o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u(this,t),o=p(this,f(t).call(this)),O&&_.call(d(o)),w(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,d(o)),o.options=n,void 0===o.options.keySeparator&&(o.options.keySeparator="."),o.logger=x.create("translator"),o}return g(t,e),h(t,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}},o=this.resolve(e,t);return o&&void 0!==o.res}},{key:"extractFromKey",value:function(e,t){var o=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===o&&(o=":");var n=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,i=t.ns||this.options.defaultNS;if(o&&e.indexOf(o)>-1){var r=e.match(this.interpolator.nestingRegexp);if(r&&r.length>0)return{key:e,namespaces:i};var s=e.split(o);(o!==n||o===n&&this.options.ns.indexOf(s[0])>-1)&&(i=s.shift()),e=s.join(n)}return"string"==typeof i&&(i=[i]),{key:e,namespaces:i}}},{key:"translate",value:function(e,o,n){var i=this;if("object"!==s(o)&&this.options.overloadTranslationOptionHandler&&(o=this.options.overloadTranslationOptionHandler(arguments)),o||(o={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var r=void 0!==o.keySeparator?o.keySeparator:this.options.keySeparator,a=this.extractFromKey(e[e.length-1],o),u=a.key,c=a.namespaces,h=c[c.length-1],d=o.lng||this.language,p=o.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(d&&"cimode"===d.toLowerCase()){if(p){var f=o.nsSeparator||this.options.nsSeparator;return h+f+u}return u}var m=this.resolve(e,o),g=m&&m.res,y=m&&m.usedKey||u,x=m&&m.exactUsedKey||u,_=Object.prototype.toString.apply(g),v=["[object Number]","[object Function]","[object RegExp]"],k=void 0!==o.joinArrays?o.joinArrays:this.options.joinArrays,w=!this.i18nFormat||this.i18nFormat.handleAsObject,b="string"!=typeof g&&"boolean"!=typeof g&&"number"!=typeof g;if(w&&g&&b&&v.indexOf(_)<0&&("string"!=typeof k||"[object Array]"!==_)){if(!o.returnObjects&&!this.options.returnObjects)return this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(y,g,o):"key '".concat(u," (").concat(this.language,")' returned an object instead of string.");if(r){var S="[object Array]"===_,A=S?[]:{},D=S?x:y;for(var C in g)if(Object.prototype.hasOwnProperty.call(g,C)){var T="".concat(D).concat(r).concat(C);A[C]=this.translate(T,l({},o,{joinArrays:!1,ns:c})),A[C]===T&&(A[C]=g[C])}g=A}}else if(w&&"string"==typeof k&&"[object Array]"===_)(g=g.join(k))&&(g=this.extendTranslation(g,e,o,n));else{var L=!1,R=!1,O=void 0!==o.count&&"string"!=typeof o.count,P=t.hasDefaultValue(o),E=O?this.pluralResolver.getSuffix(d,o.count):"",M=o["defaultValue".concat(E)]||o.defaultValue;!this.isValidLookup(g)&&P&&(L=!0,g=M),this.isValidLookup(g)||(R=!0,g=u);var F=P&&M!==g&&this.options.updateMissing;if(R||L||F){if(this.logger.log(F?"updateKey":"missingKey",d,h,u,F?M:g),r){var H=this.resolve(u,l({},o,{keySeparator:!1}));H&&H.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var I=[],j=this.languageUtils.getFallbackCodes(this.options.fallbackLng,o.lng||this.language);if("fallback"===this.options.saveMissingTo&&j&&j[0])for(var B=0;B<j.length;B++)I.push(j[B]);else"all"===this.options.saveMissingTo?I=this.languageUtils.toResolveHierarchy(o.lng||this.language):I.push(o.lng||this.language);var N=function(e,t,n){i.options.missingKeyHandler?i.options.missingKeyHandler(e,h,t,F?n:g,F,o):i.backendConnector&&i.backendConnector.saveMissing&&i.backendConnector.saveMissing(e,h,t,F?n:g,F,o),i.emit("missingKey",e,h,t,g)};this.options.saveMissing&&(this.options.saveMissingPlurals&&O?I.forEach((function(e){i.pluralResolver.getSuffixes(e).forEach((function(t){N([e],u+t,o["defaultValue".concat(t)]||M)}))})):N(I,u,M))}g=this.extendTranslation(g,e,o,m,n),R&&g===u&&this.options.appendNamespaceToMissingKey&&(g="".concat(h,":").concat(u)),R&&this.options.parseMissingKeyHandler&&(g=this.options.parseMissingKeyHandler(g))}return g}},{key:"extendTranslation",value:function(e,t,o,n,i){var r=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,o,n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!o.skipInterpolation){o.interpolation&&this.interpolator.init(l({},o,{interpolation:l({},this.options.interpolation,o.interpolation)}));var s,a=o.interpolation&&o.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;if(a){var u=e.match(this.interpolator.nestingRegexp);s=u&&u.length}var c=o.replace&&"string"!=typeof o.replace?o.replace:o;if(this.options.interpolation.defaultVariables&&(c=l({},this.options.interpolation.defaultVariables,c)),e=this.interpolator.interpolate(e,c,o.lng||this.language,o),a){var h=e.match(this.interpolator.nestingRegexp);s<(h&&h.length)&&(o.nest=!1)}!1!==o.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return i&&i[0]===n[0]&&!o.context?(r.logger.warn("It seems you are nesting recursively key: ".concat(n[0]," in key: ").concat(t[0])),null):r.translate.apply(r,n.concat([t]))}),o)),o.interpolation&&this.interpolator.reset()}var d=o.postProcess||this.options.postProcess,p="string"==typeof d?[d]:d;return null!=e&&p&&p.length&&!1!==o.applyPostProcessor&&(e=E.handle(p,e,t,this.options&&this.options.postProcessPassResolved?l({i18nResolved:n},o):o,this)),e}},{key:"resolve",value:function(e){var t,o,n,i,r,s=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!s.isValidLookup(t)){var l=s.extractFromKey(e,a),u=l.key;o=u;var c=l.namespaces;s.options.fallbackNS&&(c=c.concat(s.options.fallbackNS));var h=void 0!==a.count&&"string"!=typeof a.count,d=void 0!==a.context&&"string"==typeof a.context&&""!==a.context,p=a.lngs?a.lngs:s.languageUtils.toResolveHierarchy(a.lng||s.language,a.fallbackLng);c.forEach((function(e){s.isValidLookup(t)||(r=e,!M["".concat(p[0],"-").concat(e)]&&s.utils&&s.utils.hasLoadedNamespace&&!s.utils.hasLoadedNamespace(r)&&(M["".concat(p[0],"-").concat(e)]=!0,s.logger.warn('key "'.concat(o,'" for languages "').concat(p.join(", "),'" won\'t get resolved as namespace "').concat(r,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach((function(o){if(!s.isValidLookup(t)){i=o;var r,l,c=u,p=[c];for(s.i18nFormat&&s.i18nFormat.addLookupKeys?s.i18nFormat.addLookupKeys(p,u,o,e,a):(h&&(r=s.pluralResolver.getSuffix(o,a.count)),h&&d&&p.push(c+r),d&&p.push(c+="".concat(s.options.contextSeparator).concat(a.context)),h&&p.push(c+=r));l=p.pop();)s.isValidLookup(t)||(n=l,t=s.getResource(o,e,l,a))}})))}))}})),{res:t,usedKey:o,exactUsedKey:n,usedLng:i,usedNS:r}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,o){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,o,n):this.resourceStore.getResource(e,t,o,n)}}],[{key:"hasDefaultValue",value:function(e){var t="defaultValue";for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)&&t===o.substring(0,t.length)&&void 0!==e[o])return!0;return!1}}]),t}(_);function H(e){return e.charAt(0).toUpperCase()+e.slice(1)}var I=function(){function e(t){u(this,e),this.options=t,this.whitelist=this.options.supportedLngs||!1,this.supportedLngs=this.options.supportedLngs||!1,this.logger=x.create("languageUtils")}return h(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],o=e.split("-");return this.options.lowerCaseLng?o=o.map((function(e){return e.toLowerCase()})):2===o.length?(o[0]=o[0].toLowerCase(),o[1]=o[1].toUpperCase(),t.indexOf(o[1].toLowerCase())>-1&&(o[1]=H(o[1].toLowerCase()))):3===o.length&&(o[0]=o[0].toLowerCase(),2===o[1].length&&(o[1]=o[1].toUpperCase()),"sgn"!==o[0]&&2===o[2].length&&(o[2]=o[2].toUpperCase()),t.indexOf(o[1].toLowerCase())>-1&&(o[1]=H(o[1].toLowerCase())),t.indexOf(o[2].toLowerCase())>-1&&(o[2]=H(o[2].toLowerCase()))),o.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isWhitelisted",value:function(e){return this.logger.deprecate("languageUtils.isWhitelisted",'function "isWhitelisted" will be renamed to "isSupportedCode" in the next major - please make sure to rename it\'s usage asap.'),this.isSupportedCode(e)}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,o=this;return e?(e.forEach((function(e){if(!t){var n=o.formatLanguageCode(e);o.options.supportedLngs&&!o.isSupportedCode(n)||(t=n)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var n=o.getLanguagePartFromCode(e);if(o.isSupportedCode(n))return t=n;t=o.options.supportedLngs.find((function(e){if(0===e.indexOf(n))return e}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var o=e[t];return o||(o=e[this.getScriptPartFromCode(t)]),o||(o=e[this.formatLanguageCode(t)]),o||(o=e[this.getLanguagePartFromCode(t)]),o||(o=e.default),o||[]}},{key:"toResolveHierarchy",value:function(e,t){var o=this,n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),i=[],r=function(e){e&&(o.isSupportedCode(e)?i.push(e):o.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&r(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&r(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&r(this.getLanguagePartFromCode(e))):"string"==typeof e&&r(this.formatLanguageCode(e)),n.forEach((function(e){i.indexOf(e)<0&&r(o.formatLanguageCode(e))})),i}}]),e}(),j=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","kk","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],B={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}};function N(){var e={};return j.forEach((function(t){t.lngs.forEach((function(o){e[o]={numbers:t.nr,plurals:B[t.fc]}}))})),e}var G=function(){function e(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u(this,e),this.languageUtils=t,this.options=o,this.logger=x.create("pluralResolver"),this.rules=N()}return h(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=this.getRule(e);return t&&t.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){return this.getSuffixes(e).map((function(e){return t+e}))}},{key:"getSuffixes",value:function(e){var t=this,o=this.getRule(e);return o?o.numbers.map((function(o){return t.getSuffix(e,o)})):[]}},{key:"getSuffix",value:function(e,t){var o=this,n=this.getRule(e);if(n){var i=n.noAbs?n.plurals(t):n.plurals(Math.abs(t)),r=n.numbers[i];this.options.simplifyPluralSuffix&&2===n.numbers.length&&1===n.numbers[0]&&(2===r?r="plural":1===r&&(r=""));var s=function(){return o.options.prepend&&r.toString()?o.options.prepend+r.toString():r.toString()};return"v1"===this.options.compatibilityJSON?1===r?"":"number"==typeof r?"_plural_".concat(r.toString()):s():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===n.numbers.length&&1===n.numbers[0]?s():this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString()}return this.logger.warn("no plural rule found for: ".concat(e)),""}}]),e}(),Y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,e),this.logger=x.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return h(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:R,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?T(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?T(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?T(t.nestingPrefix):t.nestingPrefixEscaped||T("$t("),this.nestingSuffix=t.nestingSuffix?T(t.nestingSuffix):t.nestingSuffixEscaped||T(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var o="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(o,"g")}},{key:"interpolate",value:function(e,t,o,n){var i,r,s,a=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function u(e){return e.replace(/\$/g,"$$$$")}var c=function(e){if(e.indexOf(a.formatSeparator)<0){var i=D(t,l,e);return a.alwaysFormat?a.format(i,void 0,o):i}var r=e.split(a.formatSeparator),s=r.shift().trim(),u=r.join(a.formatSeparator).trim();return a.format(D(t,l,s),u,o,n)};this.resetRegExp();var h=n&&n.missingInterpolationHandler||this.options.missingInterpolationHandler,d=n&&n.interpolation&&n.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return u(e)}},{regex:this.regexp,safeValue:function(e){return a.escapeValue?u(a.escape(e)):u(e)}}].forEach((function(t){for(s=0;i=t.regex.exec(e);){if(void 0===(r=c(i[1].trim())))if("function"==typeof h){var o=h(e,i,n);r="string"==typeof o?o:""}else{if(d){r=i[0];continue}a.logger.warn("missed to pass in variable ".concat(i[1]," for interpolating ").concat(e)),r=""}else"string"==typeof r||a.useRawValueToEscape||(r=k(r));if(e=e.replace(i[0],t.safeValue(r)),t.regex.lastIndex=0,++s>=a.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var o,n,i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=l({},r);function a(e,t){var o=this.nestingOptionsSeparator;if(e.indexOf(o)<0)return e;var n=e.split(new RegExp("".concat(o,"[ ]*{"))),i="{".concat(n[1]);e=n[0],i=(i=this.interpolate(i,s)).replace(/'/g,'"');try{s=JSON.parse(i),t&&(s=l({},t,s))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(o).concat(i)}return delete s.defaultValue,e}for(s.applyPostProcessor=!1,delete s.defaultValue;o=this.nestingRegexp.exec(e);){var u=[],c=!1;if(o[0].includes(this.formatSeparator)&&!/{.*}/.test(o[1])){var h=o[1].split(this.formatSeparator).map((function(e){return e.trim()}));o[1]=h.shift(),u=h,c=!0}if((n=t(a.call(this,o[1].trim(),s),s))&&o[0]===e&&"string"!=typeof n)return n;"string"!=typeof n&&(n=k(n)),n||(this.logger.warn("missed to resolve ".concat(o[1]," for nesting ").concat(e)),n=""),c&&(n=u.reduce((function(e,t){return i.format(e,t,r.lng,r)}),n.trim())),e=e.replace(o[0],n),this.regexp.lastIndex=0}return e}}]),e}(),U=function(e){function t(e,o,n){var i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return u(this,t),i=p(this,f(t).call(this)),O&&_.call(d(i)),i.backend=e,i.store=o,i.services=n,i.languageUtils=n.languageUtils,i.options=r,i.logger=x.create("backendConnector"),i.state={},i.queue=[],i.backend&&i.backend.init&&i.backend.init(n,r.backend,r),i}return g(t,e),h(t,[{key:"queueLoad",value:function(e,t,o,n){var i=this,r=[],s=[],a=[],l=[];return e.forEach((function(e){var n=!0;t.forEach((function(t){var a="".concat(e,"|").concat(t);!o.reload&&i.store.hasResourceBundle(e,t)?i.state[a]=2:i.state[a]<0||(1===i.state[a]?s.indexOf(a)<0&&s.push(a):(i.state[a]=1,n=!1,s.indexOf(a)<0&&s.push(a),r.indexOf(a)<0&&r.push(a),l.indexOf(t)<0&&l.push(t)))})),n||a.push(e)})),(r.length||s.length)&&this.queue.push({pending:s,loaded:{},errors:[],callback:n}),{toLoad:r,pending:s,toLoadLanguages:a,toLoadNamespaces:l}}},{key:"loaded",value:function(e,t,o){var n=e.split("|"),i=n[0],r=n[1];t&&this.emit("failedLoading",i,r,t),o&&this.store.addResourceBundle(i,r,o),this.state[e]=t?-1:2;var s={};this.queue.forEach((function(o){var n,a,l,u,c;n=o.loaded,a=r,(u=(l=b(n,[i],Object)).obj)[c=l.k]=u[c]||[],u[c].push(a),function(e,t){for(var o=e.indexOf(t);-1!==o;)e.splice(o,1),o=e.indexOf(t)}(o.pending,e),t&&o.errors.push(t),0!==o.pending.length||o.done||(Object.keys(o.loaded).forEach((function(e){s[e]||(s[e]=[]),o.loaded[e].length&&o.loaded[e].forEach((function(t){s[e].indexOf(t)<0&&s[e].push(t)}))})),o.done=!0,o.errors.length?o.callback(o.errors):o.callback())})),this.emit("loaded",s),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,o){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:350,s=arguments.length>5?arguments[5]:void 0;return e.length?this.backend[o](e,t,(function(a,l){a&&l&&i<5?setTimeout((function(){n.read.call(n,e,t,o,i+1,2*r,s)}),r):s(a,l)})):s(null,{})}},{key:"prepareLoading",value:function(e,t){var o=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var r=this.queueLoad(e,t,n,i);if(!r.toLoad.length)return r.pending.length||i(),null;r.toLoad.forEach((function(e){o.loadOne(e)}))}},{key:"load",value:function(e,t,o){this.prepareLoading(e,t,{},o)}},{key:"reload",value:function(e,t,o){this.prepareLoading(e,t,{reload:!0},o)}},{key:"loadOne",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.split("|"),i=n[0],r=n[1];this.read(i,r,"read",void 0,void 0,(function(n,s){n&&t.logger.warn("".concat(o,"loading namespace ").concat(r," for language ").concat(i," failed"),n),!n&&s&&t.logger.log("".concat(o,"loaded namespace ").concat(r," for language ").concat(i),s),t.loaded(e,n,s)}))}},{key:"saveMissing",value:function(e,t,o,n,i){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)?this.logger.warn('did not save key "'.concat(o,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):null!=o&&""!==o&&(this.backend&&this.backend.create&&this.backend.create(e,t,o,n,null,l({},r,{isUpdate:i})),e&&e[0]&&this.store.addResource(e[0],t,o,n))}}]),t}(_);function V(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===s(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===s(e[2])||"object"===s(e[3])){var o=e[3]||e[2];Object.keys(o).forEach((function(e){t[e]=o[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,o,n){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!1}}}function K(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.whitelist&&(e.whitelist&&e.whitelist.indexOf("cimode")<0&&(e.whitelist=e.whitelist.concat(["cimode"])),e.supportedLngs=e.whitelist),e.nonExplicitWhitelist&&(e.nonExplicitSupportedLngs=e.nonExplicitWhitelist),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function X(){}const W=new(function(e){function t(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(u(this,t),e=p(this,f(t).call(this)),O&&_.call(d(e)),e.options=K(o),e.services={},e.logger=x,e.modules={external:[]},n&&!e.isInitialized&&!o.isClone){if(!e.options.initImmediate)return e.init(o,n),p(e,d(e));setTimeout((function(){e.init(o,n)}),0)}return e}return g(t,e),h(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;function n(e){return e?"function"==typeof e?new e:e:null}if("function"==typeof t&&(o=t,t={}),t.whitelist&&!t.supportedLngs&&this.logger.deprecate("whitelist",'option "whitelist" will be renamed to "supportedLngs" in the next major - please make sure to rename this option asap.'),t.nonExplicitWhitelist&&!t.nonExplicitSupportedLngs&&this.logger.deprecate("whitelist",'options "nonExplicitWhitelist" will be renamed to "nonExplicitSupportedLngs" in the next major - please make sure to rename this option asap.'),this.options=l({},V(),this.options,K(t)),this.format=this.options.interpolation.format,o||(o=X),!this.options.isClone){this.modules.logger?x.init(n(this.modules.logger),this.options):x.init(null,this.options);var i=new I(this.options);this.store=new P(this.options.resources,this.options);var r=this.services;r.logger=x,r.resourceStore=this.store,r.languageUtils=i,r.pluralResolver=new G(i,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),r.interpolator=new Y(this.options),r.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},r.backendConnector=new U(n(this.modules.backend),r.resourceStore,r,this.options),r.backendConnector.on("*",(function(t){for(var o=arguments.length,n=new Array(o>1?o-1:0),i=1;i<o;i++)n[i-1]=arguments[i];e.emit.apply(e,[t].concat(n))})),this.modules.languageDetector&&(r.languageDetector=n(this.modules.languageDetector),r.languageDetector.init(r,this.options.detection,this.options)),this.modules.i18nFormat&&(r.i18nFormat=n(this.modules.i18nFormat),r.i18nFormat.init&&r.i18nFormat.init(this)),this.translator=new F(this.services,this.options),this.translator.on("*",(function(t){for(var o=arguments.length,n=new Array(o>1?o-1:0),i=1;i<o;i++)n[i-1]=arguments[i];e.emit.apply(e,[t].concat(n))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var s=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);s.length>0&&"dev"!==s[0]&&(this.options.lng=s[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");var a=["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"];a.forEach((function(t){e[t]=function(){var o;return(o=e.store)[t].apply(o,arguments)}}));var u=["addResource","addResources","addResourceBundle","removeResourceBundle"];u.forEach((function(t){e[t]=function(){var o;return(o=e.store)[t].apply(o,arguments),e}}));var c=v(),h=function(){var t=function(t,n){e.isInitialized&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),c.resolve(n),o(t,n)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?h():setTimeout(h,0),c}},{key:"loadResources",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X,n=o,i="string"==typeof e?e:this.language;if("function"==typeof e&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(i&&"cimode"===i.toLowerCase())return n();var r=[],s=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){r.indexOf(e)<0&&r.push(e)}))};if(i)s(i);else{var a=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);a.forEach((function(e){return s(e)}))}this.options.preload&&this.options.preload.forEach((function(e){return s(e)})),this.services.backendConnector.load(r,this.options.ns,n)}else n(null)}},{key:"reloadResources",value:function(e,t,o){var n=v();return e||(e=this.languages),t||(t=this.options.ns),o||(o=X),this.services.backendConnector.reload(e,t,(function(e){n.resolve(),o(e)})),n}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&E.addPostProcessor(e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"changeLanguage",value:function(e,t){var o=this;this.isLanguageChangingTo=e;var n=v();this.emit("languageChanging",e);var i=function(e){var i="string"==typeof e?e:o.services.languageUtils.getBestMatchFromCodes(e);i&&(o.language||(o.language=i,o.languages=o.services.languageUtils.toResolveHierarchy(i)),o.translator.language||o.translator.changeLanguage(i),o.services.languageDetector&&o.services.languageDetector.cacheUserLanguage(i)),o.loadResources(i,(function(e){!function(e,i){i?(o.language=i,o.languages=o.services.languageUtils.toResolveHierarchy(i),o.translator.changeLanguage(i),o.isLanguageChangingTo=void 0,o.emit("languageChanged",i),o.logger.log("languageChanged",i)):o.isLanguageChangingTo=void 0,n.resolve((function(){return o.t.apply(o,arguments)})),t&&t(e,(function(){return o.t.apply(o,arguments)}))}(e,i)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(i):i(e):i(this.services.languageDetector.detect()),n}},{key:"getFixedT",value:function(e,t){var o=this,n=function e(t,n){var i;if("object"!==s(n)){for(var r=arguments.length,a=new Array(r>2?r-2:0),u=2;u<r;u++)a[u-2]=arguments[u];i=o.options.overloadTranslationOptionHandler([t,n].concat(a))}else i=l({},n);return i.lng=i.lng||e.lng,i.lngs=i.lngs||e.lngs,i.ns=i.ns||e.ns,o.t(t,i)};return"string"==typeof e?n.lng=e:n.lngs=e,n.ns=t,n}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var n=this.languages[0],i=!!this.options&&this.options.fallbackLng,r=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;var s=function(e,o){var n=t.services.backendConnector.state["".concat(e,"|").concat(o)];return-1===n||2===n};if(o.precheck){var a=o.precheck(this,s);if(void 0!==a)return a}return!!this.hasResourceBundle(n,e)||!this.services.backendConnector.backend||!(!s(n,e)||i&&!s(r,e))}},{key:"loadNamespaces",value:function(e,t){var o=this,n=v();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){o.options.ns.indexOf(e)<0&&o.options.ns.push(e)})),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var o=v();"string"==typeof e&&(e=[e]);var n=this.options.preload||[],i=e.filter((function(e){return n.indexOf(e)<0}));return i.length?(this.options.preload=n.concat(i),this.loadResources((function(e){o.resolve(),t&&t(e)})),o):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){return e||(e=this.languages&&this.languages.length>0?this.languages[0]:this.language),e?["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>=0?"rtl":"ltr":"rtl"}},{key:"createInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;return new t(e,o)}},{key:"cloneInstance",value:function(){var e=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X,i=l({},this.options,o,{isClone:!0}),r=new t(i),s=["store","services","language"];return s.forEach((function(t){r[t]=e[t]})),r.services=l({},this.services),r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r.translator=new F(r.services,r.options),r.translator.on("*",(function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];r.emit.apply(r,[e].concat(o))})),r.init(i,n),r.translator.options=r.options,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}}]),t}(_)),z=JSON.parse('{"shiftLeft":{"name":"Shift Left","description":"Press to move a polyomino to the left once, or hold to engage the Autoshift."},"shiftRight":{"name":"Shift Right","description":"Press to move a polyomino to the right once, or hold to engage the Autoshift."},"hardDrop":{"name":"Hard Drop","description":"Drop a polyomino instantly the floor and lock it in place."},"softDrop":{"name":"Soft Drop","description":"Speed up the descent of a polyomino."},"rotateLeft":{"name":"Rotate Left","description":"Rotate a polyomino 90° counter-clockwise."},"rotateRight":{"name":"Rotate Right","description":"Rotate a polyomino 90° clockwise."},"rotate180":{"name":"Rotate 180°","description":"Rotate a polyomino 180°."},"hold":{"name":"Hold","description":"Send a polyomino to the HOLD Queue."},"retry":{"name":"Retry","description":"Instantly have another attempt in the current mode."},"pause":{"name":"Pause","description":"Pause the game."},"sonicDrop":{"name":"Sonic Drop"},"softDropWithLock":{"name":"Soft Drop with Lock"}}');var Q=o.t(z,2);const q=JSON.parse('{"createdBy":"Created by {{author}}","style":{"categoryName":"Game Styles","guideline":{"name":"Guideline","description":"The standard variant found in most modern games."},"tetraX":{"name":"Tetra-X","description":"The custom variant designed by Dr Ocelot."},"retro":{"name":"Retro","description":"The classic variant loved by oldschool players."},"arcade":{"name":"Arcade","description":"The difficult variant loved by hardcore players."}},"settings":{"categoryName":"Settings","controls":{"name":"Controls","description":"Customize how the game controls."},"tuning":{"name":"Tuning","description":"Customize how the game handles."},"audio":{"name":"Audio","description":"Customize how the game sounds."},"video":{"name":"Video","description":"Customize how the game looks."}}}');var $=o.t(q,2);const J=JSON.parse('{"next":"NEXT","hold":"HOLD"}');var Z=o.t(J,2);const ee=JSON.parse('{"marathon":{"name":"Marathon"}}');var te=o.t(ee,2);class oe{}oe.config=new class{constructor(){this.autoshiftDelay=170,this.autoshiftRate=30,this.autoshiftBuffering="charge"}},oe.controls=new class{constructor(){this.shiftLeft=["ArrowLeft"],this.shiftRight=["ArrowRight"],this.hardDrop=["Space"],this.softDrop=["ArrowDown"],this.rotateLeft=["KeyZ","ControlLeft"],this.rotateRight=["KeyX","ArrowUp"],this.rotate180=["KeyD"],this.hold=["KeyC","ShiftLeft"],this.retry=["KeyR"],this.pause=["Escape","KeyP"]}};class ne{static init(){if(ne.hasInitiated)throw new Error("Do not initiate Input more than once.");for(const e of Object.keys(oe.controls))ne.currentGameKeys[e]=new Set,ne.lastGameKeys[e]=new Set;document.addEventListener("keydown",ne.keyDownListener),document.addEventListener("keyup",ne.keyUpListener),ne.hasInitiated=!0}static keyDownListener(e){for(const t of Object.keys(oe.controls))-1!==oe.controls[t].indexOf(e.code)&&ne.currentGameKeys[t].add(e.code)}static keyUpListener(e){for(const t of Object.keys(oe.controls))-1!==oe.controls[t].indexOf(e.code)&&ne.currentGameKeys[t].delete(e.code)}static updateGameInput(){for(const e of Object.keys(ne.currentGameKeys))ne.lastGameKeys[e]=new Set(ne.currentGameKeys[e])}static getGameDown(e){return ne.currentGameKeys[e].size>0}static getGamePress(e){return ne.currentGameKeys[e].size>ne.lastGameKeys[e].size}static getGameRelease(e){return ne.currentGameKeys[e].size<ne.lastGameKeys[e].size}static getGamePressAsNum(e){return Math.max(0,ne.currentGameKeys[e].size-ne.lastGameKeys[e].size)}}ne.currentGameKeys={},ne.lastGameKeys={},ne.hasInitiated=!1,ne.init();const ie={i8:"0.2.0-beta"};class re{static getVersion(){return ie.i8}static isDevBuild(){return ie.i8.includes("dev")}static getRendererContainer(){return this.rendererContainer}static setRender(e){var t;null===(t=this.renderer)||void 0===t||t.destroy(),re.renderer=e,this.renderer.construct()}static init(){re.rendererContainer=document.createElement("div"),re.rendererContainer.classList.add("renderer"),document.body.prepend(re.rendererContainer),re.isDevBuild()&&re.createDevBuildWatermark(),re.last=performance.now(),window.onresize=re.onResize.bind(re),window.requestAnimationFrame(re.animFrameLoop.bind(re))}static createDevBuildWatermark(){const e=document.createElement("div");e.classList.add("dev"),document.body.prepend(e);const t=document.createElement("div");t.classList.add("development-watermark"),t.textContent=`Development Build: ${re.getVersion()}`,e.appendChild(t)}static onResize(){this.renderer.onResize()}static animFrameLoop(){re.now=window.performance.now();const e=re.now-re.last;re.doLogicTick(e),re.doDrawTick(e),ne.updateGameInput(),r.playQueue(),re.last=re.now,window.requestAnimationFrame(re.animFrameLoop.bind(re))}static doLogicTick(e){null!=re.renderer&&re.renderer.doLogicTick(e)}static doDrawTick(e){null!=re.renderer&&re.renderer.doDrawTick(e)}}class se{static toCtx(e){return e.getContext("2d")}static clearCtx(e){e.clearRect(0,0,e.canvas.clientWidth,e.canvas.clientHeight)}static killAllChildren(e){for(;e.firstChild;)e.removeChild(e.firstChild)}static reflow(e){e.offsetWidth}static resetClassAnim(e,t){e.classList.remove(t),se.reflow(e),e.classList.add(t)}}class ae{construct(){}destroy(){se.killAllChildren(re.getRendererContainer())}doDrawTick(e){}doLogicTick(e){}onResize(){}}class le{constructor({rule:e}){this.markedForDeath=[],this.rule=e,this.width=this.rule.matrixWidth,this.height=this.rule.matrixHeight,this.hiddenHeight=this.rule.matrixHiddenHeight,this.resetGrid()}resetGrid(){const e=new Array(this.getHeight()).fill([]);for(let t=0;t<e.length;t++)e[t]=new Array(this.width).fill(null);this.grid=e}getGridWithPolyomino(e,t,o){const n=class{static deepClone(e){return JSON.parse(JSON.stringify(e))}}.deepClone(this.grid);if(null==o)return n;for(let i=0;i<o.getTotalMonominos();i++){const r=o.getMonominos()[i],s=e+o.getCurrentCoordinates()[i].x;n[t+o.getCurrentCoordinates()[i].y][s]=r}return n}getWidth(){return this.width}getHeight(){return this.height+this.hiddenHeight}getVisibleHeight(){return this.height}getHiddenHeight(){return this.hiddenHeight}getCoordinateType(e,t){return t<0&&this.rule.matrixHasCeiling||e<0||e>=this.width||t>=this.getHeight()?"wall":t>=this.hiddenHeight?"normal":"hidden"}hasObstructionAt(e,t){return"wall"===this.getCoordinateType(e,t)||this.hasMonominoAt(e,t)}hasMonominoAt(e,t){return null!=this.grid[t][e]}addMonominoTo(e,t,o){null!=this.grid&&(this.grid[t][e]=o)}getFilledRows(e=this.grid){const t=[];for(let o=0;o<e.length;o++)for(let n=0;n<=e.length;n++){if(n===e[o].length){t.push(o);break}if(null==e[o][n])break}return t}getRowsMarkedForDeath(){return this.markedForDeath}markFilledRowsForDeath(){this.markedForDeath=[...this.getFilledRows()]}killRowsMarkedForDeath(){for(const e of this.markedForDeath)for(let t=0;t<this.grid[e].length;t++)this.grid[e][t]=null}collapseRowsMarkedForDeath(){let e=!1;for(const t of this.markedForDeath)for(let o=t;o>=0;o--)if(0!==o){this.grid[o]=this.grid[o-1];for(const t of this.grid[o])null!=t&&(e=!0);this.markedForDeath.splice(t,1)}else this.grid[o]=new Array(this.width).fill(null);return this.markedForDeath=[],e}isEmpty(){if(null==this.grid)return!0;for(const e of this.grid)for(const t of e)if(null!=t)return!1;return!0}isCloseToSkyline(){return this.getHighest()-this.hiddenHeight-4<0}getHighest(){for(let e=0;e<this.grid.length;e++)for(const t of this.grid[e])if(null!==t)return e;return this.getHeight()}getDrawData(){const e=[];for(let t=0;t<this.grid.length;t++)for(let o=0;o<this.grid[t].length;o++){const n=this.grid[t][o];null==n?e.push({x:o,y:t-this.getHiddenHeight(),color:"invalid",timeLocked:Number.MIN_SAFE_INTEGER,shape:"none",skin:null}):e.push({x:o,y:t-this.getHiddenHeight(),color:n.getColor(),timeLocked:n.getLockedTime(),shape:n.getShape(),skin:n.getSkin()})}return e}}class ue{constructor({color:e="invalid",connectionsByte:t=0}={}){this.timeLocked=Number.MIN_SAFE_INTEGER,this.shape="none",this.skin=null,this.color=e,this.connectionsByte=t}getColor(){return this.color}setColor(e){this.color=e}getLockedTime(){return this.timeLocked}setLockedTime(){this.timeLocked=performance.now()}setShape(e){this.shape=e}getShape(){return this.shape}setSkin(e){this.skin=e}getSkin(){return this.skin}getConnectionState(e){return 0!=(this.connectionsByte&e)}setConnectionState(e,t){t?this.connectionsByte|=e:this.connectionsByte&=~e}setConnectionsByte(e){if(e<0||e>255)throw new Error("The connection byte specified is not within 0-255");this.connectionsByte=e}}class ce{constructor({shape:e}){this.shape="none",this.orientation=0,this.data=null,this.monominos=[],this.setShape(e);for(let e=0;e<this.getTotalMonominos();e++)this.monominos.push(new ue);this.setShape(e)}getMonominos(){return this.monominos}setShape(e){this.shape=e;for(const t of this.monominos)t.setShape(e);this.data=ce.DATA[this.shape]}setOrientation(e){this.orientation=e}getOrientation(){return this.orientation}getCurrentCoordinates(){return this.data[this.orientation]}getCoordinates(e){return this.data[e]}getShape(){return this.shape}getVisualData(){return ce.VISUAL_LENGTHS[this.shape][this.orientation]}setColor(e){for(const t of this.monominos)t.setColor(e)}setSkin(e){for(const t of this.monominos)t.setSkin(e)}getTotalMonominos(){return ce.DATA[this.shape][this.orientation].length}placeToMatrix({x:e,y:t,matrix:o}){for(let n=0;n<this.getTotalMonominos();n++){const i=this.monominos[n],r=e+this.getCurrentCoordinates()[n].x,s=t+this.getCurrentCoordinates()[n].y;i.setLockedTime(),o.addMonominoTo(r,s,i)}}assignDefaultsFromRule(e){this.setOrientation(e.rotationSystem.initialOrientation[this.getShape()]),this.setColor(e.colors[this.getShape()]),this.setSkin(e.skin)}}ce.DATA={i:[[{x:0,y:1,connections:8},{x:1,y:1,connections:12},{x:2,y:1,connections:12},{x:3,y:1,connections:4}],[{x:2,y:0,connections:2},{x:2,y:1,connections:3},{x:2,y:2,connections:3},{x:2,y:3,connections:1}],[{x:3,y:2,connections:4},{x:2,y:2,connections:12},{x:1,y:2,connections:12},{x:0,y:2,connections:8}],[{x:1,y:3,connections:1},{x:1,y:2,connections:3},{x:1,y:1,connections:3},{x:1,y:0,connections:2}]],j:[[{x:0,y:0,connections:2},{x:0,y:1,connections:9},{x:1,y:1,connections:12},{x:2,y:1,connections:4}],[{x:2,y:0,connections:4},{x:1,y:0,connections:10},{x:1,y:1,connections:3},{x:1,y:2,connections:1}],[{x:2,y:2,connections:1},{x:2,y:1,connections:6},{x:1,y:1,connections:12},{x:0,y:1,connections:8}],[{x:0,y:2,connections:8},{x:1,y:2,connections:5},{x:1,y:1,connections:3},{x:1,y:0,connections:2}]],l:[[{x:2,y:0,connections:2},{x:2,y:1,connections:5},{x:1,y:1,connections:12},{x:0,y:1,connections:8}],[{x:2,y:2,connections:4},{x:1,y:2,connections:9},{x:1,y:1,connections:3},{x:1,y:0,connections:2}],[{x:0,y:2,connections:1},{x:0,y:1,connections:10},{x:1,y:1,connections:12},{x:2,y:1,connections:4}],[{x:0,y:0,connections:8},{x:1,y:0,connections:6},{x:1,y:1,connections:3},{x:1,y:2,connections:1}]],o:[[{x:0,y:0,connections:138},{x:1,y:0,connections:70},{x:1,y:1,connections:21},{x:0,y:1,connections:41}],[{x:1,y:0,connections:70},{x:1,y:1,connections:21},{x:0,y:1,connections:41},{x:0,y:0,connections:138}],[{x:1,y:1,connections:21},{x:0,y:1,connections:41},{x:0,y:0,connections:138},{x:1,y:0,connections:70}],[{x:0,y:1,connections:41},{x:0,y:0,connections:138},{x:1,y:0,connections:70},{x:1,y:1,connections:21}]],s:[[{x:2,y:0,connections:4},{x:1,y:0,connections:10},{x:1,y:1,connections:5},{x:0,y:1,connections:8}],[{x:2,y:2,connections:1},{x:2,y:1,connections:6},{x:1,y:1,connections:9},{x:1,y:0,connections:2}],[{x:0,y:2,connections:8},{x:1,y:2,connections:5},{x:1,y:1,connections:10},{x:2,y:1,connections:4}],[{x:0,y:0,connections:2},{x:0,y:1,connections:9},{x:1,y:1,connections:6},{x:1,y:2,connections:1}]],t:[[{x:1,y:0,connections:2},{x:0,y:1,connections:8},{x:1,y:1,connections:13},{x:2,y:1,connections:4}],[{x:2,y:1,connections:4},{x:1,y:0,connections:2},{x:1,y:1,connections:11},{x:1,y:2,connections:1}],[{x:1,y:2,connections:1},{x:2,y:1,connections:4},{x:1,y:1,connections:14},{x:0,y:1,connections:8}],[{x:0,y:1,connections:8},{x:1,y:2,connections:1},{x:1,y:1,connections:7},{x:1,y:0,connections:2}]],z:[[{x:0,y:0,connections:8},{x:1,y:0,connections:6},{x:1,y:1,connections:9},{x:2,y:1,connections:4}],[{x:2,y:0,connections:2},{x:2,y:1,connections:5},{x:1,y:1,connections:10},{x:1,y:2,connections:1}],[{x:2,y:2,connections:4},{x:1,y:2,connections:9},{x:1,y:1,connections:6},{x:0,y:1,connections:8}],[{x:0,y:2,connections:1},{x:0,y:1,connections:10},{x:1,y:1,connections:5},{x:1,y:0,connections:2}]]},ce.VISUAL_LENGTHS={i:[{startX:0,endX:3,startY:1,endY:1},{startX:2,endX:2,startY:0,endY:3},{startX:0,endX:3,startY:2,endY:2},{startX:1,endX:1,startY:0,endY:3}],j:[{startX:0,endX:2,startY:0,endY:1},{startX:1,endX:2,startY:0,endY:2},{startX:0,endX:2,startY:1,endY:2},{startX:0,endX:1,startY:0,endY:2}],l:[{startX:0,endX:2,startY:0,endY:1},{startX:1,endX:2,startY:0,endY:2},{startX:0,endX:2,startY:1,endY:2},{startX:0,endX:1,startY:0,endY:2}],o:[{startX:0,endX:1,startY:0,endY:1},{startX:0,endX:1,startY:0,endY:1},{startX:0,endX:1,startY:0,endY:1},{startX:0,endX:1,startY:0,endY:1}],s:[{startX:0,endX:2,startY:0,endY:1},{startX:1,endX:2,startY:0,endY:2},{startX:0,endX:2,startY:1,endY:2},{startX:0,endX:1,startY:0,endY:2}],t:[{startX:0,endX:2,startY:0,endY:1},{startX:1,endX:2,startY:0,endY:2},{startX:0,endX:2,startY:1,endY:2},{startX:0,endX:1,startY:0,endY:2}],z:[{startX:0,endX:2,startY:0,endY:1},{startX:1,endX:2,startY:0,endY:2},{startX:0,endX:2,startY:1,endY:2},{startX:0,endX:1,startY:0,endY:2}]},ce.SPIN_POINTS={i:[{major1:[{x:1,y:0},{x:2,y:0}],major2:[{x:2,y:2},{x:1,y:2}],minor1:[{x:-1,y:1}],minor2:[{x:4,y:1}]},{major1:[{x:1,y:1},{x:1,y:2}],major2:[{x:3,y:2},{x:3,y:1}],minor1:[{x:2,y:-1}],minor2:[{x:2,y:4}]},{major1:[{x:1,y:1},{x:2,y:1}],major2:[{x:2,y:3},{x:1,y:3}],minor1:[{x:-1,y:2}],minor2:[{x:4,y:2}]},{major1:[{x:0,y:1},{x:0,y:2}],major2:[{x:2,y:2},{x:2,y:1}],minor1:[{x:1,y:-1}],minor2:[{x:1,y:4}]}],j:[{major1:[{x:1,y:0}],major2:[{x:2,y:0}],minor1:[{x:0,y:2}],minor2:[{x:2,y:2}]},{major1:[{x:2,y:1}],major2:[{x:2,y:2}],minor1:[{x:0,y:0}],minor2:[{x:0,y:2}]},{major1:[{x:1,y:2}],major2:[{x:0,y:2}],minor1:[{x:2,y:0}],minor2:[{x:0,y:0}]},{major1:[{x:0,y:1}],major2:[{x:0,y:0}],minor1:[{x:2,y:2}],minor2:[{x:2,y:0}]}],l:[{major1:[{x:1,y:0}],major2:[{x:0,y:0}],minor1:[{x:2,y:2}],minor2:[{x:0,y:2}]},{major1:[{x:2,y:1}],major2:[{x:2,y:0}],minor1:[{x:0,y:2}],minor2:[{x:0,y:0}]},{major1:[{x:1,y:2}],major2:[{x:2,y:2}],minor1:[{x:0,y:0}],minor2:[{x:2,y:0}]},{major1:[{x:0,y:1}],major2:[{x:0,y:2}],minor1:[{x:2,y:0}],minor2:[{x:2,y:2}]}],o:[{major1:[],major2:[],minor1:[],minor2:[]},{major1:[],major2:[],minor1:[],minor2:[]},{major1:[],major2:[],minor1:[],minor2:[]},{major1:[],major2:[],minor1:[],minor2:[]}],s:[{major1:[{x:0,y:0}],major2:[{x:2,y:1}],minor1:[{x:3,y:0}],minor2:[{x:-1,y:1}]},{major1:[{x:1,y:2}],major2:[{x:2,y:0}],minor1:[{x:1,y:-1}],minor2:[{x:2,y:3}]},{major1:[{x:2,y:2}],major2:[{x:0,y:1}],minor1:[{x:-1,y:2}],minor2:[{x:3,y:1}]},{major1:[{x:1,y:0}],major2:[{x:0,y:2}],minor1:[{x:1,y:3}],minor2:[{x:0,y:-1}]}],t:[{major1:[{x:0,y:0}],major2:[{x:2,y:0}],minor1:[{x:0,y:2}],minor2:[{x:2,y:2}]},{major1:[{x:2,y:0}],major2:[{x:2,y:2}],minor1:[{x:0,y:0}],minor2:[{x:0,y:2}]},{major1:[{x:0,y:2}],major2:[{x:2,y:2}],minor1:[{x:0,y:0}],minor2:[{x:2,y:0}]},{major1:[{x:0,y:0}],major2:[{x:0,y:2}],minor1:[{x:2,y:0}],minor2:[{x:2,y:2}]}],z:[{major1:[{x:2,y:0}],major2:[{x:0,y:1}],minor1:[{x:-1,y:0}],minor2:[{x:3,y:1}]},{major1:[{x:2,y:2}],major2:[{x:1,y:0}],minor1:[{x:2,y:-1}],minor2:[{x:1,y:3}]},{major1:[{x:0,y:2}],major2:[{x:2,y:1}],minor1:[{x:3,y:2}],minor2:[{x:-1,y:1}]},{major1:[{x:0,y:0}],major2:[{x:1,y:2}],minor1:[{x:0,y:3}],minor2:[{x:1,y:-1}]}]},ce.TETROMINOES=["i","j","l","o","s","t","z"];class he{static sixtyFpsFramesToMs(e){return e/60*1e3}static bpmToMsPerBar(e){return 60/e*1e3}}class de{constructor({matrix:e,rule:t,mode:o}){this._isDirty=!0,this.lastY=0,this.lowestY=0,this.inSoftDrop=!1,this.fallSpeed=1e3,this.mustUpgradeSpin=!1,this.matrix=e,this.rule=t,this.mode=o}lockdown(){this.polyomino.placeToMatrix({x:this.x,y:this.getIntY(),matrix:this.matrix}),this.polyomino=null,this.needsRedrawing()}isDead(){return null==this.polyomino}isDirty(){return!!this.isOnGround()||this._isDirty}wasDrawn(){this._isDirty=!1}needsRedrawing(){this._isDirty=!0}init(e){this.polyomino=e;const t=this.rule.spawnOffsets[this.polyomino.getShape()],o=this.rule.rotationSystem.offsets[this.polyomino.getShape()][this.polyomino.getOrientation()];this.x=t.x+o.x,this.y=t.y+this.matrix.getHiddenHeight()+o.y,this.shift(0,this.rule.immediateDropOnSpawn),this.is20G()&&!this.rule.suspendPieceUntilAction&&this.slamToFloor(),this.lowestY=0,this.updateLowestAndLastY(),this.resetLockDelay(),this.needsRedrawing(),this.needsToDie=!1,this.lastAction="spawn"}collidesWith(e,t,o){var n;if(void 0===o&&(o=null===(n=this.polyomino)||void 0===n?void 0:n.getOrientation()),this.isDead())return;const[i,r]=[this.x+e,this.getIntY()+t];for(let e=0;e<this.polyomino.getTotalMonominos();e++){const t=i+this.polyomino.getCoordinates(o)[e].x,n=r+this.polyomino.getCoordinates(o)[e].y;if("wall"===this.matrix.getCoordinateType(t,n))return!0;if(this.matrix.hasMonominoAt(t,n))return!0}return!1}updateLowestAndLastY(){var e;this.lowestY=Math.max(this.getIntY()+(null===(e=this.polyomino)||void 0===e?void 0:e.getVisualData().endY),this.lowestY),this.lastY=this.y}isOnGround(){return this.collidesWith(0,1)}isStuck(){return this.collidesWith(0,0)}canShiftLeft(){return!this.collidesWith(-1,0)}canShiftRight(){return!this.collidesWith(1,0)}shift(e,t){this.collidesWith(e,t)||(this.x+=e,this.y+=t,0===e&&0===t||this.needsRedrawing())}shiftLeft(){this.canShiftLeft()&&(null!=this.polyomino&&r.add("pieceMove"),this.lastAction="move",this.movementsAccum++,(this.collidesWith(-1,1)||this.isOnGround())&&r.add("pieceSlide")),this.shift(-1,0)}shiftRight(){this.canShiftRight()&&(null!=this.polyomino&&r.add("pieceMove"),this.lastAction="move",this.movementsAccum++,(this.collidesWith(1,1)||this.isOnGround())&&r.add("pieceSlide")),this.shift(1,0)}rotate(e){if(this.isDead())return;const t=(this.polyomino.getOrientation()+e)%4,o=this.rule.rotationSystem.offsets[this.getPolyominoShape()],n=o[t].x-o[this.polyomino.getOrientation()].x,i=o[t].y-o[this.polyomino.getOrientation()].y,s=this.rule.rotationSystem.wallkick.executeWallkick({xOffset:n,yOffset:i,rotateDirection:e,oldOrientation:this.polyomino.getOrientation(),newOrientation:t,allowFloorKicks:!0,polyominoController:this,matrix:this.matrix});if(null!=s){if(s.usedKick&&"disable-wallkick"===this.rule.resetExpirationPenalty&&this.hasExhaustedResets())return;this.polyomino.setOrientation(s.orientation),this.x+=s.xOffset+n,this.y+=s.yOffset+i,s.usedKick&&this.rule.resetLockDelayByKicking&&(this.lockDelayAccum=0),this.lastAction="rotate",this.mustUpgradeSpin=s.mustUpgradeSpin;const e=this.checkIfSpin();e.isSpin?e.isMini?r.add("pieceRotateTMini"):r.add("pieceRotateT"):r.add("pieceRotate"),s.usedKick&&r.add("pieceWallkick"),this.rotationsAccum++,this.needsRedrawing()}}checkIfSpin(){if("rotate"!==this.lastAction)return{isSpin:!1,isMini:!1};if(!this.collidesWith(0,1))return{isSpin:!1,isMini:!1};const e=this.polyomino.getShape();if(-1===this.mode.scoring.spinPolyominoList.indexOf(e))return{isSpin:!1,isMini:!1};const t=this.polyomino.getOrientation();if("threeCorner"===this.mode.scoring.spinBonusType){const o=e=>{for(const t of e)if(this.matrix.hasObstructionAt(this.x+t.x,this.getIntY()+t.y))return!0},n=o(ce.SPIN_POINTS[e][t].major1),i=o(ce.SPIN_POINTS[e][t].major2),r=o(ce.SPIN_POINTS[e][t].minor1),s=o(ce.SPIN_POINTS[e][t].minor2);if(n&&i&&(r||s))return{isSpin:!0,isMini:!1};if((n||i)&&r&&s)return{isSpin:!0,isMini:!this.mustUpgradeSpin}}else if("immobile"===this.mode.scoring.spinBonusType&&this.collidesWith(-1,0)&&this.collidesWith(1,0)&&this.collidesWith(0,-1))return{isSpin:!0,isMini:!1};return{isSpin:!1,isMini:!1}}doGravity(e){if(this.rule.suspendPieceUntilAction&&"spawn"===this.lastAction)return;const t=e/this.getFallSpeed();if("retro"===this.rule.lockDelayType)if(this.hasEnoughSpaceBelow(t)){const e=this.y;this.y+=t,this.isStuck()&&(this.y=e,this.slamToFloor(),this.needsToDie=!0)}else this.slamToFloor(),this.needsToDie=!0;else this.isOnGround()?this.y=this.getIntY():this.hasEnoughSpaceBelow(t)?this.y+=Math.min(t,this.getDropDistance(t+1)):this.slamToFloor();this.getIntY()>Math.floor(this.lastY)&&(this.isOnGround()&&r.add("pieceLand"),this.needsRedrawing(),this.lastAction="fall")}resetLockDelay(){this.resetLockDelayResets(),this.lockDelayAccum=0}resetLockDelayResets(){this.movementsAccum=0,this.rotationsAccum=0,this.movementsAccommodated=0,this.rotationsAccommodated=0}doLockDelay(e){var t;this.getIntY()+(null===(t=this.polyomino)||void 0===t?void 0:t.getVisualData().endY)>Math.floor(this.lowestY)&&(this.rule.resetLockDelayByFalling&&(this.lockDelayAccum=0),this.rule.resetResetsByFalling&&this.resetLockDelayResets()),this.isOnGround()&&(this.lockDelayAccum+=e,this.needsRedrawing()),this.hasExhaustedResets()&&"disable-resets"===this.rule.resetExpirationPenalty||(this.rule.resetLockDelayByMoving&&this.movementsAccum>this.movementsAccommodated&&(this.movementsAccommodated=this.movementsAccum,this.lockDelayAccum=0,this.needsRedrawing()),this.rule.resetLockDelayByRotating&&this.rotationsAccum>this.rotationsAccommodated&&(this.rotationsAccommodated=this.rotationsAccum,this.lockDelayAccum=0,this.needsRedrawing()))}hasExhaustedResets(){return!!(this.rule.moveAndRotateResetsAreShared&&this.movementsAccum+this.rotationsAccum>=Math.min(this.rule.moveResets,this.rule.rotationResets)&&this.rule.resetLockDelayByMoving&&this.rule.resetLockDelayByRotating)||!(!(()=>this.movementsAccum>=this.rule.moveResets&&this.rule.resetLockDelayByMoving)()&&!(()=>this.rotationsAccum>=this.rule.rotationResets&&this.rule.resetLockDelayByRotating)())}lockDelayHasExpired(){return"retro"===this.rule.lockDelayType?this.needsToDie:!("limited"!==this.rule.lockDelayType||!this.isOnGround()||!this.hasExhaustedResets()||"instant-lock"!==this.rule.resetExpirationPenalty)||this.lockDelayAccum>=this.rule.lockDelay&&this.isOnGround()}getLockDelayAccumulated(){return this.lockDelayAccum}isAboveSkyline(){return this.y+this.polyomino.getVisualData().endY<this.matrix.getHiddenHeight()}isPartiallyAboveSkyline(){return this.y+this.polyomino.getVisualData().endY<this.matrix.getHiddenHeight()}getIntY(){return Math.floor(this.y)}getVisibleY(){return this.getIntY()-this.matrix.getHiddenHeight()}hasEnoughSpaceBelow(e){return e<1||this.getDropDistance(e)===Math.floor(e)}getDropDistance(e){if(this.isStuck())return 0;let t;for(t=1;t<=e;t++)if(this.collidesWith(0,t))return t-1;return t-1}getDistanceToFloor(){return this.getDropDistance(this.matrix.getHeight()+Math.abs(this.getIntY()))}slamToFloor(){const e=this.getDistanceToFloor();this.y+=e,e>0&&(this.lastAction="fall")}getFallSpeed(){if(this.inSoftDrop)switch(this.rule.softDropType){case"multiplicative":return this.fallSpeed/this.rule.softDropSpeed;case"additive":return this.fallSpeed+this.rule.softDropSpeed;case"absolute":return Math.min(this.fallSpeed,this.rule.softDropSpeed);default:throw new Error("Unhandled soft drop type")}return this.fallSpeed}setFallSpeedAsMsPerLine(e){this.fallSpeed=e}setFallSpeedAsG(e){this.fallSpeed=he.sixtyFpsFramesToMs(1/e)}setFallSpeedTo20G(){this.fallSpeed=.09}is20G(){return this.fallSpeed<.1}sendToHoldQueue(e){this.rule.holdResetsPieceOrientation&&this.polyomino.setOrientation(this.rule.rotationSystem.initialOrientation[this.polyomino.getShape()]),e.setPolyomino(this.polyomino),this.polyomino=null}swapWithHoldQueue(e){const t=e.getPolyomino();this.sendToHoldQueue(e),this.init(t)}getPolyominoShape(){return this.polyomino.getShape()}getHardDropLineClearRows(){const e=this.matrix.getGridWithPolyomino(this.x,this.getIntY()+this.getDistanceToFloor(),this.polyomino);return this.matrix.getFilledRows(e)}getDrawData(){if(null==this.polyomino)return[];const e=[],t=this.polyomino.getMonominos();for(let o=0;o<this.polyomino.getTotalMonominos();o++)this.rule.allowsGhost&&e.push({x:this.x+this.polyomino.getCurrentCoordinates()[o].x,y:this.getVisibleY()+this.polyomino.getCurrentCoordinates()[o].y+this.getDistanceToFloor(),color:t[o].getColor(),shape:t[o].getShape(),isGhost:!0,skin:t[o].getSkin()}),e.push({x:this.x+this.polyomino.getCurrentCoordinates()[o].x,y:this.getVisibleY()+this.polyomino.getCurrentCoordinates()[o].y,shape:t[o].getShape(),color:t[o].getColor(),skin:t[o].getSkin()});return e}}class pe{constructor({rule:e,mode:t}){this.queue=[],this.rule=e,this.mode=t;for(let t=0;t<e.maxPiecePreviews;t++)this.addPolyominoFromRandomizer()}addPolyominoFromRandomizer(){this.rule.randomizer.setPolyominoSet(this.mode.polyominoSet);const e=new ce({shape:this.rule.randomizer.getNextPolyomino()});e.assignDefaultsFromRule(this.rule),this.queue.push(e)}shiftNextPolyomino(){const e=this.queue.shift();return this.queue.length<Math.max(1,this.rule.maxPiecePreviews)&&this.addPolyominoFromRandomizer(),e}getNextPolyomino(){return this.queue[0]}swapFirstPolyominoWithHold(e){const t=e.getPolyomino();e.setPolyomino(this.queue[0]),this.queue[0]=t}reassignPolyominoDefaults(){for(const e of this.queue)e.assignDefaultsFromRule(this.rule)}getDrawInfo(){const e=this.rule.maxPiecePreviews,t=[];for(;this.queue.length<e;)this.addPolyominoFromRandomizer();for(let o=0;o<e;o++){const e=this.queue[o],n=e.getMonominos(),i=[];for(let t=0;t<e.getTotalMonominos();t++){const o=n[t];i.push({x:e.getCoordinates(this.rule.rotationSystem.initialOrientation[e.getShape()])[t].x,y:e.getCoordinates(this.rule.rotationSystem.initialOrientation[e.getShape()])[t].y,color:o.getColor(),shape:o.getShape(),orientation:e.getOrientation(),skin:o.getSkin()})}t.push(i)}return t}}pe.INIT_SIZE=9;class fe{constructor({rule:e}){this.rule=e,this.polyomino=null}setPolyomino(e){this.polyomino=e}getPolyomino(){return this.polyomino}getDrawInfo(){if(null==this.polyomino)return[];const e=this.polyomino.getMonominos(),t=[];for(let o=0;o<this.polyomino.getTotalMonominos();o++){const n=e[o];t.push({x:this.polyomino.getCurrentCoordinates()[o].x,y:this.polyomino.getCurrentCoordinates()[o].y,color:n.getColor(),shape:n.getShape(),orientation:this.polyomino.getOrientation(),skin:n.getSkin()})}return t}reassignPolyominoDefaults(){var e;null===(e=this.polyomino)||void 0===e||e.assignDefaultsFromRule(this.rule)}}class me{constructor(e){this.lineClearAmount=0,this.hasYetToCollapseRows=!1,this.softDropIsDown=!1,this.hasBufferedHold=!1,this.bufferedRotateDirection=null,this.bufferedMoveDirection="none",this.hasExhaustedResetsThisTick=!1,this.holdIsLocked=!1,this.stats={linesCleared:0,polyominoesPlaced:0,scoreAccumulated:0},this.mode=new e,this.rule=new this.mode.Rule,this.rule.randomizer.setPolyominoSet(this.mode.polyominoSet),this.nextQueue=new pe({rule:this.rule,mode:this.mode}),this.holdQueue=new fe({rule:this.rule}),this.matrix=new le({rule:this.rule}),this.polyominoController=new de({matrix:this.matrix,rule:this.rule,mode:this.mode}),this.resetStandardAutoshiftVars(),this.resetRetroAutoshiftVars(),this.shiftDirection="none"}getAutoshiftDelay(){return Math.max(this.rule.minAutoshiftDelay,Math.min(this.rule.maxAutoshiftDelay,oe.config.autoshiftDelay))}getAutoshiftRate(){return Math.max(this.rule.minAutoshiftRate,Math.min(this.rule.maxAutoshiftRate,oe.config.autoshiftRate))}resetStandardAutoshiftVars(){this.autoshiftDelayAccum=0,this.autoshiftRateAccum=this.getAutoshiftRate(),this.hasReleasedShift=!0}resetRetroAutoshiftVars(){this.softDropIsDown||(this.autoshiftAccum=0,this.hasReleasedShift=!0,this.wallCharge=!1)}doStartOfTick(e){if(this.mode.onStartOfTickBegin(this),"gameOver"!==this.state){if("playing"===this.state&&this.polyominoController.doGravity(e),"entryDelay"===this.state){if(this.entryDelayAccum+=e,this.lineClearAmount&&this.entryDelayAccum>this.rule.lineClearDelay&&this.hasYetToCollapseRows&&(this.matrix.collapseRowsMarkedForDeath()&&r.add("collapse"),this.hasYetToCollapseRows=!1),!(this.entryDelayAccum>=this.getEntryDelay()))return;if(this.hasBufferedHold&&(null==this.holdQueue.getPolyomino()?this.holdQueue.setPolyomino(this.nextQueue.shiftNextPolyomino()):this.nextQueue.swapFirstPolyominoWithHold(this.holdQueue),r.add("bufferedHold"),this.holdIsLocked=!0),null!=this.bufferedRotateDirection){const e=this.nextQueue.getNextPolyomino(),t=(e.getOrientation()+this.bufferedRotateDirection)%4;e.setOrientation(t),r.add("bufferedRotate"),this.bufferedRotateDirection=null}if(this.polyominoController.init(this.nextQueue.shiftNextPolyomino()),this.hasBufferedHold?this.hasBufferedHold=!1:this.holdIsLocked=!1,"left"===this.bufferedMoveDirection?(this.polyominoController.shiftLeft(),this.bufferedMoveDirection="none"):"right"===this.bufferedMoveDirection&&(this.polyominoController.shiftRight(),this.bufferedMoveDirection="none"),this.rule.softDropCarriesBetweenPieces||(this.polyominoController.inSoftDrop=!1),this.polyominoController.isStuck())return void(this.state="gameOver");this.state="playing",this.mode.onNewPolyomino(this)}this.hasExhaustedResetsThisTick=this.polyominoController.hasExhaustedResets(),this.polyominoController.lockDelayHasExpired()&&(r.add("lockWithoutHardDrop"),this.lockdown()),this.mode.onStartOfTickEnd(this)}}doEndOfTick(e){this.mode.onEndOfTickBegin(this),"gameOver"!==this.state&&"entryDelay"!==this.state&&(this.polyominoController.doLockDelay(e),this.polyominoController.is20G()&&!this.rule.suspendPieceUntilAction&&this.polyominoController.slamToFloor(),this.polyominoController.hasExhaustedResets()&&!this.hasExhaustedResetsThisTick&&r.add("outOfResets"),this.polyominoController.lockDelayHasExpired()&&(r.add("lockWithoutHardDrop"),this.lockdown()),this.polyominoController.updateLowestAndLastY(),this.mode.onEndOfTickEnd(this))}lockdown(){r.add("lock"),this.entryDelayAccum=0,this.stats.polyominoesPlaced++;let e=!1;(this.rule.hasLockOut||this.rule.hasPartialLockOut)&&(this.rule.hasPartialLockOut&&this.polyominoController.isPartiallyAboveSkyline()&&(e=!0),this.polyominoController.isAboveSkyline()&&(e=!0));const t=this.polyominoController.checkIfSpin();if(this.polyominoController.lockdown(),e)return void(this.state="gameOver");this.state="entryDelay",this.matrix.markFilledRowsForDeath(),this.matrix.killRowsMarkedForDeath(),this.matrix.isEmpty()&&r.add("perfectClear"),this.lineClearAmount=this.matrix.getRowsMarkedForDeath().length,this.stats.linesCleared+=this.lineClearAmount;let o=[];o=t.isSpin?t.isMini?["tSpinMini0","tSpinMini1","tSpinMini2",null,null]:["tSpin0","tSpin1","tSpin2","tSpin3",null]:[null,"erase1","erase2","erase3","erase4"],null!=o[this.lineClearAmount]&&r.add(o[this.lineClearAmount]),this.rule.lineClearDelay<=0&&this.matrix.collapseRowsMarkedForDeath(),this.hasYetToCollapseRows=!0,this.mode.onLockdown(this)}getEntryDelay(){return 0===this.lineClearAmount?this.rule.entryDelay:this.rule.lineClearDelay+this.rule.entryDelayOnLineClear}getEntryDelayAccum(){return this.entryDelayAccum}doHardDrop(){"gameOver"!==this.state&&(this.polyominoController.isDead()||this.rule.allowsHardDrop&&(r.add("pieceHardDrop"),this.polyominoController.slamToFloor(),this.rule.hardDropLocksPieceInstantly&&this.lockdown()))}onHardDropPress(){this.doHardDrop()}onHardDropRelease(){"gameOver"!==this.state&&this.polyominoController.isDead()}onHardDropDown(){this.rule.hardDropExecutesOnlyOncePerPress||this.doHardDrop()}onSoftDropPress(){this.softDropIsDown=!0,"gameOver"!==this.state&&("retro"===this.rule.autoshiftType&&"none"!==this.shiftDirection||(this.rule.allowsSoftDrop?this.polyominoController.inSoftDrop=!0:this.polyominoController.inSoftDrop=!1))}onSoftDropRelease(){this.softDropIsDown=!1,"gameOver"!==this.state&&(this.polyominoController.inSoftDrop=!1)}onSoftDropDown(){this.rule.softDropLocksPieceInstantly&&this.polyominoController.isOnGround()&&(r.add("lockWithoutHardDrop"),this.lockdown())}onHoldPress(){if("gameOver"!==this.state&&this.rule.allowsHold)return"entryDelay"===this.state?(this.rule.allowsHoldBuffering&&(this.hasBufferedHold=!0),void(this.rule.skipEntryDelayOnHold&&(this.entryDelayAccum=this.getEntryDelay(),this.hasBufferedHold=!0))):void(this.holdIsLocked||(null==this.holdQueue.getPolyomino()?(this.polyominoController.sendToHoldQueue(this.holdQueue),this.polyominoController.init(this.nextQueue.shiftNextPolyomino())):(this.polyominoController.swapWithHoldQueue(this.holdQueue),this.polyominoController.isStuck()&&(this.state="gameOver")),r.add("pieceHold"),this.holdIsLocked=!0))}applyRotationBuffer(e){this.rule.skipEntryDelayOnRotate&&(this.entryDelayAccum=this.getEntryDelay()),(this.rule.allowsRotateBuffering||this.rule.skipEntryDelayOnRotate)&&(this.bufferedRotateDirection=e)}onRotateLeft(){"gameOver"!==this.state&&this.rule.allowsRotateLeft&&("entryDelay"!==this.state?this.polyominoController.rotate(3):this.applyRotationBuffer(3))}onRotateRight(){"gameOver"!==this.state&&this.rule.allowsRotateRight&&("entryDelay"!==this.state?this.polyominoController.rotate(1):this.applyRotationBuffer(1))}onRotate180(){"gameOver"!==this.state&&this.rule.allowsRotate180&&("entryDelay"!==this.state?this.polyominoController.rotate(2):this.applyRotationBuffer(2))}setDirection({leftPressedAmount:e,rightPressedAmount:t,hasRightReleased:o,isLeftDown:n,hasLeftReleased:i,isRightDown:r,resetShiftOnFullRelease:s,resetVariableMethod:a}){e>t?(a(),this.shiftDirection="left"):t&&(a(),this.shiftDirection="right"),"right"===this.shiftDirection&&o&&n?(a(),this.shiftDirection="left",e=1):"left"===this.shiftDirection&&i&&r?(a(),this.shiftDirection="right",t=1):o&&n?this.shiftDirection="left":i&&r?this.shiftDirection="right":(i||o)&&(s&&a(),this.shiftDirection="none")}updateShift({leftPressedAmount:e=0,rightPressedAmount:t=0,hasLeftReleased:o=!1,hasRightReleased:n=!1,isLeftDown:i=!1,isRightDown:r=!1,msPassed:s}){if("gameOver"!==this.state)switch(this.rule.autoshiftType){case"standard":if(this.polyominoController.isStuck())return;if(this.setDirection({leftPressedAmount:e,rightPressedAmount:t,hasRightReleased:n,isLeftDown:i,hasLeftReleased:o,isRightDown:r,resetShiftOnFullRelease:!0,resetVariableMethod:this.resetStandardAutoshiftVars.bind(this)}),"off"===oe.config.autoshiftBuffering&&"entryDelay"===this.state)return;if("none"!==this.shiftDirection){"instant"!==oe.config.autoshiftBuffering||"entryDelay"!==this.state||this.rule.skipEntryDelayOnMove||(this.autoshiftDelayAccum=this.getAutoshiftDelay());const o="left"===this.shiftDirection?this.polyominoController.shiftLeft.bind(this.polyominoController):this.polyominoController.shiftRight.bind(this.polyominoController);if(this.hasReleasedShift){const n="left"===this.shiftDirection?e:t;for(let e=0;e<n;e++)o();this.rule.skipEntryDelayOnMove&&"entryDelay"===this.state&&(this.entryDelayAccum=this.getEntryDelay(),this.bufferedMoveDirection=this.shiftDirection),this.hasReleasedShift=!1}else if(this.autoshiftDelayAccum<this.getAutoshiftDelay())this.autoshiftDelayAccum+=s;else if(this.autoshiftDelayAccum>=this.getAutoshiftDelay()){if(this.getAutoshiftRate()<=0){let e=0;for(;"left"===this.shiftDirection?this.polyominoController.canShiftLeft():this.polyominoController.canShiftRight();){if(e>this.matrix.getWidth())throw new Error("There is a problem with polyomino collision checks.");o(),this.polyominoController.is20G()&&this.polyominoController.slamToFloor(),e++}}else for(;this.autoshiftRateAccum>=this.getAutoshiftRate();)o(),this.polyominoController.is20G()&&this.polyominoController.slamToFloor(),this.autoshiftRateAccum-=this.getAutoshiftRate();this.autoshiftRateAccum+=s}}break;case"retro":if(this.polyominoController.isStuck())return;if("entryDelay"===this.state)return void(i?(this.hasReleasedShift=!1,this.shiftDirection="left"):r?(this.hasReleasedShift=!1,this.shiftDirection="right"):this.shiftDirection="none");if(this.setDirection({leftPressedAmount:e,rightPressedAmount:t,hasRightReleased:n,isLeftDown:i,hasLeftReleased:o,isRightDown:r,resetShiftOnFullRelease:!1,resetVariableMethod:this.resetRetroAutoshiftVars.bind(this)}),(i&&!this.polyominoController.canShiftLeft()||r&&!this.polyominoController.canShiftRight())&&(this.wallCharge=!0),"none"!==this.shiftDirection&&!this.softDropIsDown){const e="left"===this.shiftDirection?this.polyominoController.shiftLeft.bind(this.polyominoController):this.polyominoController.shiftRight.bind(this.polyominoController);for(this.hasReleasedShift||this.wallCharge?(e(),this.hasReleasedShift=!1,("left"===this.shiftDirection?this.polyominoController.canShiftLeft():this.polyominoController.canShiftRight())&&(this.wallCharge=!1)):this.autoshiftAccum<this.getAutoshiftDelay()&&(this.autoshiftAccum+=s);this.autoshiftAccum>=this.getAutoshiftDelay();)e(),this.autoshiftAccum-=this.getAutoshiftRate()}break;default:throw new Error(`Unhandled autoshift type: ${this.rule.autoshiftType}`)}}start(){this.polyominoController.init(this.nextQueue.shiftNextPolyomino()),this.state="playing",this.mode.onGameStart(this)}getStats(){return this.stats}getState(){return this.state}getPolyominoController(){return this.polyominoController}getMatrix(){return this.matrix}getNextQueue(){return this.nextQueue}getHoldQueue(){return this.holdQueue}getHoldLockedState(){return this.holdIsLocked}getControllerDrawInfo(){return this.polyominoController.getDrawData()}getControllerDirtyState(){return this.polyominoController.isDirty()}hadControllerDrawn(){this.polyominoController.wasDrawn()}getControllerLockDelay(){return this.polyominoController.getLockDelayAccumulated()}getHardDropLineClearRows(){return this.polyominoController.getHardDropLineClearRows()}getMatrixDrawInfo(){return this.matrix.getDrawData()}getMatrixHiddenHeight(){return this.matrix.getHiddenHeight()}getNextDrawInfo(){return this.nextQueue.getDrawInfo()}getHoldDrawInfo(){return this.holdQueue.getDrawInfo()}}class ge{constructor(){this.isPaused=!1}init(e){this.Mode=e,this.engine=new me(this.Mode)}doTick(e){if(ne.getGamePress("retry"))return this.isPaused&&(this.isPaused=!1),this.engine=new me(this.Mode),void this.engine.start();if("gameOver"!==this.engine.getState())if(this.isPaused)ne.getGamePress("pause")&&(this.engine.updateShift({msPassed:1,hasLeftReleased:!0,hasRightReleased:!0}),this.isPaused=!1);else if(ne.getGamePress("pause"))this.isPaused=!0;else{this.engine.doStartOfTick(e);for(let e=0;e<ne.getGamePressAsNum("rotateLeft");e++)this.engine.onRotateLeft();for(let e=0;e<ne.getGamePressAsNum("rotateRight");e++)this.engine.onRotateRight();for(let e=0;e<ne.getGamePressAsNum("rotate180");e++)this.engine.onRotate180();this.engine.updateShift({msPassed:e,leftPressedAmount:ne.getGamePressAsNum("shiftLeft"),rightPressedAmount:ne.getGamePressAsNum("shiftRight"),isLeftDown:ne.getGameDown("shiftLeft"),isRightDown:ne.getGameDown("shiftRight"),hasLeftReleased:ne.getGameRelease("shiftLeft"),hasRightReleased:ne.getGameRelease("shiftRight")}),ne.getGamePress("softDrop")&&this.engine.onSoftDropPress(),ne.getGameRelease("softDrop")&&this.engine.onSoftDropRelease(),ne.getGameDown("softDrop")&&this.engine.onSoftDropDown(),ne.getGamePress("hardDrop")&&this.engine.onHardDropPress(),ne.getGameRelease("hardDrop")&&this.engine.onHardDropRelease(),ne.getGameDown("hardDrop")&&this.engine.onHardDropDown(),ne.getGamePress("hold")&&this.engine.onHoldPress(),this.engine.doEndOfTick(e)}}}class ye{constructor(){this.path="abstract",this.gutterWidth=3,this.resolution=144}getUrl(){return`./res/img/skin/hyper/${this.path}.png`}getCoordinates(e){const{x:t,y:o}=e.holdIsLocked?this.assignments[e.color].holdLocked:this.assignments[e.color].regular;return{x:this.gutterWidth+t*this.resolution+t*this.gutterWidth*2,y:this.gutterWidth+o*this.resolution+o*this.gutterWidth*2}}getResolution(){return this.resolution}}class xe extends ye{constructor(){super(...arguments),this.assignments={red:{regular:{x:0,y:0},holdLocked:{x:4,y:1}},orange:{regular:{x:1,y:0},holdLocked:{x:4,y:1}},yellow:{regular:{x:2,y:0},holdLocked:{x:4,y:1}},green:{regular:{x:3,y:0},holdLocked:{x:4,y:1}},lightBlue:{regular:{x:4,y:0},holdLocked:{x:4,y:1}},blue:{regular:{x:5,y:0},holdLocked:{x:4,y:1}},purple:{regular:{x:6,y:0},holdLocked:{x:4,y:1}},white:{regular:{x:0,y:1},holdLocked:{x:4,y:1}},gray:{regular:{x:1,y:1},holdLocked:{x:4,y:1}},black:{regular:{x:2,y:1},holdLocked:{x:4,y:1}},bone:{regular:{x:3,y:1},holdLocked:{x:5,y:1}}}}}class _e extends xe{constructor(){super(...arguments),this.path="srs-x"}}class ve extends ae{constructor(e){super(),this.statElements={},this.skin=new _e,this.lastControllerData={},this.accum=0,this.accum60check=0,this.containerDiv=document.createElement("div"),this.containerDiv.classList.add("game-container"),this.gameDiv=this.makeDiv(["game"],this.containerDiv),this.leftDiv=this.makeDiv(["game-left"],this.gameDiv),this.centerDiv=this.makeDiv(["game-center"],this.gameDiv),this.rightDiv=this.makeDiv(["game-right"],this.gameDiv),this.backgroundCanvas=this.makeCanvas(["game-background-canvas"],this.centerDiv),this.backgroundCtx=se.toCtx(this.backgroundCanvas),this.matrixCanvas=this.makeCanvas(["game-canvas"],this.centerDiv),this.matrixCtx=se.toCtx(this.matrixCanvas),this.controllerCanvas=this.makeCanvas(["game-canvas"],this.centerDiv),this.controllerCtx=se.toCtx(this.controllerCanvas),this.controllerCanvas.classList.add("pulse"),this.nextContainer=this.makeDiv(["next-container"],this.rightDiv),this.nextLabel=this.makeParagraph(["next-label"],this.nextContainer),this.nextCanvas=this.makeCanvas(["next-canvas"],this.nextContainer),this.nextCtx=se.toCtx(this.nextCanvas),this.holdContainer=this.makeDiv(["hold-container"],this.leftDiv),this.holdLabel=this.makeParagraph(["hold-label"],this.holdContainer),this.holdCanvas=this.makeCanvas(["hold-canvas"],this.holdContainer),this.holdCtx=se.toCtx(this.holdCanvas),this.statContainer=this.makeDiv(["stat-container"],this.leftDiv),this.modeNameLabel=this.makeDiv(["game-mode-label"],this.centerDiv),this.manager=new ge,this.manager.init(e),this.createStatContainer(),this.width=this.manager.engine.getMatrix().getWidth(),this.height=this.manager.engine.getMatrix().getVisibleHeight(),this.manager.engine.start(),this.bpm=140}doLogicTick(e){this.manager.doTick(e)}doDrawTick(e){const{engine:t}=this.manager;this.accum+=e,this.accum60check+=e,this.accum60check>1e3/60&&(this.flickerAmount=Math.random()/2+.5,this.accum60check-=1e3/60);const o=this.getCellSize();if(t.getPolyominoController().checkIfSpin().isSpin?this.controllerCanvas.classList.add("tspin"):this.controllerCanvas.classList.remove("tspin"),t.getPolyominoController().isDirty()){se.clearCtx(this.controllerCtx);const e=t.getPolyominoController().getLockDelayAccumulated();let n=("0"+Math.floor(e/t.rule.lockDelay*255).toString(16)).slice(-2);t.getPolyominoController().hasExhaustedResets()&&(n="ff");for(const e of t.getPolyominoController().getDrawData())e.isGhost?this.controllerCtx.globalAlpha=.5:this.controllerCtx.globalAlpha=1,this.drawMonomino(this.controllerCtx,e.color,e.skin,e.shape,e.x,e.y+ve.BUFFER_PEEK,o),e.isGhost||"retro"===t.rule.lockDelayType||(this.controllerCtx.globalCompositeOperation="saturation",this.controllerCtx.fillStyle=`#000000${n}`,this.controllerCtx.fillRect(Math.floor(e.x*o),Math.floor((e.y+ve.BUFFER_PEEK)*o),o,o));t.getPolyominoController().wasDrawn()}se.clearCtx(this.matrixCtx);const n=t.getHardDropLineClearRows();for(const e of t.getMatrix().getDrawData()){if("invalid"===e.color)continue;this.drawMonomino(this.matrixCtx,e.color,e.skin,e.shape,e.x,e.y+ve.BUFFER_PEEK,o);const i=e.x*o,r=(e.y+ve.BUFFER_PEEK)*o;if(this.matrixCtx.globalCompositeOperation="multiply",this.matrixCtx.fillStyle="#0003",this.matrixCtx.fillRect(Math.floor(i),Math.floor(r),o,o),-1!==n.indexOf(e.y+t.getMatrix().getHiddenHeight())){const t=("0"+Math.floor(255*(1-(this.accum+(this.width-e.x)/this.width*he.bpmToMsPerBar(this.bpm))%he.bpmToMsPerBar(this.bpm)/he.bpmToMsPerBar(this.bpm))).toString(16)).slice(-2);this.matrixCtx.globalCompositeOperation="overlay",this.matrixCtx.fillStyle=`#ffffff${t}`,this.matrixCtx.fillRect(Math.floor(e.x*o),Math.floor((e.y+ve.BUFFER_PEEK)*o),o,o),this.matrixCtx.globalCompositeOperation="source-over"}if(performance.now()-e.timeLocked<400){const t=("0"+Math.floor(255*(1-(performance.now()-e.timeLocked)/400)).toString(16)).slice(-2);this.matrixCtx.globalCompositeOperation="overlay",this.matrixCtx.fillStyle=`#ffffff${t}`,this.matrixCtx.fillRect(Math.floor(i),Math.floor(r),o,o),((t,n)=>{const s=(performance.now()-e.timeLocked+0)/200,a=(e=0)=>Math.min(Math.min(Math.max(Math.max(0,2*s-1+e),0),1)*o,o),l=(e=0)=>Math.min(o-Math.min(Math.max(Math.min(2*s+e,1),0),1)*o,o),u=a(-.2),c=l(-.2),h=a(.2),d=l(.2),p=Math.min(u,h),f=Math.min(c,d);this.matrixCtx.beginPath(),this.matrixCtx.moveTo(i+u,Math.floor(r+c)),this.matrixCtx.lineTo(i+o-c,Math.floor(r+o-u)),this.matrixCtx.lineTo(i+o-f,Math.floor(r+o-p)),this.matrixCtx.lineTo(i+o-d,Math.floor(r+o-h)),this.matrixCtx.lineTo(i+h,Math.floor(r+d)),this.matrixCtx.lineTo(i+p,Math.floor(r+f)),this.matrixCtx.fillStyle="#fff",this.matrixCtx.fill()})()}performance.now()-e.timeLocked<50&&(this.matrixCtx.globalCompositeOperation="source-atop",this.matrixCtx.fillStyle="#fff",this.matrixCtx.fillRect(Math.floor(i),Math.floor(r),o,o),this.matrixCtx.globalCompositeOperation="source-over")}for(const e of t.getMatrix().getRowsMarkedForDeath()){const n=("0"+Math.floor((t.rule.lineClearDelay-t.getEntryDelayAccum())/t.rule.lineClearDelay*255).toString(16)).slice(-2);this.matrixCtx.fillStyle=`#ffffff${n}`,this.matrixCtx.fillRect(0,Math.floor((e-t.getMatrix().getHiddenHeight()+ve.BUFFER_PEEK)*o),this.matrixCanvas.clientWidth,o)}if(t.getMatrix().isCloseToSkyline()&&t.rule.hasLockOut){const e=ve.BUFFER_PEEK*o+2;this.matrixCtx.globalAlpha=this.flickerAmount,this.matrixCtx.beginPath(),this.matrixCtx.moveTo(0,e),this.matrixCtx.lineTo(this.matrixCanvas.clientWidth,e),this.matrixCtx.strokeStyle="#f00",this.matrixCtx.lineWidth=4,this.matrixCtx.stroke(),this.matrixCtx.globalAlpha=1}se.clearCtx(this.nextCtx);const i=t.getNextQueue().getDrawInfo();for(let e=0;e<i.length;e++)for(const t of i[e])"invalid"!==t.color&&(0===e?this.drawMonomino(this.nextCtx,t.color,t.skin,t.shape,t.x+ve.QUEUE_OFFSETS[t.shape][t.orientation].x,t.y+ve.QUEUE_OFFSETS[t.shape][t.orientation].y,o):this.drawMonomino(this.nextCtx,t.color,t.skin,t.shape,t.x+ve.QUEUE_OFFSETS[t.shape][t.orientation].x+2,t.y+ve.QUEUE_OFFSETS[t.shape][t.orientation].y+4+4*e,o/2));if(se.clearCtx(this.holdCtx),t.rule.allowsHold){this.holdLabel.classList.remove("hidden");for(const e of t.getHoldQueue().getDrawInfo())"invalid"!==e.color&&this.drawMonomino(this.holdCtx,e.color,e.skin,e.shape,e.x+ve.QUEUE_OFFSETS[e.shape][e.orientation].x,e.y+ve.QUEUE_OFFSETS[e.shape][e.orientation].y,o,t.getHoldLockedState())}else this.holdLabel.classList.add("hidden");this.updateStats()}updateStats(){for(const e of this.manager.engine.mode.getStatsToDraw()){const t=this.statElements[e.name];t.value.innerHTML!==e.value&&(""!==t.value.innerHTML&&se.resetClassAnim(t.value,"stat-update"),t.value.innerHTML=e.value)}}createStatContainer(){this.statElements={};for(const e of this.manager.engine.mode.getStatsToDraw()){const t=document.createElement("div");t.classList.add("stat-group");const o=document.createElement("div");o.classList.add("label"),o.innerHTML=e.name,t.appendChild(o);const n=document.createElement("div");n.classList.add("value"),e.isLarge&&n.classList.add("large"),n.innerHTML=e.value,t.appendChild(n),this.statElements[e.name]={group:t,label:o,value:n},this.statContainer.appendChild(t)}}drawMonomino(e,t,o,n,i,r,s,a){const l=o.skin.getCoordinates({color:t,holdIsLocked:a,shape:n,level:this.manager.engine.mode.getLevel()}),u=o.skin.getResolution();e.drawImage(o.img,l.x,l.y,u,u,i*s,Math.floor(r*s),s,s)}clearCell(e,t,o,n){e.clearRect(Math.floor(t*n),Math.floor(o*n),n,n)}construct(){re.getRendererContainer().appendChild(this.containerDiv),this.onResize(),this.onResize()}onResize(){this.updateText();const e=document.documentElement;e.style.setProperty("--cell-size",`${this.getCellSize()}px`),e.style.setProperty("--matrix-width",this.width.toString()),e.style.setProperty("--matrix-height",this.height.toString()),e.style.setProperty("--peek-zone",ve.BUFFER_PEEK.toString()),e.style.setProperty("--off-screen",ve.OFF_SCREEN.toString()),e.style.setProperty("--bpm",this.bpm.toString());for(const e of[this.controllerCanvas,this.matrixCanvas,this.backgroundCanvas,this.nextCanvas,this.holdCanvas])e.width=e.clientWidth,e.height=e.clientHeight;this.manager.engine.getPolyominoController().needsRedrawing(),this.drawBackground(),this.doDrawTick(0)}getSkin(){return this.skin}makeElement(e,t){const o=document.createElement(t);for(const t of e)o.classList.add(t);return o}makeDiv(e,t){const o=this.makeElement(e,"div");return t.appendChild(o),o}makeCanvas(e,t){const o=this.makeElement(e,"canvas");return t.appendChild(o),o}makeParagraph(e,t){const o=this.makeElement(e,"p");return t.appendChild(o),o}updateText(){this.nextLabel.textContent=W.t("gameUi:next"),this.holdLabel.textContent=W.t("gameUi:hold"),this.modeNameLabel.textContent=this.manager.engine.mode.getName()}getCellSize(){const e=(Math.max(this.leftDiv.offsetWidth,this.statContainer.offsetWidth)+this.centerDiv.offsetWidth+this.rightDiv.offsetWidth)/this.centerDiv.offsetHeight,t=Math.min(window.innerWidth/e,window.innerHeight);return Math.floor(t/1.2/this.height)}drawBackground(){const e=1/4,t=this.getCellSize(),o=this.backgroundCtx;o.strokeStyle="#ffffff7f",o.lineWidth=2;for(let n=0;n<=this.width;n++)for(let i=0;i<=this.height;i++)o.beginPath(),o.moveTo(n*t-t*e,i*t),o.lineTo(n*t+t*e,i*t),o.stroke(),o.beginPath(),o.moveTo(n*t,i*t-t*e),o.lineTo(n*t,i*t+t*e),o.stroke()}}ve.BUFFER_PEEK=4,ve.OFF_SCREEN=1.75,ve.QUEUE_OFFSETS={i:[{x:0,y:.5},{x:-.5,y:0},{x:0,y:-.5},{x:.5,y:0}],j:[{x:.5,y:1},{x:0,y:.5},{x:0,y:.5},{x:1,y:.5}],l:[{x:.5,y:1},{x:0,y:.5},{x:0,y:.5},{x:1,y:.5}],o:[{x:1,y:1},{x:1,y:1},{x:1,y:1},{x:1,y:1}],s:[{x:.5,y:1},{x:0,y:.5},{x:0,y:.5},{x:1,y:.5}],t:[{x:.5,y:1},{x:0,y:.5},{x:0,y:.5},{x:1,y:.5}],z:[{x:.5,y:1},{x:0,y:.5},{x:0,y:.5},{x:1,y:.5}]};class ke{constructor(){this.spinPolyominoList=["t"],this.spinBonusType="threeCorner",this.hardDropRowBonus=2,this.softDropRowBonus=1}getLockdownScore({lineClearAmount:e,isSpin:t,isMini:o,levelMultiplier:n=1}){let i=0;return i+=[0,100,300,500,800][e=Math.min(4,e)],t&&(i+=[400,700,900,1100,1200][e]),o&&(i+=100),i*n}}class we{constructor({xOffset:e,yOffset:t,orientation:o,usedKick:n,mustUpgradeSpin:i}){this.mustUpgradeSpin=null!=i&&i,this.xOffset=e,this.yOffset=t,this.orientation=o,this.usedKick=n}getIsUpward(){return this.yOffset<0}}class be{getKickTable({shape:e,rotateDirection:t,oldOrientation:o}){switch(e){case"i":switch(t){case 3:return be.LEFT_I_KICKS[o];case 1:return be.RIGHT_I_KICKS[o];case 2:return be.DOUBLE_I_KICKS[o];default:throw new Error("Rotation direction unhandled in kick table retrieval")}case"j":case"l":case"s":case"t":case"z":switch(t){case 3:return be.LEFT_X_KICKS[o];case 1:return be.RIGHT_X_KICKS[o];case 2:return be.DOUBLE_X_KICKS[o];default:throw new Error("Rotation direction unhandled in kick table retrieval")}default:return null}}executeWallkick({xOffset:e,yOffset:t,polyominoController:o,rotateDirection:n,oldOrientation:i,newOrientation:r,allowFloorKicks:s}){if(!o.collidesWith(e,t,r))return new we({xOffset:0,yOffset:0,orientation:r,usedKick:!1});const a=this.getKickTable({shape:o.getPolyominoShape(),rotateDirection:n,oldOrientation:i});if(null!=a)for(let n=0;n<a.length;n++){const i=a[n];if((i.y>=0||s)&&!o.collidesWith(i.x+e,i.y+t,r))return new we({xOffset:i.x,yOffset:i.y,orientation:r,usedKick:!0,mustUpgradeSpin:n>=3})}return null}}be.LEFT_X_KICKS=[[{x:1,y:0},{x:1,y:-1},{x:0,y:2},{x:1,y:2}],[{x:1,y:0},{x:1,y:1},{x:0,y:-2},{x:1,y:-2}],[{x:-1,y:0},{x:-1,y:-1},{x:0,y:2},{x:-1,y:2}],[{x:-1,y:0},{x:-1,y:1},{x:0,y:-2},{x:-1,y:-2}]],be.RIGHT_X_KICKS=[[{x:-1,y:0},{x:-1,y:-1},{x:0,y:2},{x:-1,y:2}],[{x:1,y:0},{x:1,y:1},{x:0,y:-2},{x:1,y:-2}],[{x:1,y:0},{x:1,y:-1},{x:0,y:2},{x:1,y:2}],[{x:-1,y:0},{x:-1,y:1},{x:0,y:-2},{x:-1,y:-2}]],be.DOUBLE_X_KICKS=[[{x:1,y:0},{x:-1,y:0},{x:0,y:-1},{x:0,y:1},{x:0,y:-2},{x:0,y:2}],[{x:0,y:1},{x:0,y:-1},{x:0,y:-2},{x:0,y:2},{x:-1,y:0},{x:1,y:0}],[{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1},{x:0,y:2},{x:0,y:-2}],[{x:0,y:1},{x:0,y:-1},{x:0,y:-2},{x:0,y:2},{x:1,y:0},{x:-1,y:0}]],be.LEFT_I_KICKS=[[{x:-1,y:0},{x:2,y:0},{x:-1,y:-2},{x:2,y:1}],[{x:2,y:0},{x:-1,y:0},{x:2,y:-1},{x:-1,y:2}],[{x:1,y:0},{x:-2,y:0},{x:1,y:2},{x:-2,y:-1}],[{x:-2,y:0},{x:1,y:0},{x:-2,y:1},{x:1,y:-2}]],be.RIGHT_I_KICKS=[[{x:-2,y:0},{x:1,y:0},{x:-2,y:1},{x:1,y:-2}],[{x:-1,y:0},{x:2,y:0},{x:-1,y:-2},{x:2,y:1}],[{x:2,y:0},{x:-1,y:0},{x:2,y:-1},{x:-1,y:2}],[{x:1,y:0},{x:-2,y:0},{x:1,y:2},{x:-2,y:-1}]],be.DOUBLE_I_KICKS=[[{x:-1,y:0},{x:-2,y:0},{x:1,y:0},{x:2,y:0}],[{x:0,y:1},{x:0,y:-1},{x:0,y:-2},{x:0,y:2}],[{x:1,y:0},{x:2,y:0},{x:-1,y:0},{x:-2,y:0}],[{x:0,y:1},{x:0,y:-1},{x:0,y:-2},{x:0,y:2}]];class Se extends class{constructor(){this.initialOrientation={i:0,j:0,l:0,o:0,s:0,t:0,z:0},this.offsets={i:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],j:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],l:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],o:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],s:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],t:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],z:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]}}}{constructor(){super(...arguments),this.wallkick=new be}}class Ae extends Array{shuffle(){for(let e=this.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[this[e],this[t]]=[this[t],this[e]]}}}class De{constructor(){this.bagMultiplier=1,this.generator=this.generatorFunc()}*generatorFunc(){const e=new Ae;for(;;){if(0===e.length){for(let t=0;t<this.bagMultiplier;t++)e.push(...this.polyominoSet);e.shuffle()}yield e.pop()}}setPolyominoSet(e){this.polyominoSet=e}getNextPolyomino(){return this.generator.next().value}}class Ce extends ye{constructor(){super(...arguments),this.path="retro-console"}getCoordinates(e){const{x:t,y:o}=Ce.getXY(e);return{x:this.gutterWidth+t*this.resolution+t*this.gutterWidth*2,y:this.gutterWidth+o*this.resolution+o*this.gutterWidth*2}}static getXY(e){if("bone"===e.color)return Ce.DATA.bone[e.level%2];if(e.holdIsLocked)switch(e.shape){case"i":case"t":case"o":return{x:2,y:4};default:return{x:3,y:4}}switch(e.shape){case"i":case"t":case"o":return Ce.DATA.ito[e.level%10];case"j":case"s":return Ce.DATA.js[e.level%10];case"l":case"z":return Ce.DATA.lz[e.level%10];case"brokenGarbage":return{x:0,y:4};case"solidGarbage":return{x:1,y:4};default:return{x:5,y:2}}}}Ce.DATA={ito:[{x:0,y:0},{x:3,y:0},{x:0,y:1},{x:0,y:0},{x:4,y:1},{x:1,y:2},{x:3,y:2},{x:0,y:3},{x:0,y:0},{x:3,y:2}],js:[{x:1,y:0},{x:4,y:0},{x:1,y:1},{x:1,y:0},{x:5,y:1},{x:0,y:2},{x:4,y:2},{x:1,y:3},{x:1,y:0},{x:4,y:2}],lz:[{x:2,y:0},{x:5,y:0},{x:2,y:1},{x:3,y:1},{x:0,y:2},{x:2,y:2},{x:5,y:2},{x:2,y:3},{x:4,y:2},{x:3,y:3}],bone:[{x:4,y:3},{x:5,y:3}]};class Te{static load(e){if(null!==e.img)return;const t=document.createElement("img");t.src=e.skin.getUrl(),e.img=t}static loadAll(){for(const e of Object.keys(Te.skins))Te.load(Te.skins[e])}}Te.skins={standard:{skin:new class extends xe{constructor(){super(...arguments),this.path="standard"}},img:null},srsX:{skin:new _e,img:null},tetraX:{skin:new class extends xe{constructor(){super(...arguments),this.path="tetra-x"}},img:null},arcadeWorld:{skin:new class extends xe{constructor(){super(...arguments),this.path="arcade-world"}},img:null},arcadeClassic:{skin:new class extends xe{constructor(){super(...arguments),this.path="arcade-classic"}},img:null},diamond:{skin:new class extends xe{constructor(){super(...arguments),this.path="diamond"}},img:null},retroConsole:{skin:new Ce,img:null}};class Le{constructor(){this.allowsGhost=!0,this.allowsHardDrop=!0,this.allowsHold=!0,this.allowsHoldBuffering=!0,this.allowsRotate180=!0,this.allowsRotateBuffering=!0,this.allowsRotateLeft=!0,this.allowsRotateRight=!0,this.allowsSoftDrop=!0,this.autoshiftType="standard",this.colors={i:"lightBlue",j:"blue",l:"orange",o:"yellow",s:"green",t:"purple",z:"red"},this.skin=Te.skins.standard,this.entryDelay=100,this.entryDelayOnLineClear=100,this.hardDropLocksPieceInstantly=!0,this.hardDropExecutesOnlyOncePerPress=!0,this.hasLockOut=!0,this.hasPartialLockOut=!1,this.holdResetsPieceOrientation=!0,this.immediateDropOnSpawn=1,this.lineClearDelay=300,this.lockDelay=500,this.resetExpirationPenalty="instant-lock",this.lockDelayType="limited",this.matrixWidth=10,this.matrixHeight=20,this.matrixHiddenHeight=20,this.matrixHasCeiling=!1,this.maxAutoshiftDelay=Number.MAX_SAFE_INTEGER,this.maxAutoshiftRate=Number.MAX_SAFE_INTEGER,this.maxPiecePreviews=6,this.minAutoshiftDelay=-1,this.minAutoshiftRate=-1,this.moveAndRotateResetsAreShared=!0,this.moveResets=15,this.randomizer=new De,this.resetLockDelayByFalling=!0,this.resetLockDelayByKicking=!1,this.resetLockDelayByMoving=!0,this.resetLockDelayByRotating=!0,this.resetResetsByFalling=!0,this.rotationResets=15,this.rotationSystem=new Se,this.skipEntryDelayOnHold=!1,this.skipEntryDelayOnMove=!1,this.skipEntryDelayOnRotate=!1,this.softDropCarriesBetweenPieces=!0,this.softDropLocksPieceInstantly=!1,this.softDropSpeed=20,this.softDropType="multiplicative",this.spawnOffsets={i:{x:3,y:-2},j:{x:3,y:-2},l:{x:3,y:-2},o:{x:4,y:-2},s:{x:3,y:-2},t:{x:3,y:-2},z:{x:3,y:-2}},this.suspendPieceUntilAction=!1}}class Re extends class{constructor(){this.name="Dummy",this.polyominoSet=ce.TETROMINOES}getName(){return this.name}getLevel(){return 1}getStatsToDraw(){return[]}onGameStart(e){}onLockdown(e){}onNewPolyomino(e){}onStartOfTickBegin(e){}onStartOfTickEnd(e){}onEndOfTickBegin(e){}onEndOfTickEnd(e){}}{constructor(){super(...arguments),this.Rule=Le,this.scoring=new ke,this.name=W.t("modes:marathon.name"),this.level=1,this.standardLockDelay=0,this.standardLineClearDelay=0,this.engineStats={scoreAccumulated:0,linesCleared:0,polyominoesPlaced:0}}getStatsToDraw(){var e,t;return[{name:"Level",value:this.level.toString(),isLarge:!0},{name:"Lines",value:(null===(e=this.engineStats)||void 0===e?void 0:e.linesCleared.toString())+`<small>/${10*this.level}</small>`,isLarge:!0},{name:"Placed",value:null===(t=this.engineStats)||void 0===t?void 0:t.polyominoesPlaced.toString(),isLarge:!0}]}getLevel(){return this.level-1}onEndOfTickEnd(e){this.engineStats=e.getStats()}onGameStart(e){this.standardLockDelay=e.rule.lockDelay,this.standardLineClearDelay=e.rule.lineClearDelay}onNewPolyomino(e){const t=this.level;this.level>=40&&(e.rule.colors={i:"bone",j:"bone",l:"bone",o:"bone",s:"bone",t:"bone",z:"bone"}),this.level=Math.floor(e.getStats().linesCleared/10+1);const o=Math.pow(.8-.007*(this.level-1),this.level-1);e.getPolyominoController().setFallSpeedAsMsPerLine(1e3*o),this.level>=20?(e.getPolyominoController().setFallSpeedTo20G(),e.rule.lockDelay=this.standardLockDelay*Math.pow(.93,Math.pow(this.level-20,.8)),e.rule.lineClearDelay=this.standardLineClearDelay*Math.pow(.93,Math.pow(this.level-20,.8))):(e.rule.lockDelay=this.standardLockDelay,e.rule.lineClearDelay=this.standardLineClearDelay),this.level>t&&r.add("levelUp")}}class Oe extends ae{constructor(){super(),this.timePassed=0,Te.loadAll()}doLogicTick(e){re.isDevBuild()?Oe.goToNextRenderer():(this.timePassed+=e,this.timePassed>=500&&this.constructBrandLogo(),this.timePassed>=1500&&this.addFadeToBrandLogo(),this.timePassed>=2e3&&this.constructAuthorLogo(),this.timePassed>=3500&&this.addFadeToAuthorLogo(),this.timePassed>=4e3&&Oe.goToNextRenderer())}static goToNextRenderer(){re.setRender(new ve(Re))}constructBrandLogo(){this.brandLogoElement=document.createElement("h1"),this.brandLogoElement.textContent="Tetra Developer Studio",re.getRendererContainer().appendChild(this.brandLogoElement),this.constructBrandLogo=()=>{}}addFadeToBrandLogo(){this.brandLogoElement.classList.add("splash-fade-out"),this.addFadeToBrandLogo=()=>{}}constructAuthorLogo(){se.killAllChildren(re.getRendererContainer()),this.authorLogoElement=document.createElement("h1"),this.authorLogoElement.innerHTML=W.t("rootMenu:createdBy",{author:"<div>Dr Ocelot</div>",interpolation:{escapeValue:!1}}),this.authorLogoElement.classList.add("splash-fade-in"),re.getRendererContainer().appendChild(this.authorLogoElement),this.constructAuthorLogo=()=>{}}addFadeToAuthorLogo(){this.authorLogoElement.classList.remove("splash-fade-in"),se.reflow(this.authorLogoElement),this.authorLogoElement.classList.add("splash-fade-out"),this.addFadeToAuthorLogo=()=>{}}}(function(){return e=this,t=void 0,n=function*(){return yield W.init({lng:"en-US",fallbackLng:"en-US",debug:re.isDevBuild(),resources:{"en-US":{controls:Q,rootMenu:$,gameUi:Z,modes:te}}})},new((o=void 0)||(o=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}));var e,t,o,n})().then((()=>{re.isDevBuild()&&(oe.controls.rotateRight=["KeyX"],oe.controls.hardDrop=["ArrowUp"],oe.controls.rotate180=["KeyS"],oe.config.autoshiftDelay=150,oe.config.autoshiftRate=15,oe.config.autoshiftBuffering="instant"),re.init(),re.setRender(new Oe),r.setSoundbank(r.soundbanks.tetrax)}))}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}};return o[e](r,r.exports,i),r.exports}t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(o,n){if(1&n&&(o=this(o)),8&n)return o;if("object"==typeof o&&o){if(4&n&&o.__esModule)return o;if(16&n&&"function"==typeof o.then)return o}var r=Object.create(null);i.r(r);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&o;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>o[e]));return s.default=()=>o,i.d(r,s),r},i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(342)})();